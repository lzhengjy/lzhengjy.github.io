<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://lzhengjy.github.io/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zheng">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lzhengjy.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-责任链模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2024-04-15T11:53:12.000Z" itemprop="datePublished">2024-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%BB%8F%E9%AA%8C/">技术经验</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/">责任链模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-什么是责任链模式"><a href="#1-什么是责任链模式" class="headerlink" title="1. 什么是责任链模式"></a>1. 什么是责任链模式</h4><p>避免请求发送者与接收者耦合在一起，让多个对象都有可能接收请求，将这些对象连接成一条链，并且沿着这条链传递请求，直到有对象处理它为止</p>
<p>举个例子，SpringMvc 中可以定义拦截器，并且可以定义多个。当一个用户发起请求时，顺利的话请求会经过所有拦截器，最终到达业务代码逻辑，SpringMvc 拦截器设计就是使用了责任链模式</p>
<p>在责任链模式中，多个处理器（参照上述拦截器）依次处理同一个请求。一个请求先经过 A 处理器处理，然后再把请求传递给 B 处理器，B 处理器处理完后再传递给 C 处理器，以此类推，形成一个链条，链条上的每个处理器 <strong>各自承担各自的处理职责</strong></p>
<p>责任链模式中多个处理器形成的处理器链在进行处理请求时，有两种处理方式：</p>
<ol>
<li><p>请求会被 <strong>所有的处理器都处理一遍，不存在中途终止的情况</strong>，这里参照 MyBatis 拦截器理解。</p>
<p><img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626201902442.png" alt="image-20240626201902442"></p>
</li>
<li><p>二则是处理器链执行请求中，某一处理器执行时，<strong>如果不符合自制定规则的话，停止流程，并且剩下未执行处理器就不会被执行</strong>，大家参照 SpringMvc 拦截器理解</p>
<p><img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626201844136.png" alt="image-20240626201844136"></p>
</li>
</ol>
<br>



<p>这里通过代码的形式对两种处理方式作出解答，首先看下第一种，请求会经过所有处理器执行的情况。</p>
<img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626200552887.png" alt="image-20240626200552887" style="zoom:67%;">

<p><code>IHandler</code> 负责抽象处理器行为，<code>handle()</code> 则是不同处理器具体需要执行的方法，<code>HandleA</code>、<code>HandleB</code> 为具体需要执行的处理器类，<code>HandlerChain</code> 则是将处理器串成一条链执行的处理器链。</p>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HandlerChain</span> <span class="variable">handlerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandlerChain</span>();</span><br><span class="line">        handlerChain.addHandler(Lists.newArrayList(<span class="keyword">new</span> <span class="title class_">HandlerA</span>(), <span class="keyword">new</span> <span class="title class_">HandlerB</span>()));</span><br><span class="line">        handlerChain.handle();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 程序执行结果：</span></span><br><span class="line"><span class="comment">         * HandlerA打印：执行 HandlerA</span></span><br><span class="line"><span class="comment">         * HandlerB打印：执行 HandlerB</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种责任链执行方式会将所有的 <strong>处理器全部执行一遍</strong>，不会被打断。MyBatis 拦截器用的正是此类型，这种类型 <strong>重点在对请求过程中的数据或者行为进行改变</strong></p>
<br>





<p>而另外一种责任链模式实现，则是会对请求有阻断作用，阻断产生的前置条件是在处理器中自定义的，代码中的实现较简单</p>
<img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626200929239.png" alt="image-20240626200929239" style="zoom:67%;">

<br>



<p>根据代码看的出来，在每一个 IHandler 实现类中会返回一个布尔类型的返回值，如果返回布尔值为 false，那么责任链发起类会中断流程，剩余处理器将不会被执行。就像我们定义在 SpringMvc 中的 Token 拦截器，如果 Token 失效就不能继续访问系统，处理器将请求打回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HandlerChain</span> <span class="variable">handlerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandlerChain</span>();</span><br><span class="line">        handlerChain.addHandler(Lists.newArrayList(<span class="keyword">new</span> <span class="title class_">HandlerA</span>(), <span class="keyword">new</span> <span class="title class_">HandlerB</span>()));</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">resultFlag</span> <span class="operator">=</span> handlerChain.handle();</span><br><span class="line">        <span class="keyword">if</span> (!resultFlag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;责任链中处理器不满足条件&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>应用场景</strong></p>
<p>在实际应用中，责任链模式常用于请求的预处理、请求的过滤、请求的分发等场景。例如，可以使用责任链模式来实现权限校验、日志记录、异常处理、请求重试等功能。同时，也可以将责任链模式与其他设计模式结合起来，例如装饰器模式、工厂模式、观察者模式等，从而实现更复杂的功能</p>
<hr>
<h4 id="2-责任链模式结构"><a href="#2-责任链模式结构" class="headerlink" title="2. 责任链模式结构"></a>2. 责任链模式结构</h4><ul>
<li><code>抽象处理者（Handler）角色</code>：声明处理请求的所有接口，包含抽象处理方法，持有对下一个处理者的引用</li>
<li><code>基础处理者（Base Handler）角色</code>：「是一个可选的类」， 可以将所有处理者共用的样本代码放置在其中<ul>
<li>当使用基础处理者时，抽象处理者只需要定义行为方法。持有对下一个处理者的引用「下放到基础处理者」</li>
<li>可以在基础处理者实现一些具体处理者的公共方法，避免代码冗余</li>
</ul>
</li>
<li><code>具体处理者（Concrete Handler）角色</code>：实现抽象处理者的处理方法。判断能否处理本次请求，如果可以处理请求则处理，否则将该请求转给它的后继者</li>
<li><code>客户类（Client）</code>：创建处理链，并向链头的具体处理者对象提交请求</li>
</ul>
<br>



<img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626212045648.png" alt="image-20240626212045648" style="zoom:67%;">

<br>



<p><strong>优点和缺点</strong></p>
<p>优点在于，它可以动态地添加、删除和调整处理者对象，从而灵活地构建处理链。同时，它也避免了请求发送者和接收者之间的紧耦合，增强了系统的灵活性和可扩展性。</p>
<p>不过，责任链模式也有一定的缺点，例如如果处理链过长或者处理时间过长，可能会对系统性能产生一定的影响</p>
<hr>
<h4 id="3-自定义一个责任链模式"><a href="#3-自定义一个责任链模式" class="headerlink" title="3. 自定义一个责任链模式"></a>3. 自定义一个责任链模式</h4><p>需求<br>假设有一个学校有一个采购审批的需要，采购项目需要给领导审批，不同金钱范围，对应的审批领导的等级不同，如下：</p>
<ol>
<li>金额小于5000，由教学主任审批</li>
<li>金额小于等于5000，由院长审批</li>
<li>金额小于等于30000，由副校长任审批</li>
<li>金额大于30000，由校长审批</li>
</ol>
<br>



<p><strong>构成的责任链</strong></p>
<img src="/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/image-20240626212328559.png" alt="image-20240626212328559" style="zoom:50%;">

<br>



<p><strong>编码实现</strong></p>
<p>定义实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApproverRequest</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//请求类型</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">float</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">0.0f</span>; <span class="comment">//请求金额</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//构造器</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ApproverRequest</span><span class="params">(<span class="type">int</span> type, <span class="type">float</span> price, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.type = type;</span><br><span class="line">		<span class="built_in">this</span>.price = price;</span><br><span class="line">		<span class="built_in">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getType</span><span class="params">()</span> &#123; <span class="keyword">return</span> type; &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123; <span class="keyword">return</span> price; &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>在写一个抽象类，用于定义全局，作为子类的规范。链条中所有的结点都需要继承子类，实现子类里面的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义全局</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="comment">//下一个调用者</span></span><br><span class="line">    Approver next ;</span><br><span class="line">    <span class="comment">//需要传入的名字</span></span><br><span class="line">    String name ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Approver</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置下一个调用者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Approver next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">processApprover</span><span class="params">(ApproveRequest approveRequest)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>写链条中的第一个结点，由教学主任负责审批。如果金额太大，教学主任审批不了，那么就由这个院长审批</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentApprover</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DepartmentApprover</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processApprover</span><span class="params">(ApproverRequest approveRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(approveRequest.getPrice() &lt;= <span class="number">5000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; 请求编号 id= &quot;</span> + approveRequest.getId() + <span class="string">&quot; 被 &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; 处理&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            next.processApprover(approveRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>然后链条中的第二个结点，由院长负责审批。如果金额太大，院长审批不了，那么就由这个副校长审批</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollegeApprover</span> <span class="keyword">extends</span> <span class="title class_">Approver</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CollegeApprover</span><span class="params">(String name)</span> &#123;<span class="built_in">super</span>(name); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processApprover</span><span class="params">(ApproverRequest approveRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(approveRequest.getPrice() &gt; <span class="number">5000</span> &amp;&amp; approveRequest.getPrice() &lt;= <span class="number">10000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; 请求编号 id= &quot;</span> + approveRequest.getId() + <span class="string">&quot; 被 &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; 处理&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            next.processApprover(approveRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>然后链条中的第三个结点，由副长负责审批。如果金额太大副校长审批不了，那么就由这个校长审批</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViceSchoolMasterApprover</span> <span class="keyword">extends</span> <span class="title class_">Approver</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ViceSchoolMasterApprover</span><span class="params">(String name)</span> &#123;<span class="built_in">super</span>(name); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processApprover</span><span class="params">(ApproverRequest approveRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(approveRequest.getPrice() &gt; <span class="number">10000</span> &amp;&amp; approveRequest.getPrice() &lt;= <span class="number">30000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; 请求编号 id= &quot;</span> + approveRequest.getId() + <span class="string">&quot; 被 &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; 处理&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            next.processApprover(approveRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>然后开始写最后一个结点，由校长审批</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchoolMasterApprover</span> <span class="keyword">extends</span> <span class="title class_">Approver</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SchoolMasterApprover</span><span class="params">(String name)</span> &#123;<span class="built_in">super</span>(name); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processApprover</span><span class="params">(ApproverRequest approveRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(approveRequest.getPrice() &gt; <span class="number">30000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; 请求编号 id= &quot;</span> + approveRequest.getId() + <span class="string">&quot; 被 &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; 处理&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            next.processApprover(approveRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个请求</span></span><br><span class="line">        <span class="type">ApproverRequest</span> <span class="variable">approveRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApproverRequest</span>(<span class="number">1</span>, <span class="number">20000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//创建相关的审批人</span></span><br><span class="line">        <span class="type">DepartmentApprover</span> <span class="variable">departmentApprover</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DepartmentApprover</span>(<span class="string">&quot;刘主任&quot;</span>);</span><br><span class="line">        <span class="type">CollegeApprover</span> <span class="variable">collegeApprover</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollegeApprover</span>(<span class="string">&quot;刘院长&quot;</span>);</span><br><span class="line">        <span class="type">ViceSchoolMasterApprover</span> <span class="variable">viceSchoolMasterApprover</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViceSchoolMasterApprover</span>(<span class="string">&quot;刘副校&quot;</span>);</span><br><span class="line">        <span class="type">SchoolMasterApprover</span> <span class="variable">schoolMasterApprover</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchoolMasterApprover</span>(<span class="string">&quot;刘校长&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要将各个审批级别的下一个设置好</span></span><br><span class="line">        departmentApprover.setNext(collegeApprover);</span><br><span class="line">        collegeApprover.setNext(viceSchoolMasterApprover);</span><br><span class="line">        viceSchoolMasterApprover.setNext(schoolMasterApprover);</span><br><span class="line">        <span class="comment">//单向责任链这里可以不加</span></span><br><span class="line">        schoolMasterApprover.setNext(departmentApprover);</span><br><span class="line"></span><br><span class="line">        departmentApprover.processApprover(approveRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<hr>
<p>本文参考的文章：</p>
<p><a target="_blank" rel="noopener" href="http://t.csdnimg.cn/R5vsi">http://t.csdnimg.cn/R5vsi</a></p>
<p><a target="_blank" rel="noopener" href="http://t.csdnimg.cn/I42xf">http://t.csdnimg.cn/I42xf</a></p>
<p><a target="_blank" rel="noopener" href="http://t.csdnimg.cn/71wZO">http://t.csdnimg.cn/71wZO</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/04/15/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" data-id="clywa1f50003tecve0jjk0ngr" data-title="责任链模式" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-从0开始实现一个简单的增删改查" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" class="article-date">
  <time class="dt-published" datetime="2024-04-13T04:18:31.000Z" itemprop="datePublished">2024-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%BB%8F%E9%AA%8C/">技术经验</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/">从0开始实现一个简单的增删改查</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  t_requirement  </span><br><span class="line">(  </span><br><span class="line">      i_require_id      <span class="type">BIGINT</span> <span class="keyword">primary</span> key auto_increment <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;需求标识&#x27;</span>,  </span><br><span class="line">      s_title           <span class="type">VARCHAR</span>(<span class="number">256</span>) comment <span class="string">&#x27;需求标题&#x27;</span>,  </span><br><span class="line">      s_description           <span class="type">VARCHAR</span>(<span class="number">2048</span>) comment <span class="string">&#x27;需求描述&#x27;</span>,  </span><br><span class="line">      s_comment         <span class="type">VARCHAR</span>(<span class="number">1024</span>) comment <span class="string">&#x27;备注&#x27;</span>,  </span><br><span class="line">      i_source          TINYINT comment <span class="string">&#x27;需求来源 枚举，1内部、2外部&#x27;</span>,  </span><br><span class="line">      s_require_aim_meaning <span class="type">VARCHAR</span>(<span class="number">512</span>) comment <span class="string">&#x27;业务目的及意义&#x27;</span>,  </span><br><span class="line">      s_require_background_current <span class="type">VARCHAR</span>(<span class="number">512</span>) comment <span class="string">&#x27;需求背景及现状&#x27;</span>,  </span><br><span class="line">      d_post_date       DATETIME comment <span class="string">&#x27;提出时间&#x27;</span>,  </span><br><span class="line">      d_wish_date       DATETIME comment <span class="string">&#x27;期望完成时间&#x27;</span>  </span><br><span class="line">) comment <span class="string">&#x27;需求管理表&#x27;</span>;  </span><br><span class="line"><span class="keyword">alter</span>  <span class="keyword">table</span> t_requirement  <span class="keyword">add</span> <span class="keyword">constraint</span> PK_t_requient_i_requi_id426B <span class="keyword">primary</span> key (i_require_id); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用以上SQL语句，基于MySQL或其他数据库创建一个【需求管理表】。并基于该表实现基本的 新增 和 查询 业务接口，具体要求如下：</span><br><span class="line">1、数据库连接方式不限，可通过JDBC或其他业务框架实现。</span><br><span class="line">2、新增：做好接口请求参数的基本校验，包括：需求标题、需求来源为必填项，需求标题、需求描述分别不能超过20、50个字符。</span><br><span class="line">3、查询：支持通过需求标题进行模糊查询。</span><br><span class="line"></span><br><span class="line">验证：</span><br><span class="line">1、	接口必填参数未赋值时，请求返回错误状态码400，成功则返回状态码200。</span><br><span class="line">2、	新增的数据可通过查询接口进行筛选。</span><br><span class="line">3、	通过浏览器http请求或postman等工具进行验证。</span><br></pre></td></tr></table></figure>

<br>



<h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><ul>
<li>整体框架使用String Boot 加 MyBatis Plus实现</li>
<li>这里需要对字符串进行长度校验，可以通过Hibernate Validator来实现，spring-boot-starter-web集成了这个工具</li>
<li>定义Result类，用来统一返回结果</li>
<li>使用全局异常处理类来处理异常</li>
<li>定义枚举类来实现source字段</li>
</ul>
<br>



<h4 id="创建项目，引入依赖，运行SQL，编写配置"><a href="#创建项目，引入依赖，运行SQL，编写配置" class="headerlink" title="创建项目，引入依赖，运行SQL，编写配置"></a>创建项目，引入依赖，运行SQL，编写配置</h4><p>由于idea版本过高，这里创建项目时只能使用JDK 17及以上版本，创建好项目后我会在pom文件中改为JDK 8</p>
<img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240413132306576.png" alt="image-20240413132306576" style="zoom: 67%;">



<img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240413132557212.png" alt="image-20240413132557212" style="zoom:67%;">

<br>



<p>还需要而外引入的依赖有：MyBatis Plus、Lombok</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<br>



<p>运行SQL语句，创建对应的SQL表</p>
<br>



<p>创建<code>application.yaml</code>，写入相关配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/text?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;020427&quot;</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapping/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zheng.entity</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<h4 id="创建枚举类"><a href="#创建枚举类" class="headerlink" title="创建枚举类"></a>创建枚举类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Source</span> &#123;</span><br><span class="line">    INTERIOR(<span class="number">1</span>,<span class="string">&quot;内部&quot;</span>),</span><br><span class="line">    EXTERNAL(<span class="number">2</span>,<span class="string">&quot;外部&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    Source(Integer code, String value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>@EnumValue：哪个属性被标注，数据库就会保存哪个属性，由于数据库source的是tinyint类型的，这里标记code</li>
</ul>
<br>





<h4 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h4><p>hibernate validator提供了很多注解，让我们在创建实体类时，能够对其中的属性进行约束</p>
<table>
<thead>
<tr>
<th align="center">注解</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">@NotNull</td>
<td align="center">被注释的元素（任何元素）必须不为null，但集合为空也是可以的。没啥实际意义</td>
</tr>
<tr>
<td align="center">@NotEmpty</td>
<td align="center">用来校验字符串、集合、map、数组不能为null或空 （字符串传入空格也不可以）（集合需至少包含一个元素）功能强于@NotNull</td>
</tr>
<tr>
<td align="center">@NotBlank</td>
<td align="center">只用来校验字符串不为null，不为空值，不为全空格。功能强大于@NotEmpty</td>
</tr>
<tr>
<td align="center">@Size(max&#x3D;, min&#x3D;)</td>
<td align="center">指定的字符串、集合、map、数组长度必须在指定的max和min范围内。（允许元素为null，字符串允许为空格）</td>
</tr>
<tr>
<td align="center">@Length(min&#x3D;,max&#x3D;)</td>
<td align="center">只用来校验字符串，长度必须在指定的max和min范围内。（允许元素为null）</td>
</tr>
<tr>
<td align="center">@Range(min&#x3D;,max&#x3D;)</td>
<td align="center">用来校验数字或字符串的大小必须在指定的min和max范围内，字符串会转成数字进行比较，如果不是数字校验不通过。（允许元素为null）</td>
</tr>
<tr>
<td align="center">@Min()</td>
<td align="center">校验数字（包括integer、short、long、int等）的最小值，不支持小数即double和float。（允许元素为null）</td>
</tr>
<tr>
<td align="center">@Max()</td>
<td align="center">校验数字（包括integer、short、long、int等）的最大值，不支持小数即double和float。（允许元素为null）</td>
</tr>
<tr>
<td align="center">@Pattern()</td>
<td align="center">正则表达式匹配，可用来校验年月日格式是否包含特殊字符</td>
</tr>
<tr>
<td align="center">@Valid</td>
<td align="center">递归的对关联对象进行校验，如果关联对象是个集合或者数组，那么对其中的元素进行递归校验，如果是一个map，则对其中的值部分进行校验</td>
</tr>
</tbody></table>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.entity;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_requirement&quot;)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Requirement</span> &#123;</span><br><span class="line">    <span class="meta">@TableField(&quot;i_require_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer requireId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;s_title&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;标题不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 1, max = 20, message = &quot;需求标题不能超过20个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Length(max = 50, message = &quot;需求描述不能超过50个字符&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(&quot;s_description&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;s_comment&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;需求源不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(&quot;i_source&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Source source;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;s_require_aim_meaning&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String requireAmiMeaning;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;s_require_background_current&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String requireBackgroundCurrent;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;d_post_date&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date postDate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;d_wish_date&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date wishDate;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<h4 id="创建统一返回结果类"><a href="#创建统一返回结果类" class="headerlink" title="创建统一返回结果类"></a>创建统一返回结果类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 成功响应，不带数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">Success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>, <span class="string">&quot;success&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 成功响应，带数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">Success</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>, <span class="string">&quot;success&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 错误响应</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">Error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">400</span>, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<h4 id="创建全局异常处理类"><a href="#创建全局异常处理类" class="headerlink" title="创建全局异常处理类"></a>创建全局异常处理类</h4><p>用来处理，必填字段非空，或者字段超出长度限制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&gt; <span class="title function_">handleValidationExceptions</span><span class="params">(MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取验证失败的错误信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> ex.getBindingResult().getFieldError().getDefaultMessage();</span><br><span class="line">        <span class="comment">// 创建一个Result对象</span></span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> Result.Error(errorMessage);</span><br><span class="line">        <span class="comment">// 返回状态码400和Result对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(result, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<h4 id="controller层"><a href="#controller层" class="headerlink" title="controller层"></a>controller层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/requirement&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequirementController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RequirementService requirementService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RequirementController</span><span class="params">(RequirementService requirementService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.requirementService = requirementService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 创建新需求信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">private</span> Result <span class="title function_">create</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> Requirement requirement)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> requirementService.create(requirement);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 查询需求信息，可以根据title模糊查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping()</span></span><br><span class="line">    <span class="keyword">private</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String title)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> requirementService.get(title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<br>





<h4 id="service层"><a href="#service层" class="headerlink" title="service层"></a>service层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RequirementService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Requirement&gt; &#123;</span><br><span class="line">    Result <span class="title function_">create</span><span class="params">(Requirement requirement)</span>;</span><br><span class="line"></span><br><span class="line">    Result <span class="title function_">get</span><span class="params">(String title)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequirementServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RequirementMapper, Requirement&gt; <span class="keyword">implements</span> <span class="title class_">RequirementService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RequirementMapper requirementMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">create</span><span class="params">(Requirement requirement)</span> &#123;</span><br><span class="line">        requirementMapper.insert(requirement);</span><br><span class="line">        <span class="keyword">return</span> Result.Success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Requirement&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (title != <span class="literal">null</span>) &#123;</span><br><span class="line">            wrapper.like(<span class="string">&quot;s_title&quot;</span>, title);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Requirement&gt; requirements = requirementMapper.selectList(wrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.Success(requirements);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<h4 id="mapper层"><a href="#mapper层" class="headerlink" title="mapper层"></a>mapper层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RequirementMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Requirement&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<h4 id="POM文件"><a href="#POM文件" class="headerlink" title="POM文件"></a>POM文件</h4><p>编写代码的过程中可能又引入了一些依赖，这里给出所有依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">2.7</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.zheng&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;Interview&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;Interview&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;Interview&lt;/description&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;<span class="number">8</span>&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">3.5</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">6.2</span><span class="number">.0</span>.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<br>







<h4 id="整体项目架构图"><a href="#整体项目架构图" class="headerlink" title="整体项目架构图"></a>整体项目架构图</h4><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414002819319.png" alt="image-20240414002819319" style="zoom:67%;">

<br>









<h4 id="新增测试"><a href="#新增测试" class="headerlink" title="新增测试"></a>新增测试</h4><p><code>没有输入标题</code>，提示标题不能为空，符合要求</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414001806984.png"></p>
<br>





<p><code>没有输入需求来源</code>，提示需求源不能为空，符合要求</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414001822909.png"></p>
<br>





<p><code>标题长度超过20个字符</code>，输出需求标题不能超过20个字符，符合要求</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414001840737.png"></p>
<br>





<p><code>需求描述超过50个字符</code>，提示需求描述不能超过50个字符</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414001920510.png"></p>
<br>







<p><code>输入符合要求的数据</code>，返回200，保存成功</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414002022914.png" alt="image-20240414002022914"></p>
<br>







<h4 id="模糊查询测试"><a href="#模糊查询测试" class="headerlink" title="模糊查询测试"></a>模糊查询测试</h4><p>现在数据库中的数据</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414002133690.png"></p>
<br>



<p><code>测试不输入title</code>,也就是查询所有，总共6条数据，符合要求</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414002354547.png" alt="image-20240414002354547"></p>
<br>







<p><code>根据Title模糊查询</code>，添加Title，值为<code>测试</code>，共查询到两条数据，符合要求</p>
<p><img src="/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/image-20240414002528719.png" alt="image-20240414002528719"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/04/13/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" data-id="clywa1f4p002decve0r4teiws" data-title="从0开始实现一个简单的增删改查" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-RabbitMQ" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/26/RabbitMQ/" class="article-date">
  <time class="dt-published" datetime="2024-03-26T06:31:25.000Z" itemprop="datePublished">2024-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/26/RabbitMQ/">RabbitMQ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>再一次学习和巩固RabbitMQ的知识，这次学习参考的视频是<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mN4y1Z7t9?vd_source=db8e7458ec195ac74979ce5478cbc624">黑马RabbitMQ</a></p>
<hr>
<h3 id="一-MQ基础"><a href="#一-MQ基础" class="headerlink" title="一. MQ基础"></a>一. MQ基础</h3><h4 id="1-初步认识MQ"><a href="#1-初步认识MQ" class="headerlink" title="1. 初步认识MQ"></a>1. 初步认识MQ</h4><p><strong>同步调用</strong></p>
<p>同步调用是最基本并且最简单的一种调用方式，类 A 的 a() 调用类 B 的 b()，一直等待 b() 执行完毕，a() 继续往下走。<code>该调用方式适用于 b() 执行时间不长的情况</code>，因为 b() 执行时间过长或者直接阻塞的话，a() 的余下代码是无法执行下去的，这样会造成整个流程的阻塞。<br>对于一些业务，它们之间是有前后关系的，必须使用同步调用，如在支付服务中，在用户进行支付后，就要进行扣减余额，这里的用户字符和扣减余额就是同步调用</p>
<br>



<p><strong>异步调用</strong></p>
<p>异步调用是为了解决同步调用可能出现阻塞，导致整个流程卡住而产生的一种调用方式，可以创建新的线程来对这些方法或接口进行调用<br>如在支付服务中，在用户进行支付后，更新订单状态可以创建新的线程来执行，也就是异步调用</p>
<br>



<img src="/2024/03/26/RabbitMQ/image-20240609160959707.png" alt="image-20240609160959707" style="zoom:67%;">

<br>



<p><strong>异步调用的作用</strong></p>
<p>以上面的案例为例，对部分业务采取异步调用的方式，支付服务不在同步调用业务关联度低的服务，而是发送消息到Broker</p>
<p>采取这种方案所具备的优势：</p>
<ul>
<li>解除耦合，拓展性强：将哪些与主业务隔关联性不是特别强的业务采用异步调用的方式调用，这样就不会影响到主业务，同时需要扩展相关业务时，如果与主业务关联性不强，只需要同其他业务一样，监听主业务发送的消息，通过消息代理获取到对应的消息并异步调用即可</li>
<li>无需等待，性能好：异步调用的业务所消耗的时间不会影响主业务的响应，减低了主业务的响应时间</li>
<li>故障隔离：异步调用业务之间都是相互隔离的，与主业务也是相互隔离的，发生故障后不会影响其他业务</li>
<li>缓存消息，流量削峰填谷：在流量峰值较大的时候，这些异步调用的业务会按部读取消息代理中的消息进行消费，减轻的整个业务的压力</li>
</ul>
<br>

<img src="/2024/03/26/RabbitMQ/image-20240609162419646.png" alt="image-20240609162419646" style="zoom:67%;">

<br>



<p><strong>异步调用的缺点</strong></p>
<ul>
<li>不能立即得到调用结果，时效性查</li>
<li>不确定下游业务执行是否成功</li>
<li>业务安全依赖于Broker的可靠性</li>
</ul>
<br>



<hr>
<h4 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h4><p><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">官方文档</a></p>
<p>把RabbitMQ安装到Linux中</p>
<p>先使用docker拉取RabbitMQ镜像，我这里是直接从本地上传的</p>
<img src="/2024/03/26/RabbitMQ/image-20240609165721712.png" alt="image-20240609165721712" style="zoom:67%;">

<br>



<p>创建MQ容器</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=zheng \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123456 \</span><br><span class="line"> -v mq-plugins:/plugins \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> --network hmall \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3.8-management</span><br></pre></td></tr></table></figure>

<br>



<p>这里的network网络要提前创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create hamll</span><br></pre></td></tr></table></figure>

<br>



<p>如果15672端口无法访问可能是服务器未关闭，或者mq的插件没有启动</p>
<p>启动插件需要进入到RabbitMQ的内部</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mq的Id /bin/bish</span><br></pre></td></tr></table></figure>

<p>进入到rabbitmq容器内部后执行下面的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<br>



<p>然后就可以访问15672端口，并登录</p>
<img src="/2024/03/26/RabbitMQ/image-20240610222304340.png" alt="image-20240610222304340" style="zoom: 50%;">

<br>



<img src="/2024/03/26/RabbitMQ/image-20240610222414057.png" alt="image-20240610222414057" style="zoom:50%;">

<br>



<p><strong>RabbitMQ的整体框架及核心概念：</strong></p>
<ul>
<li>virtual-host：虚拟主机，起到数据隔离的作用</li>
<li>publisher：消息发送者</li>
<li>consumer：消息的消费者</li>
<li>queue：队列，存储消息</li>
<li>exchange：交换机，负责路由消息</li>
</ul>
<img src="/2024/03/26/RabbitMQ/image-20240610223252726.png" alt="image-20240610223252726" style="zoom:67%;">

<br>



<hr>
<h4 id="3-快速入门"><a href="#3-快速入门" class="headerlink" title="3. 快速入门"></a>3. 快速入门</h4><p>先在Web端创建一个队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611135716392.png" alt="image-20240611135716392" style="zoom: 50%;">

<br>



<p>打开idea并创建项目，导入依赖，这里的快速入门使用Spring AMQP来演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--AMQP依赖，包含RabbitMQ--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--单元测试--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--Jackson--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br></pre></td></tr></table></figure>

<br>



<p>创建消费者和生产者两个模块</p>
<p><img src="/2024/03/26/RabbitMQ/image-20240611140028045.png" alt="image-20240611140028045"></p>
<br>



<p><strong>生产者</strong></p>
<p>在测试类中写入信息，先编写配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">pattern</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">dateformat</span>: <span class="string">MM-dd HH:mm:ss:SSS</span></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">rabbitmq</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">192.168.200.128</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">5672</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">admin</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">123456</span></span><br></pre></td></tr></table></figure>

<br>



<p>在编写测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSendMessage2Queue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello, amqp!&quot;</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>运行该测试方法后，可以在Web端看见队列simple.queue存在一条未消费的消息</p>
<img src="/2024/03/26/RabbitMQ/image-20240611140407088.png" alt="image-20240611140407088" style="zoom:50%;">

<br>



<p>还可以获取到消息的详细信息</p>
<img src="/2024/03/26/RabbitMQ/image-20240611140458655.png" alt="image-20240611140458655" style="zoom: 50%;">

<br>



<p><strong>消费者</strong></p>
<p>先编写消费者的配置信息</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">pattern</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">dateformat</span>: <span class="string">MM-dd HH:mm:ss:SSS</span></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">rabbitmq</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">192.168.200.128</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">5672</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">admin</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">123456</span></span><br></pre></td></tr></table></figure>

<br>



<p>编写消费类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueue</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者收到了simple.queue的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>启动消费者模块，可以看到消息被获取到</p>
<img src="/2024/03/26/RabbitMQ/image-20240611140743983.png" alt="image-20240611140743983" style="zoom:50%;">

<br>



<p>消息队列中的也不存在未消费的消息了</p>
<img src="/2024/03/26/RabbitMQ/image-20240611140826532.png" alt="image-20240611140826532" style="zoom:50%;">

<br>



<p><strong>SpringAMQP如何收发消息</strong></p>
<ol>
<li>引入spring-boot-starter-amqp的依赖</li>
<li>配置rabbitmq服务端信息</li>
<li>利用RabbitTemplate发送消息</li>
<li>利用@RabbitListener注解声明要监听的队列，监听消息</li>
</ol>
<br>



<hr>
<h4 id="4-work模型"><a href="#4-work模型" class="headerlink" title="4. work模型"></a>4. work模型</h4><p>Work queues，任务模型。简单来说就是<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong></p>
<br>



<p><strong>案例：模仿WorkQueue，实现一个队列绑定多个消费者</strong></p>
<p>实现思路：</p>
<ol>
<li>在RabbitMQ的控制台创建一个队列，名为work.queue</li>
<li>在publisher服务中定义测试方法，批量生成50条消息，发送到work.queue中</li>
<li>在consumer服务中定义两个消息监听者，都监听work.queue队列</li>
<li>模拟不同能力的消费者<ul>
<li>消费者1和消费者2处理信息的能力一样</li>
<li>消费者1处理信息的能力是消费者2的10倍</li>
<li>通过给消费者增加延时来模仿不同消费者的能力</li>
</ul>
</li>
</ol>
<br>



<p>先在Web端控制台创建队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611144003864.png" alt="image-20240611144003864" style="zoom: 67%;">

<br>



<p>创建测试方法，批量生成消息，发送到work.queue队列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;work.queue&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello, worker, message_&quot;</span> + i;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, msg);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>模拟第一种情况，两个消费者消费能力相同</strong></p>
<p>创建两个消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1 收到了 work.queue的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;消费者2 收到了 work.queue的消息...... ：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>运行消费者模块，接收并消费消息<br>通过消费结果可以获得几个结论</p>
<ul>
<li>多个消费者绑定到同一个队列时，队列中的一条消息只会被一个消费者消费，不会重复消费</li>
<li>这些消费者之间默认通过轮询的方式来消费这些消息</li>
</ul>
<img src="/2024/03/26/RabbitMQ/image-20240611144352430.png" alt="image-20240611144352430" style="zoom: 67%;">

<br>





<p>当消费者之间的性能相差过大时，这种轮询的方式就会出现弊端</p>
<p><strong>模拟第二种情况，消费者1的能力是消费者2的10倍</strong></p>
<img src="/2024/03/26/RabbitMQ/image-20240611144815403.png" alt="image-20240611144815403" style="zoom:67%;">

<br>



<p>重启消费者模块，再次发送消息</p>
<img src="/2024/03/26/RabbitMQ/image-20240611145002934.png" alt="image-20240611145002934" style="zoom:80%;">

<p>从测试结果可以看出，消费者1很快就消费了自己该消费的信息，而消费者2则大大的影响了整体速度，<code>产生了消息堆积</code>。所以在消费者的消费能力相差过大时，不能使用轮询的方式，<code>可以通过更改配置文件，来指定一个消费者最多能同时消费消息的数量</code>来解决这个问题</p>
<br>



<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listener</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">simple</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">prefetch</span>: <span class="string">1 # 每次只能获取一条消息，处理完才能获取下一个消息</span></span><br></pre></td></tr></table></figure>

<br>



<p>更改完配置后再次测试,这样就解决了消息堆积的问题</p>
<img src="/2024/03/26/RabbitMQ/image-20240611145500584.png" alt="image-20240611145500584" style="zoom:80%;">

<br>



<p><strong>Work模型的使用</strong></p>
<ul>
<li>多个消费者绑定到一个队列，可以加快消息处理速度</li>
<li>同一条消息只会被一个消费者处理</li>
<li>通过设置prefetch来控制消费者预取的消息数量，处理完一条消息再处理下一条</li>
</ul>
<br>



<hr>
<h4 id="5-Fanout交换机"><a href="#5-Fanout交换机" class="headerlink" title="5. Fanout交换机"></a>5. Fanout交换机</h4><p>一般的消息都不是有生产者直接发送给队列的，而是生产者发送给交换机，交换机再转发到对应的队里中去</p>
<p>交换机有3种：Fanout广播，Direct定向，Topic话题</p>
<br>



<p>Fanout交换机也叫广播交换机，会将接收到的消息广播到每一个跟其绑定的queue</p>
<img src="/2024/03/26/RabbitMQ/image-20240611151140606.png" alt="image-20240611151140606" style="zoom:67%;">

<br>



<p><strong>利用SpringAMQP演示FanoutExchange的使用</strong></p>
<p>实现思路</p>
<pre><code>1. 在RabbitMQ控制台中，声明队列fanout.queue1和fanout.queue2
1. 在RabbitMQ控制台中，声明交换机hmall.fanout，同时绑定上面声明的两个队列
1. 在consumer服务中，编写两个消费者方法，分别监听队列1和队列2
1. 在publisher中编写测试方法，向交换机中发送消息
</code></pre>
<br>



<p>创建队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611151717399.png" alt="image-20240611151717399" style="zoom: 50%;">

<br>



<p>创建交换机</p>
<img src="/2024/03/26/RabbitMQ/image-20240611151843693.png" alt="image-20240611151843693" style="zoom: 50%;">

<br>



<p>绑定交换机和队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611152018670.png" alt="image-20240611152018670" style="zoom:67%;">

<br>



<p>编写消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1 收到了 fanout.queue1的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2 收到了 fanout.queue2的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>编写生产者方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSendFanout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.fanout&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="literal">null</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试</p>
<p>从测试结果可以看出这两个消息队列都从交换机接收到了消息</p>
<img src="/2024/03/26/RabbitMQ/image-20240611152234361.png" alt="image-20240611152234361" style="zoom:67%;">

<br>



<p>总结</p>
<p>交换机的作用是什么？</p>
<ul>
<li>接收publisher发送的消息</li>
<li>将消息按照规则路由到与之绑定的队列</li>
<li>不能缓存消息，路由失败，消息丢失</li>
<li>FanoutExchange的会将消息路由到每个绑定的队列</li>
</ul>
<br>



<hr>
<h4 id="6-Direct交换机"><a href="#6-Direct交换机" class="headerlink" title="6. Direct交换机"></a>6. Direct交换机</h4><p>在Fanout模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到Direct类型的Exchange</p>
<img src="/2024/03/26/RabbitMQ/image-20240611152722392.png" alt="image-20240611152722392" style="zoom:67%;">

<br>



<p>在Direct模型下：</p>
<ul>
<li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li>
<li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li>
<li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code>与消息的 <code>Routing key</code>完全一致，才会接收到消息</li>
</ul>
<br>



<p><strong>案例：利用SpringAMQP演示DirectExchange的使用</strong></p>
<ol>
<li>声明一个名为<code>hmall.direct</code>的交换机</li>
<li>声明队列<code>direct.queue1</code>，绑定<code>hmall.direct</code>，<code>bindingKey</code>为<code>blud</code>和<code>red</code></li>
<li>声明队列<code>direct.queue2</code>，绑定<code>hmall.direct</code>，<code>bindingKey</code>为<code>yellow</code>和<code>red</code></li>
<li>在<code>consumer</code>服务中，编写两个消费者方法，分别监听direct.queue1和direct.queue2 </li>
<li>在publisher中编写测试方法，向<code>hmall.direct</code>发送消息</li>
</ol>
<br>



<p>创建队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611153045141.png" alt="image-20240611153045141" style="zoom: 50%;">

<br>



<p>创建交换机</p>
<img src="/2024/03/26/RabbitMQ/image-20240611153136259.png" alt="image-20240611153136259" style="zoom: 50%;">

<br>



<p>绑定交换机和队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611153350512.png" alt="image-20240611153350512" style="zoom:80%;">

<br>



<p>编写消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue1&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">      	System.out.println(<span class="string">&quot;消费者1 收到了 direct.queue1的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line"> 	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue1&quot;)</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者2 收到了 direct.queue2的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">  	&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>编写生产者方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSendDirect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg1</span> <span class="operator">=</span> <span class="string">&quot;红色警报，由于日本排放核污水，惊险哥斯拉&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg2</span> <span class="operator">=</span> <span class="string">&quot;蓝色通知，警报解除，哥斯拉是放的气球&quot;</span>;</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, msg1);</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;blue&quot;</span>, msg2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试</p>
<img src="/2024/03/26/RabbitMQ/image-20240611154049240.png" alt="image-20240611154049240" style="zoom:67%;">

<br>



<p><strong>Direct交换机与Fanout交换机的差异</strong></p>
<ul>
<li>Fanout交换机将消息路由给每一个与之绑定的队列</li>
<li>Direct交换机根据RoutingKey判断路由给哪个队列</li>
<li>如果多个队列具有相同的RoutingKey，则与Fanout功能类似</li>
</ul>
<hr>
<h4 id="7-Topic交换机"><a href="#7-Topic交换机" class="headerlink" title="7. Topic交换机"></a>7. Topic交换机</h4><p><code>Topic</code>类型的<code>Exchange</code>与<code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。<br>只不过<code>Topic</code>类型<code>Exchange</code>可以让队列在绑定<code>BindingKey</code> 的时候使用通配符！</p>
<p><code>BindingKey</code> 一般都是有一个或多个单词组成，多个单词之间以<code>.</code>分割，例如： <code>item.insert</code></p>
<p>通配符规则：</p>
<ul>
<li><code>#</code>：匹配一个或多个词</li>
<li><code>*</code>：匹配不多不少恰好1个词</li>
</ul>
<p>举例：</p>
<ul>
<li><code>item.#</code>：能够匹配<code>item.spu.insert</code> 或者 <code>item.spu</code></li>
<li><code>item.*</code>：只能匹配<code>item.spu</code></li>
</ul>
<br>



<img src="/2024/03/26/RabbitMQ/image-20240611154708838.png" alt="image-20240611154708838" style="zoom:67%;">

<br>



<p>假如此时publisher发送的消息使用的<code>RoutingKey</code>共有四种：</p>
<ul>
<li><code>china.news </code>代表有中国的新闻消息；</li>
<li><code>china.weather</code> 代表中国的天气消息；</li>
<li><code>japan.news</code> 则代表日本新闻</li>
<li><code>japan.weather</code> 代表日本的天气消息；</li>
</ul>
<p>解释：</p>
<ul>
<li><code>topic.queue1</code>：绑定的是<code>china.#</code> ，凡是以 <code>china.</code>开头的<code>routing key</code> 都会被匹配到，包括：<ul>
<li><code>china.news</code></li>
<li><code>china.weather</code></li>
</ul>
</li>
<li><code>topic.queue2</code>：绑定的是<code>#.news</code> ，凡是以 <code>.news</code>结尾的 <code>routing key</code> 都会被匹配。包括:<ul>
<li><code>china.news</code></li>
<li><code>japan.news</code></li>
</ul>
</li>
</ul>
<br>



<p><strong>案例：利用SpringAMQP演示DirectExchange的使用</strong></p>
<p>需求：</p>
<ol>
<li>在RabbitMQ控制台中，声明队列topic.queue1和topic.queue2</li>
<li>在RabbitMQ控制台中，声明交换机hmall.topic，将两个队列与其绑定</li>
<li>在consumer服务中，编写两个消费者方法，分别监听topic.queue1和topic.queue2</li>
<li>在publisher中编写测试方法，利用不同的RoutingKey向hmall.topic发送消息</li>
</ol>
<br>



<p>创建队列</p>
<img src="/2024/03/26/RabbitMQ/image-20240611155152275.png" alt="image-20240611155152275" style="zoom: 50%;">

<br>



<p>创建交换机</p>
<img src="/2024/03/26/RabbitMQ/image-20240611155258502.png" alt="image-20240611155258502" style="zoom:67%;">

<br>



<p>绑定交换机和队列</p>
<p><img src="/2024/03/26/RabbitMQ/image-20240611155505024.png" alt="image-20240611155505024"></p>
<br>



<p>编写消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1 收到了 topic.queue1的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2 收到了 topic.queue2的消息：【&quot;</span> + msg +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>编写生产者方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSendTopic</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.topic&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg1</span> <span class="operator">=</span> <span class="string">&quot;这条消息是china.a&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg2</span> <span class="operator">=</span> <span class="string">&quot;这条消息是b.news&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg3</span> <span class="operator">=</span> <span class="string">&quot;这条消息是china.news&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.a&quot;</span>, msg1);</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;b.news&quot;</span>, msg2);</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, msg3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/26/RabbitMQ/image-20240611160011008.png" alt="image-20240611160011008" style="zoom:80%;">

<br>



<p><strong>Direct交换机与Topic交换机的差异</strong></p>
<ul>
<li>Topic交换机接收的消息RoutingKey必须是多个单词，以 <code>**.**</code> 分割</li>
<li>Topic交换机与队列绑定时的bindingKey可以指定通配符</li>
<li><code>#</code>：代表0个或多个词</li>
<li><code>*</code>：代表1个词</li>
</ul>
<br>



<hr>
<h4 id="8-声明队列和交换机"><a href="#8-声明队列和交换机" class="headerlink" title="8. 声明队列和交换机"></a>8. 声明队列和交换机</h4><p>未完待续</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/03/26/RabbitMQ/" data-id="clywa1f4a0011ecvee5r10fuc" data-title="RabbitMQ" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-EasyExcel" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/16/EasyExcel/" class="article-date">
  <time class="dt-published" datetime="2024-03-16T05:11:51.000Z" itemprop="datePublished">2024-03-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/16/EasyExcel/">Apache poi 和 EasyExcel</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>该笔记学习b站视频制作而成：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ua4y1x7BK/?share_source=copy_web&vd_source=db8e7458ec195ac74979ce5478cbc624">POI</a>，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ff4y1U7Qc/?share_source=copy_web&vd_source=db8e7458ec195ac74979ce5478cbc624">EasyExcel</a></p>
<h3 id="一-简介"><a href="#一-简介" class="headerlink" title="一. 简介"></a>一. 简介</h3><p>Java解析、生成Excel比较有名的框架有Apache poi、jxl。但他们都存在一个严重的问题就是非常的耗内存，poi有一套SAX模式的API可以一定程度的解决一些内存溢出的问题，但POI还是有一些缺陷，比如07版Excel解压缩以及解压后存储都是在内存中完成的，内存消耗依然很大。<br>easyexcel重写了poi对07版Excel的解析，一个3M的excel用POI sax解析依然需要100M左右内存，改用easyexcel可以降低到几M，并且再大的excel也不会出现内存溢出；03版依赖POI的sax模式，在上层做了模型转换的封装，让使用者更加简单方便</p>
<p>EasyExcel能大大减少内存的原因是在解析Excel时没有将文件数据一次性全部加载到内存中，而是从磁盘上一行一行读取数据，逐个解析</p>
<br>



<p>下图是EasyExcel和POl在解析Excel时的对比图</p>
<img src="/2024/03/16/EasyExcel/image-20240316133120557.png" alt="image-20240316133120557" style="zoom:80%;">

<br>



<hr>
<h3 id="二-Apache-poi"><a href="#二-Apache-poi" class="headerlink" title="二. Apache poi"></a>二. Apache poi</h3><h4 id="1-Excel基本写操作"><a href="#1-Excel基本写操作" class="headerlink" title="1. Excel基本写操作"></a>1. Excel基本写操作</h4><p>创建项目并导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--xls（03版本）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--xlsx（07版本）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日期格式化工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>Excel的结构</strong></p>
<img src="/2024/03/16/EasyExcel/image-20240318134425789.png" alt="image-20240318134425789" style="zoom: 50%;">

<br>



<p>Excel有03版(xls)和07版(xlsx)，03版的一个表最多有65536行</p>
<br>



<p>在idea中创建Excel表会有03版和07版两个版本</p>
<p>创建工作簿时使用<code>WorkBook</code>接口的实现类</p>
<img src="/2024/03/16/EasyExcel/image-20240318135330304.png" alt="image-20240318135330304" style="zoom:67%;">

<br>



<p>07版的操作方法和03版的一模一样，只需要在创建WorkBook对象时使用07版的实现类即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelWrite</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03版</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrite03</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 1.创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">// 2.创建一个工作表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;216寝室登记表&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.创建一个行 第一行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>); <span class="comment">// 从0开始</span></span><br><span class="line">        <span class="comment">// 4.创建一个第一个 第一行第一个（0,0）</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell11</span> <span class="operator">=</span> row1.createCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 添加信息</span></span><br><span class="line">        cell11.setCellValue(<span class="string">&quot;学生姓名&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (1,2)</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell12</span> <span class="operator">=</span> row1.createCell(<span class="number">1</span>);</span><br><span class="line">        cell12.setCellValue(<span class="string">&quot;出生日期&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2.1)</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row2</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell21</span> <span class="operator">=</span> row2.createCell(<span class="number">0</span>);</span><br><span class="line">        cell21.setCellValue(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2,2)</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell22</span> <span class="operator">=</span> row2.createCell(<span class="number">1</span>);</span><br><span class="line">        cell22.setCellValue(<span class="string">&quot;2000-1-1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过IO流生成表， 03版的使用xls结尾</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(PATH + <span class="string">&quot;寝室登记表03.xls&quot;</span>);</span><br><span class="line">        workbook.write(fileOutputStream);</span><br><span class="line">        <span class="comment">// 关闭流</span></span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;寝室表生成成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 07版</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrite07</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 1.创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">// 2.创建一个工作表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;217寝室登记表&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.创建一个行 第一行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>); <span class="comment">// 从0开始</span></span><br><span class="line">        <span class="comment">// 4.创建一个第一个 第一行第一个（0,0）</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell11</span> <span class="operator">=</span> row1.createCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 添加信息</span></span><br><span class="line">        cell11.setCellValue(<span class="string">&quot;学生姓名&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (1,2)</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell12</span> <span class="operator">=</span> row1.createCell(<span class="number">1</span>);</span><br><span class="line">        cell12.setCellValue(<span class="string">&quot;出生日期&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2.1)</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row2</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell21</span> <span class="operator">=</span> row2.createCell(<span class="number">0</span>);</span><br><span class="line">        cell21.setCellValue(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2,2)</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell22</span> <span class="operator">=</span> row2.createCell(<span class="number">1</span>);</span><br><span class="line">        cell22.setCellValue(<span class="string">&quot;2000-2-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过IO流生成表， 03版的使用xls结尾</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(PATH + <span class="string">&quot;寝室登记表07.xlsx&quot;</span>);</span><br><span class="line">        workbook.write(fileOutputStream);</span><br><span class="line">        <span class="comment">// 关闭流</span></span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;寝室表生成成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p><font color="red">注意对象的区别和文件名后缀</font></p>
<p>运行后会获得03版和07版的两个Excel表</p>
<p><img src="/2024/03/16/EasyExcel/image-20240318141255081.png" alt="image-20240318141255081"></p>
<img src="/2024/03/16/EasyExcel/image-20240318141333514.png" alt="image-20240318141333514" style="zoom:50%;">

<img src="/2024/03/16/EasyExcel/image-20240318141400067.png" alt="image-20240318141400067" style="zoom:50%;">

<br>



<hr>
<h4 id="2-大数据量的写入"><a href="#2-大数据量的写入" class="headerlink" title="2. 大数据量的写入"></a>2. 大数据量的写入</h4><ul>
<li><p>大文件写<code>HSSF</code>(03版)</p>
<ul>
<li><p>缺点：最多只能处理65536行，否则会抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: Invalid row <span class="title function_">number</span> <span class="params">(<span class="number">65536</span>)</span> outside allowable <span class="title function_">range</span> <span class="params">(<span class="number">0.</span><span class="number">.65536</span>)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>优点：过程中写入缓存，不操作磁盘，最后一次性写入磁盘，速度快</p>
</li>
</ul>
</li>
<li><p>大文件写<code>XSSF</code>(07版)</p>
<ul>
<li>缺点：写数据时速度非常慢，非常消耗内存，也会发生内存溢出，如100万条</li>
<li>优点：可以写较大的数据量，如20万条</li>
</ul>
</li>
<li><p>大文件写<code>SXSSF</code>(07版)</p>
<ul>
<li>优点：可以写非常大的数据量，如100万条甚至更多条，写数据速度快，占用更少的内存</li>
<li>注意：过程会产生临时文件，需要清理临时文件。默认由100条记录被保存在内存中，如果超过这个数量，则最前面的数据被写入临时文件。如果想自定义内存中的数据的数量，可以使用new SXSSFWorkbook(数量)</li>
</ul>
</li>
</ul>
<br>



<p><strong>大数据量写HSSF代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelWriteTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\esayexcel&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWriteBigData03</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 开始时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">// 创建表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workBook.createSheet();</span><br><span class="line">        <span class="comment">// 写入数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">0</span>; rowNum &lt; <span class="number">65536</span>; rowNum++) &#123;</span><br><span class="line">            <span class="comment">// 创建行</span></span><br><span class="line">            <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(rowNum);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">cellNum</span> <span class="operator">=</span> <span class="number">0</span>; cellNum &lt; <span class="number">10</span>; cellNum++) &#123;</span><br><span class="line">                <span class="comment">// 创建单元格</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.createCell(cellNum);</span><br><span class="line">                cell.setCellValue(cellNum); <span class="comment">// 输入数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用IO流</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(PATH + <span class="string">&quot;testWriteBigData03.xls&quot;</span>);</span><br><span class="line">        workBook.write(fileOutputStream);</span><br><span class="line">        fileOutputStream.close(); <span class="comment">// 关闭流</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;over&quot;</span>);</span><br><span class="line">        System.out.println((<span class="type">double</span>) (endTime-beginTime)/<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/16/EasyExcel/image-20240318161147364.png" alt="image-20240318161147364" style="zoom:67%;">

<img src="/2024/03/16/EasyExcel/image-20240318161223172.png" alt="image-20240318161223172" style="zoom: 50%;">

<br>



<p>超过65536行数据会报错</p>
<img src="/2024/03/16/EasyExcel/image-20240318161344015.png" alt="image-20240318161344015" style="zoom: 50%;">

<br>



<p><strong>大数据量写XSSF代码实现</strong></p>
<p>这里写入的行数是65537行，超过了65536</p>
<p>虽然XSSF可以写入更多的数据，但是速度明显变慢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelWriteTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\esayexcel&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWriteBigData07</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 开始时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">// 创建表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workBook.createSheet();</span><br><span class="line">        <span class="comment">// 写入数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">0</span>; rowNum &lt; <span class="number">65537</span>; rowNum++) &#123;</span><br><span class="line">            <span class="comment">// 创建行</span></span><br><span class="line">            <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(rowNum);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">cellNum</span> <span class="operator">=</span> <span class="number">0</span>; cellNum &lt; <span class="number">10</span>; cellNum++) &#123;</span><br><span class="line">                <span class="comment">// 创建单元格</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.createCell(cellNum);</span><br><span class="line">                cell.setCellValue(cellNum); <span class="comment">// 输入数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用IO流</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(PATH + <span class="string">&quot;testWriteBigData07.xlsx&quot;</span>);</span><br><span class="line">        workBook.write(fileOutputStream);</span><br><span class="line">        fileOutputStream.close(); <span class="comment">// 关闭流</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;over&quot;</span>);</span><br><span class="line">        System.out.println((<span class="type">double</span>) (endTime-beginTime)/<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2024/03/16/EasyExcel/image-20240318161820172.png" alt="image-20240318161820172" style="zoom:67%;">

<img src="/2024/03/16/EasyExcel/image-20240318161857515.png" alt="image-20240318161857515" style="zoom:50%;">

<br>



<p><strong>大数据量写SXSSF的代码实现</strong></p>
<p>这里相比于上面两种，多了一个清除临时文件的操作</p>
<p>((SXSSFWorkbook) workBook).dispose(); &#x2F;&#x2F; 清除临时文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelWriteTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\esayexcel&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWriteBigDataS07</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 开始时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SXSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">// 创建表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workBook.createSheet();</span><br><span class="line">        <span class="comment">// 写入数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">0</span>; rowNum &lt; <span class="number">100000</span>; rowNum++) &#123;</span><br><span class="line">            <span class="comment">// 创建行</span></span><br><span class="line">            <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(rowNum);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">cellNum</span> <span class="operator">=</span> <span class="number">0</span>; cellNum &lt; <span class="number">10</span>; cellNum++) &#123;</span><br><span class="line">                <span class="comment">// 创建单元格</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.createCell(cellNum);</span><br><span class="line">                cell.setCellValue(cellNum); <span class="comment">// 输入数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用IO流</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(PATH + <span class="string">&quot;testWriteBigDataS07.xlsx&quot;</span>);</span><br><span class="line">        workBook.write(fileOutputStream);</span><br><span class="line">        fileOutputStream.close(); <span class="comment">// 关闭流</span></span><br><span class="line">        </span><br><span class="line">        ((SXSSFWorkbook) workBook).dispose(); <span class="comment">// 清除临时文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;over&quot;</span>);</span><br><span class="line">        System.out.println((<span class="type">double</span>) (endTime-beginTime)/<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>可以看见写入10万条数据只用了1.666s，速度提升非常大</p>
<p><img src="/2024/03/16/EasyExcel/image-20240318163006705.png" alt="image-20240318163006705"></p>
<img src="/2024/03/16/EasyExcel/image-20240318163108261.png" alt="image-20240318163108261" style="zoom:50%;">

<br>



<hr>
<h4 id="3-Excel基本读取"><a href="#3-Excel基本读取" class="headerlink" title="3. Excel基本读取"></a>3. Excel基本读取</h4><p><code>在使用读取单元格的值时，不同的数据类型对应着不同的值</code></p>
<p><strong>HSSF读的代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelReadTest</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead03</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建一个输入流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(PATH + <span class="string">&quot;寝室登记表03.xls&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 创建工作簿，使用Excel能操作的它都可以操作</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>(inputStream);</span><br><span class="line">        <span class="comment">// 2. 获取工作表，第一个表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 3. 获取行，第一行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 4. 获取单元格，第一个单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.getCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取字符串类型的值</span></span><br><span class="line">        System.out.print(<span class="string">&quot;获取寝室登记表03.xls的第一行第一个单元格的值：&quot;</span>);</span><br><span class="line">        System.out.println(cell.getStringCellValue());</span><br><span class="line">        <span class="comment">// 关闭流</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/16/EasyExcel/image-20240318170840559.png" alt="image-20240318170840559" style="zoom:67%;">

<br>



<p><strong>HSSF读的代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelReadTest</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead07</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建一个输入流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(PATH + <span class="string">&quot;寝室登记表07.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 创建工作簿，使用Excel能操作的它都可以操作</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(inputStream);</span><br><span class="line">        <span class="comment">// 2. 获取工作表，第一个表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 3. 获取行，第二行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 4. 获取单元格，第一个单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.getCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取字符串类型的值</span></span><br><span class="line">        System.out.print(<span class="string">&quot;获取寝室登记表07.xlsx的第二行第一个单元格的值：&quot;</span>);</span><br><span class="line">        System.out.println(cell.getStringCellValue());</span><br><span class="line">        <span class="comment">// 关闭流</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/16/EasyExcel/image-20240318171234901.png" alt="image-20240318171234901" style="zoom:67%;">

<br>



<hr>
<h4 id="4-读取不同类型的数据"><a href="#4-读取不同类型的数据" class="headerlink" title="4. 读取不同类型的数据"></a>4. 读取不同类型的数据</h4><p>测试表名：明细表.xls</p>
<p>数据：</p>
<p><img src="/2024/03/16/EasyExcel/image-20240318200432443.png" alt="image-20240318200432443"></p>
<br>



<p><strong>代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelReadTest</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCellType</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取文件流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(PATH + <span class="string">&quot;明细表.xls&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建一个工作簿</span></span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>(inputStream);</span><br><span class="line">        <span class="comment">// 获取工作表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取标题内容，也就是表的第一行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">rowTitle</span> <span class="operator">=</span> sheet.getRow(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (rowTitle != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 获取行的单元格个数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">cellCount</span> <span class="operator">=</span> rowTitle.getPhysicalNumberOfCells();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">cellNum</span> <span class="operator">=</span> <span class="number">0</span>; cellNum &lt; cellCount; cellNum++) &#123;</span><br><span class="line">                <span class="comment">// 获取每一个单元格并输出</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> rowTitle.getCell(cellNum);</span><br><span class="line">                <span class="keyword">if</span> (cell != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">cellType</span> <span class="operator">=</span> cell.getCellType();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">cellValue</span> <span class="operator">=</span> cell.getStringCellValue();</span><br><span class="line">                    System.out.print(cellValue + <span class="string">&quot; | &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取表中数据</span></span><br><span class="line">        <span class="comment">// 获取有多少行</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rowCount</span> <span class="operator">=</span> sheet.getPhysicalNumberOfRows();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">1</span>; rowNum &lt; rowCount; rowNum++) &#123;</span><br><span class="line">            <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(rowNum);</span><br><span class="line">            <span class="comment">// 读取单元格</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">cellCount</span> <span class="operator">=</span> row.getPhysicalNumberOfCells();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">cellNum</span> <span class="operator">=</span> <span class="number">0</span>; cellNum &lt; cellCount; cellNum++) &#123;</span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell</span> <span class="operator">=</span> row.getCell(cellNum);</span><br><span class="line">                System.out.print(<span class="string">&quot;[&quot;</span> + (rowNum + <span class="number">1</span>) + <span class="string">&quot;-&quot;</span> + (cellNum + <span class="number">1</span>) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="comment">// 匹配列的数据类型</span></span><br><span class="line">                <span class="keyword">if</span> (cell != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">cellType</span> <span class="operator">=</span> cell.getCellType();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">cellValue</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="keyword">switch</span> (cellType) &#123;</span><br><span class="line">                        <span class="keyword">case</span> Cell.CELL_TYPE_STRING: <span class="comment">// 字符串</span></span><br><span class="line">                            System.out.print(<span class="string">&quot;【String】&quot;</span>);</span><br><span class="line">                            cellValue = cell.getStringCellValue();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> Cell.CELL_TYPE_BOOLEAN: <span class="comment">// 布尔</span></span><br><span class="line">                            System.out.print(<span class="string">&quot;【Boolean】&quot;</span>);</span><br><span class="line">                            cellValue = String.valueOf(cell.getBooleanCellValue());</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> Cell.CELL_TYPE_BLANK: <span class="comment">// 空</span></span><br><span class="line">                            System.out.print(<span class="string">&quot;【Blank】&quot;</span>);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> Cell.CELL_TYPE_NUMERIC: <span class="comment">// 数组（日期或普通数字）</span></span><br><span class="line">                            System.out.print(<span class="string">&quot;【numeric】&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (HSSFDateUtil.isCellDateFormatted(cell)) &#123; <span class="comment">// 如果是日期</span></span><br><span class="line">                                System.out.print(<span class="string">&quot;【日期】&quot;</span>);</span><br><span class="line">                                <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> cell.getDateCellValue();</span><br><span class="line">                                cellValue = <span class="keyword">new</span> <span class="title class_">DateTime</span>(date).toString(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 普通数字，转成字符串输出，防止数字过长</span></span><br><span class="line">                                System.out.print(<span class="string">&quot;【转成字符串输出】&quot;</span>);</span><br><span class="line">                                cell.setCellType(Cell.CELL_TYPE_STRING);</span><br><span class="line">                                cellValue = cell.toString();</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> Cell.CELL_TYPE_ERROR: <span class="comment">// 错误</span></span><br><span class="line">                            System.out.print(<span class="string">&quot;【数据类型错误】&quot;</span>);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(cellValue);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>测试结果</strong></p>
<p>测试结果只截取了一部分</p>
<img src="/2024/03/16/EasyExcel/image-20240318200636852.png" alt="image-20240318200636852" style="zoom: 67%;">

<br>



<hr>
<h3 id="三-EasyExcel"><a href="#三-EasyExcel" class="headerlink" title="三. EasyExcel"></a>三. EasyExcel</h3><p><a target="_blank" rel="noopener" href="https://easyexcel.opensource.alibaba.com/docs/current/">官方文档</a></p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<h4 id="1-写操作"><a href="#1-写操作" class="headerlink" title="1. 写操作"></a>1. 写操作</h4><h5 id="1-1-简单写"><a href="#1-1-简单写" class="headerlink" title="1.1 简单写"></a>1.1 简单写</h5><p><strong>方式一</strong></p>
<p>创建一个模板类User</p>
<p>@ExcelProperty：在表格中的名字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;用户编号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;性别&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;工资&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;入职时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date hireDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer userId, String name, String gender, Double salary, Date hireDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">        <span class="built_in">this</span>.hireDate = hireDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WriteTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\&quot;</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 简单写方式一</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user1.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;王五&quot;</span>,<span class="string">&quot;女&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;赵六&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        users.add(user1);</span><br><span class="line">        users.add(user2);</span><br><span class="line">        users.add(user3);</span><br><span class="line">        users.add(user4);</span><br><span class="line">        <span class="comment">// 写入文件中</span></span><br><span class="line">        EasyExcel.write(fileName, User.class).sheet(<span class="string">&quot;用户信息表&quot;</span>).doWrite(users);</span><br><span class="line">        System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 简单写方式二</span></span><br><span class="line"><span class="comment">     	把 EasyExcel.write(fileName, User.class).sheet(&quot;用户信息表&quot;).doWrite(users)的每一步都拆分开来</span></span><br><span class="line"><span class="comment">     	需要手动关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user2.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;CPP&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;Python&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        users.add(user1);</span><br><span class="line">        users.add(user2);</span><br><span class="line">        users.add(user3);</span><br><span class="line">        users.add(user4);</span><br><span class="line">        <span class="comment">// 写入文件中</span></span><br><span class="line">        <span class="comment">// 创建ExcelWriter对象</span></span><br><span class="line">        <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(fileName, User.class).build();</span><br><span class="line">        <span class="comment">// 创建writerSheet对象</span></span><br><span class="line">        <span class="type">WriteSheet</span> <span class="variable">writeSheet</span> <span class="operator">=</span> EasyExcel.writerSheet(<span class="string">&quot;用户信息表&quot;</span>).build();</span><br><span class="line">        excelWriter.write(users, writeSheet);</span><br><span class="line">        <span class="comment">// 关闭</span></span><br><span class="line">        excelWriter.finish();</span><br><span class="line">        System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>方式一</p>
<img src="/2024/03/16/EasyExcel/image-20240320111256698.png" alt="image-20240320111256698" style="zoom:50%;">

<img src="/2024/03/16/EasyExcel/image-20240320111325724.png" alt="image-20240320111325724" style="zoom:50%;">

<br>



<p>方式二</p>
<img src="/2024/03/16/EasyExcel/image-20240320113629889.png" alt="image-20240320113629889" style="zoom:50%;">

<br>



<hr>
<h5 id="1-2-排除或指定写入字段"><a href="#1-2-排除或指定写入字段" class="headerlink" title="1.2 排除或指定写入字段"></a>1.2 排除或指定写入字段</h5><p><strong>排除字段</strong></p>
<p>如果有一些类的属性，我们不想写入表中，可以通过<code>excludeColumnFiledNames()</code>排除掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 写的时候排除某些字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 创建文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user3.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;CPP&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;Python&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    users.add(user1);</span><br><span class="line">    users.add(user2);</span><br><span class="line">    users.add(user3);</span><br><span class="line">    users.add(user4);</span><br><span class="line">    <span class="comment">// 要排除的字段</span></span><br><span class="line">    Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    set.add(<span class="string">&quot;hireDate&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;salary&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">    <span class="comment">// 写入文件中</span></span><br><span class="line">    EasyExcel.write(fileName, User.class).excludeColumnFiledNames(set).sheet(<span class="string">&quot;用户信息表&quot;</span>).doWrite(users);</span><br><span class="line">    System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<img src="/2024/03/16/EasyExcel/image-20240320114606079.png" alt="image-20240320114606079" style="zoom: 50%;">

<br>



<p><strong>指定字段</strong></p>
<p>指定要写入表格中的属性可以通过<code>includeColumnFiledNames()</code>来指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 写的时候指定某些字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 创建文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user4.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;CPP&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;Python&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    users.add(user1);</span><br><span class="line">    users.add(user2);</span><br><span class="line">    users.add(user3);</span><br><span class="line">    users.add(user4);</span><br><span class="line">    <span class="comment">// 要排除的字段</span></span><br><span class="line">    Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    set.add(<span class="string">&quot;hireDate&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;salary&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">    <span class="comment">// 写入文件中</span></span><br><span class="line">    EasyExcel.write(fileName, User.class).includeColumnFiledNames(set).sheet(<span class="string">&quot;用户信息表&quot;</span>).doWrite(users);</span><br><span class="line">    System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<img src="/2024/03/16/EasyExcel/image-20240320115134530.png" alt="image-20240320115134530" style="zoom: 50%;">

<br>



<hr>
<h5 id="1-3-对excel中的字段排序"><a href="#1-3-对excel中的字段排序" class="headerlink" title="1.3 对excel中的字段排序"></a>1.3 对excel中的字段排序</h5><p>写入时如果要想对excel中的字段排序，可以在类属性上的注解<code>@ExcelProperty</code>添加index属性来实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;用户编号&quot;, index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;姓名&quot;, index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;性别&quot;, index = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;工资&quot;, index = 4)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;入职时间&quot;, index = 3)</span></span><br><span class="line">    <span class="keyword">private</span> Date hireDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer userId, String name, String gender, Double salary, Date hireDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">        <span class="built_in">this</span>.hireDate = hireDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h5 id="1-4-复杂头的数据写入"><a href="#1-4-复杂头的数据写入" class="headerlink" title="1.4 复杂头的数据写入"></a>1.4 复杂头的数据写入</h5><p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexHeadUser</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&#123;&quot;主实现&quot;,&quot;用户id&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="meta">@ExcelProperty(&#123;&quot;用户信息&quot;,&quot;用户姓名&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ExcelProperty(&#123;&quot;用户信息&quot;,&quot;用户性别&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ComplexHeadUser</span><span class="params">(Integer userId, String name, String gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 复杂头数据写入</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 创建文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user5.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">    List&lt;ComplexHeadUser&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">ComplexHeadUser</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComplexHeadUser</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>);</span><br><span class="line">    <span class="type">ComplexHeadUser</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComplexHeadUser</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>);</span><br><span class="line">    users.add(user1);</span><br><span class="line">    users.add(user2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入文件中</span></span><br><span class="line">    EasyExcel.write(fileName, ComplexHeadUser.class).sheet(<span class="string">&quot;用户信息表&quot;</span>).doWrite(users);</span><br><span class="line">    System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>生成的表</p>
<img src="/2024/03/16/EasyExcel/image-20240320135731838.png" alt="image-20240320135731838" style="zoom:50%;">

<br>



<hr>
<h5 id="1-5-重复多次写入"><a href="#1-5-重复多次写入" class="headerlink" title="1.5 重复多次写入"></a>1.5 重复多次写入</h5><p><strong>重复写入到一个Sheet中</strong></p>
<p>只需要在excelWriter.write时传入同一个Sheet即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 重复写入同一个sheet中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user6.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;CPP&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;Python&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        users.add(user1);</span><br><span class="line">        users.add(user2);</span><br><span class="line">        users.add(user3);</span><br><span class="line">        users.add(user4);</span><br><span class="line">        <span class="comment">// 写入文件中</span></span><br><span class="line">        <span class="comment">// 创建ExcelWriter对象</span></span><br><span class="line">        <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(fileName, User.class).build();</span><br><span class="line">        <span class="comment">// 创建writerSheet对象</span></span><br><span class="line">        <span class="type">WriteSheet</span> <span class="variable">writeSheet</span> <span class="operator">=</span> EasyExcel.writerSheet(<span class="string">&quot;用户信息表&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 重复写入</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            excelWriter.write(users, writeSheet);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭</span></span><br><span class="line">        excelWriter.finish();</span><br><span class="line">        System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br>

<p>t</p>
<img src="/2024/03/16/EasyExcel/image-20240320141017568.png" alt="image-20240320141017568" style="zoom:50%;">

<br>



<p><strong>重复多次写在不同的sheet中</strong></p>
<p>只需要在excelWriter.write时传入不同的Sheet即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@description</span>: 重复写入不同的sheet中</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// 创建文件名</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user7.xlsx&quot;</span>;</span><br><span class="line">       <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">       List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.12</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.41</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;CPP&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1402.36</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;Python&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.11</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       users.add(user1);</span><br><span class="line">       users.add(user2);</span><br><span class="line">       users.add(user3);</span><br><span class="line">       users.add(user4);</span><br><span class="line">       <span class="comment">// 写入文件中</span></span><br><span class="line">       <span class="comment">// 创建ExcelWriter对象</span></span><br><span class="line">       <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(fileName, User.class).build();</span><br><span class="line">       <span class="comment">// 重复写入</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">           <span class="comment">// 创建writerSheet对象</span></span><br><span class="line">           <span class="type">WriteSheet</span> <span class="variable">writeSheet</span> <span class="operator">=</span> EasyExcel.writerSheet(<span class="string">&quot;用户信息表&quot;</span> + i).build();</span><br><span class="line">           excelWriter.write(users, writeSheet);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 关闭</span></span><br><span class="line">       excelWriter.finish();</span><br><span class="line">       System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<br>



<img src="/2024/03/16/EasyExcel/image-20240320141317981.png" alt="image-20240320141317981" style="zoom:50%;">

<br>



<hr>
<h5 id="1-6-日期数字格式化"><a href="#1-6-日期数字格式化" class="headerlink" title="1.6 日期数字格式化"></a>1.6 日期数字格式化</h5><p>对于日期和数字有时候我们需要对其展示的样式进行格式化,easyexcel提供了一下注解</p>
<ul>
<li>@DateTimeFormat : 日期格式化</li>
<li>@NumberFormat   : 数字格式化(小数或者百分数)</li>
</ul>
<br>



<p>给实体类相应的字段添加上注解</p>
<img src="/2024/03/16/EasyExcel/image-20240323171730432.png" alt="image-20240323171730432" style="zoom:67%;">

<br>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 日期数字格式化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 创建文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user8.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 根据User模板构建数据</span></span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">1000.121</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1002</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">2000.411</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1003</span>,<span class="string">&quot;王五&quot;</span>,<span class="string">&quot;女&quot;</span>,<span class="number">1402.3601</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1004</span>,<span class="string">&quot;赵六&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">3000.1</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    users.add(user1);</span><br><span class="line">    users.add(user2);</span><br><span class="line">    users.add(user3);</span><br><span class="line">    users.add(user4);</span><br><span class="line">    <span class="comment">// 写入文件中</span></span><br><span class="line">    EasyExcel.write(fileName, User.class).sheet(<span class="string">&quot;用户信息表&quot;</span>).doWrite(users);</span><br><span class="line">    System.out.println(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240323171844280.png" alt="image-20240323171844280" style="zoom:67%;">

<br>



<hr>
<h5 id="1-7-写入图片到excel"><a href="#1-7-写入图片到excel" class="headerlink" title="1.7 写入图片到excel"></a>1.7 写入图片到excel</h5><p>EasyExcel写入图片到excel时，支持5种数据类型的图片类型</p>
<ul>
<li>图片可以是一个File格式 </li>
<li>图片可以是一个InputStream输入流的方式 </li>
<li>图片可以是一个byte[]数组的方式 </li>
<li>图片可以是 一个网络的java.net.URL对象方式 </li>
<li>图片也可以是一个String类型方式(当是String类型是，需要StringImageConverter类型转换器)</li>
</ul>
<br>



<p>构建包含这五种数据类型的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ContentRowHeight(100)</span>  <span class="comment">// 内容高度</span></span><br><span class="line"><span class="meta">@ColumnWidth(100 / 8)</span>   <span class="comment">// 列宽</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageData</span> &#123;</span><br><span class="line">    <span class="comment">// 使用抽象文件表示一个图片</span></span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line">    <span class="comment">// 使用输入流保存一个图片</span></span><br><span class="line">    <span class="keyword">private</span> InputStream inputStream;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当使用String类型保存一个图片的时候需要使用StringImageConverter转换器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelProperty(converter = StringImageConverter.class)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="comment">// 使用二进制数据保存为一个图片</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] byteArray;</span><br><span class="line">    <span class="comment">// 使用网络链接保存一个图片</span></span><br><span class="line">    <span class="keyword">private</span> URL url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 写入图片到excel</span></span><br><span class="line"><span class="comment"> * EasyExcel提供了5种数据格式进行图片的写入</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建文件保存的位置，以及文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user10.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;ImageData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">ImageData</span> <span class="variable">imageData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一种：根据File写入</span></span><br><span class="line">    imageData.setFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\workspace\\esayexcel\\img.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二种：根据InputStream写入</span></span><br><span class="line">    imageData.setInputStream(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;E:\\workspace\\esayexcel\\img.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三种：根据String类型写入</span></span><br><span class="line">    imageData.setString(<span class="string">&quot;E:\\workspace\\esayexcel\\img.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四种：使用二进制方式写入，先获取文件大小，再读成二进制数组</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\workspace\\esayexcel\\img.png&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建一个指定大小的二进制数组</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>)file.length()];</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">    <span class="comment">// 将文件流写入到二进制数组中</span></span><br><span class="line">    fileInputStream.read(bytes, <span class="number">0</span>, (<span class="type">int</span>)file.length());</span><br><span class="line">    imageData.setByteArray(bytes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第五种：只使用网络</span></span><br><span class="line">    imageData.setUrl(<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https://ts1.cn.mm.bing.net/th/id/R-C.5c53fb9d074c6e35302bca533c0204e5?rik=AYOvGEn5S6VPcw&amp;riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1301%2f10%2fc1%2f17280208_1357799853569.jpg&amp;ehk=ckgBYNfHbwaEcgpJjb%2f7E%2bfYjy74F8b81gJaf5cBpic%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到集合中，然后使用EasyExcel写入</span></span><br><span class="line">    list.add(imageData);</span><br><span class="line">    EasyExcel.write(fileName, ImageData.class).sheet(<span class="string">&quot;图片&quot;</span>).doWrite(list);</span><br><span class="line">    <span class="comment">// 关闭输入流</span></span><br><span class="line">    fileInputStream.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240323180007002.png" alt="image-20240323180007002" style="zoom: 50%;">

<br>



<hr>
<h5 id="1-8-设置excel表格的列宽行高"><a href="#1-8-设置excel表格的列宽行高" class="headerlink" title="1.8 设置excel表格的列宽行高"></a>1.8 设置excel表格的列宽行高</h5><p>可以通过以下注解来设置excel表的列宽和行高</p>
<ul>
<li>@ContentRowHeight 设置内容高度</li>
<li>@HeadRowHeight 设置标题高度</li>
<li>@ColumnWidth 设置列宽<ul>
<li>@ColumnWidth如果写在类上，就是设置整个表格所有的列宽，如果写在属性上，就是设置这个属性对应的表格字段的列宽</li>
</ul>
</li>
</ul>
<br>



<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ContentRowHeight(20)</span><span class="comment">// 设置内容高度</span></span><br><span class="line"><span class="meta">@HeadRowHeight(20)</span> <span class="comment">// 设置标题高度</span></span><br><span class="line"><span class="meta">@ColumnWidth(25)</span> <span class="comment">// 设置列宽</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WidthAndHeightData</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;字符串标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;日期标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置宽度为50</span></span><br><span class="line">    <span class="meta">@ColumnWidth(50)</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;数字标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double doubleData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 设置excel的列宽行高</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建文件保存的位置，以及文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user10.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;WidthAndHeightData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="type">WidthAndHeightData</span> <span class="variable">widthAndHeightData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WidthAndHeightData</span>();</span><br><span class="line">    widthAndHeightData.setString(<span class="string">&quot;正哥&quot;</span>);</span><br><span class="line">    widthAndHeightData.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    widthAndHeightData.setDoubleData(<span class="number">10000D</span>);</span><br><span class="line">    list.add(widthAndHeightData);</span><br><span class="line"></span><br><span class="line">    EasyExcel.write(fileName, WidthAndHeightData.class).sheet(<span class="string">&quot;列宽行高&quot;</span>).doWrite(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240324140530445.png" alt="image-20240324140530445" style="zoom:50%;">

<br>



<hr>
<h5 id="1-9-通过注解设置excel的样式"><a href="#1-9-通过注解设置excel的样式" class="headerlink" title="1.9 通过注解设置excel的样式"></a>1.9 通过注解设置excel的样式</h5><ul>
<li>@HeadStyle：设置头的背景<ul>
<li>这个字段写在类上就是对所有的字段头都设置，也就是表的第一行。如果写在属性上就是只对这个属性的头设置背景颜色，属性的设置会覆盖掉类的设置</li>
</ul>
</li>
<li>@HeadFontStyle：设置头字体，规则同事</li>
<li>@ContentStyle：设置内容的背景，规则同上</li>
<li>@ContentFontStyle：设置内容的字体，规则同上</li>
</ul>
<br>





<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// 头背景设置成红色 IndexedColors.RED.getIndex()</span></span><br><span class="line"><span class="meta">@HeadStyle(fillPatternType = FillPatternType.SOLID_FOREGROUND, fillForegroundColor = 10)</span></span><br><span class="line"><span class="comment">// 头字体设置成20</span></span><br><span class="line"><span class="meta">@HeadFontStyle(fontHeightInPoints = 20)</span></span><br><span class="line"><span class="comment">// 内容的背景设置成绿色 IndexedColors.GREEN.getIndex()</span></span><br><span class="line"><span class="meta">@ContentStyle(fillPatternType = FillPatternType.SOLID_FOREGROUND, fillForegroundColor = 17)</span></span><br><span class="line"><span class="comment">// 内容字体设置成20</span></span><br><span class="line"><span class="meta">@ContentFontStyle(fontHeightInPoints = 20)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoStyleData</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串的头背景设置成粉红 IndexedColors.PINK.getIndex()</span></span><br><span class="line">    <span class="meta">@HeadStyle(fillPatternType = FillPatternType.SOLID_FOREGROUND, fillForegroundColor = 14)</span></span><br><span class="line">    <span class="comment">// 字符串的头字体设置成30</span></span><br><span class="line">    <span class="meta">@HeadFontStyle(fontHeightInPoints = 30)</span></span><br><span class="line">    <span class="comment">// 字符串的内容的背景设置成天蓝 IndexedColors.SKY_BLUE.getIndex()</span></span><br><span class="line">    <span class="meta">@ContentStyle(fillPatternType = FillPatternType.SOLID_FOREGROUND, fillForegroundColor = 40)</span></span><br><span class="line">    <span class="comment">// 字符串的内容字体设置成30</span></span><br><span class="line">    <span class="meta">@ContentFontStyle(fontHeightInPoints = 30)</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;字符串标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;日期标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;数字标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double doubleData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@description</span>: 通过注解设置excel表格样式</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 创建文件保存的位置，以及文件名</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user11.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">       List&lt;DemoStyleData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="type">DemoStyleData</span> <span class="variable">demoStyleData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoStyleData</span>();</span><br><span class="line">       demoStyleData.setString(<span class="string">&quot;正哥&quot;</span>);</span><br><span class="line">       demoStyleData.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       demoStyleData.setDoubleData(<span class="number">10000D</span>);</span><br><span class="line">       list.add(demoStyleData);</span><br><span class="line"></span><br><span class="line">       EasyExcel.write(fileName, DemoStyleData.class).sheet(<span class="string">&quot;excel样式&quot;</span>).doWrite(list);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<br>





<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240324141952658.png" alt="image-20240324141952658" style="zoom:67%;">

<br>



<hr>
<h5 id="1-10-合并单元格"><a href="#1-10-合并单元格" class="headerlink" title="1.10 合并单元格"></a>1.10 合并单元格</h5><p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// 将第6-7行的2-3列合并成一个单元格</span></span><br><span class="line"><span class="meta">@OnceAbsoluteMerge(firstRowIndex = 5, lastRowIndex = 6, firstColumnIndex = 1, lastColumnIndex = 2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoMergeData</span> &#123;</span><br><span class="line">    <span class="comment">// 这一列 每隔2行 合并单元格</span></span><br><span class="line">    <span class="meta">@ContentLoopMerge(eachRow = 2)</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;字符串标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;日期标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;数字标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double doubleData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 合并单元格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建文件保存的位置，以及文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user12.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;DemoMergeData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd.setString(<span class="string">&quot;正哥&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd2.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd2.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd2.setString(<span class="string">&quot;正哥&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd3.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd3.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd3.setString(<span class="string">&quot;小王&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd4.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd4.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd4.setString(<span class="string">&quot;小王&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd5.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd5.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd5.setString(<span class="string">&quot;小李&quot;</span>);</span><br><span class="line">    DemoMergeData dmd6= <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd6.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd6.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd6.setString(<span class="string">&quot;小李&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd7.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd7.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd7.setString(<span class="string">&quot;小红&quot;</span>);</span><br><span class="line">    <span class="type">DemoMergeData</span> <span class="variable">dmd8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DemoMergeData</span>();</span><br><span class="line">    dmd8.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    dmd8.setDoubleData(<span class="number">200.12</span>);</span><br><span class="line">    dmd8.setString(<span class="string">&quot;小红&quot;</span>);</span><br><span class="line">    list.add(dmd);</span><br><span class="line">    list.add(dmd2);</span><br><span class="line">    list.add(dmd3);</span><br><span class="line">    list.add(dmd4);</span><br><span class="line">    list.add(dmd5);</span><br><span class="line">    list.add(dmd6);</span><br><span class="line">    list.add(dmd7);</span><br><span class="line">    list.add(dmd8);</span><br><span class="line"></span><br><span class="line">    EasyExcel.write(fileName, DemoMergeData.class).sheet(<span class="string">&quot;合并单元格&quot;</span>).doWrite(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<p><img src="/2024/03/16/EasyExcel/image-20240324143852001.png" alt="image-20240324143852001"></p>
<br>



<hr>
<h4 id="2-读操作"><a href="#2-读操作" class="headerlink" title="2. 读操作"></a>2. 读操作</h4><h5 id="2-1-简单读"><a href="#2-1-简单读" class="headerlink" title="2.1 简单读"></a>2.1 简单读</h5><p>先创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoData</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Date hireDate;</span><br><span class="line">	<span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">DemoData</span><span class="params">()</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">DemoData</span><span class="params">(String name, Date hireDate, Double salary)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.name = name;</span><br><span class="line">		<span class="built_in">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="built_in">this</span>.salary = salary;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<p>方式二是在方式一的基础上进行拆分</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 最简单写，方式一</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user11.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">        EasyExcel.read(fileName, DemoData.class, <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;DemoData&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span>: 每解析一行Excel表数据，就会调用一次</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> &#123;</span><br><span class="line">                <span class="comment">//在这里操作，将解析的每一条数据保存到数据库中,在这里可以调用数据库</span></span><br><span class="line">                System.out.println(<span class="string">&quot;解析的数据为: &quot;</span>+data);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span>: 解析完被调用</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;解析完成&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).sheet().doRead();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 最简单写，方式二</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user11.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExcelReader</span> <span class="variable">excelReader</span> <span class="operator">=</span> EasyExcel.read(fileName, DemoData.class, <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;DemoData&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span>: 每解析一行Excel表数据，就会调用一次</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> &#123;</span><br><span class="line">                <span class="comment">//在这里操作，将解析的每一条数据保存到数据库中,在这里可以调用数据库</span></span><br><span class="line">                System.out.println(<span class="string">&quot;解析的数据为: &quot;</span> + data);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span>: 解析完被调用</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;解析完成&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).build();</span><br><span class="line">        <span class="comment">// 创建一个Sheet对象，并读取Excel的第一个sheet，下标从0开始</span></span><br><span class="line">        <span class="type">ReadSheet</span> <span class="variable">readSheet</span> <span class="operator">=</span> EasyExcel.readSheet(<span class="number">0</span>).build();</span><br><span class="line">        excelReader.read(readSheet);</span><br><span class="line">        <span class="comment">// 关闭流操作</span></span><br><span class="line">        excelReader.finish();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240324212642997.png" alt="image-20240324212642997" style="zoom:67%;">

<br>



<hr>
<h5 id="2-2-指定列的下标或列名"><a href="#2-2-指定列的下标或列名" class="headerlink" title="2.2 指定列的下标或列名"></a>2.2 指定列的下标或列名</h5><p>当实体类的属性顺序和表中的属性顺序不一致时，需要通过注解指定列的下标或者列名</p>
<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexOrNameData</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 强制读取第三个 这里不建议 index 和 name 同时用，要么一个对象只用index，要么一个对象只用name去匹配</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@ExcelProperty(index = 2)</span></span><br><span class="line">	<span class="keyword">private</span> Double doubleData;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用名字去匹配，这里需要注意，如果名字重复，会导致只有一个字段读取到数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@ExcelProperty(&quot;字符串标题&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String string;</span><br><span class="line">	<span class="meta">@ExcelProperty(&quot;日期标题&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p>表字段</p>
<img src="/2024/03/16/EasyExcel/image-20240324214914301.png" alt="image-20240324214914301" style="zoom:80%;">

<br>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description</span>: 指定列的下标或者列的名称</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user10.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">      EasyExcel.read(fileName, IndexOrNameData.class, <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;IndexOrNameData&gt;() &#123;</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@description</span>: 每解析一行Excel表数据，就会调用一次</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(IndexOrNameData data, AnalysisContext context)</span> &#123;</span><br><span class="line">              <span class="comment">//在这里操作，将解析的每一条数据保存到数据库中,在这里可以调用数据库</span></span><br><span class="line">              System.out.println(<span class="string">&quot;解析的数据为: &quot;</span> + data);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@description</span>: 解析完被调用</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;解析完成&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;).sheet().doRead();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240324215010853.png" alt="image-20240324215010853" style="zoom:80%;">

<br>

<hr>
<h5 id="2-3-日期或数字的格式转换"><a href="#2-3-日期或数字的格式转换" class="headerlink" title="2.3 日期或数字的格式转换"></a>2.3 日期或数字的格式转换</h5><p>如果Excel表中的日期格式或者数字格式不符合需求，或者无法被Java解析时，需要在接收的实体类上进行数据转换</p>
<p>修改Excel表</p>
<img src="/2024/03/16/EasyExcel/image-20240324220435980.png" alt="image-20240324220435980" style="zoom:67%;">

<br>

<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义需要被格式化的字段</span></span><br><span class="line"><span class="comment"> * 如果使用<span class="doctag">@NumberFormat</span>(&quot;#.##&quot;)注解，建议数据类型采用String,如果使用double可能不能被格式化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConverterData</span> &#123;</span><br><span class="line">	<span class="meta">@ExcelProperty(&quot;姓名&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@NumberFormat(&quot;#.##&quot;)</span></span><br><span class="line">	<span class="meta">@ExcelProperty(&quot;数字标题&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String salary;</span><br><span class="line">	<span class="meta">@DateTimeFormat(&quot;yyyy年MM月dd日 HH时mm分ss秒&quot;)</span></span><br><span class="line">	<span class="meta">@ExcelProperty(&quot;日期标题&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date hireDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 日期数字格式化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> PATH + <span class="string">&quot;user10.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    EasyExcel.read(fileName, ConverterData.class, <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;ConverterData&gt;() &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@description</span>: 每解析一行Excel表数据，就会调用一次</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(ConverterData data, AnalysisContext context)</span> &#123;</span><br><span class="line">            <span class="comment">//在这里操作，将解析的每一条数据保存到数据库中,在这里可以调用数据库</span></span><br><span class="line">            System.out.println(<span class="string">&quot;解析的数据为: &quot;</span> + data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@description</span>: 解析完被调用</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;解析完成&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).sheet().doRead();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240324222116773.png" alt="image-20240324222116773" style="zoom:67%;">

<br>



<hr>
<h5 id="2-4-读取多个或全部sheet标签"><a href="#2-4-读取多个或全部sheet标签" class="headerlink" title="2.4 读取多个或全部sheet标签"></a>2.4 读取多个或全部sheet标签</h5><p><strong>读取全部sheet标签</strong></p>
<p>只需要在构建时使用doReadAll()即可，这里要注意要所有的sheet都是使用同一个类模板来读取，才能使用doReadAll()</p>
<p><img src="/2024/03/16/EasyExcel/image-20240324222829772.png" alt="image-20240324222829772"></p>
<br>



<p><strong>读取部分sheet</strong></p>
<p>使用简单读方式二，每次创建不同的sheet</p>
<br>

<p>示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 读取Excel中的多个或者全部sheet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead5</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//读取的文件路径</span></span><br><span class="line">	String fileName=<span class="string">&quot;user11.xlsx&quot;</span>;</span><br><span class="line">	Class&lt;DemoData&gt; head = DemoData.class; <span class="comment">//创建一个数据格式来承装读取到数据</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读取全部sheet</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	EasyExcel.read(fileName, head, <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;DemoData&gt;() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 每解析一条数据被调用一次</span></span><br><span class="line">			System.out.println(<span class="string">&quot;解析的数据为: &quot;</span>+data);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 数据解析完成之后被调用</span></span><br><span class="line">			System.out.println(<span class="string">&quot;数据解析完成......&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).doReadAll();</span><br><span class="line">	</span><br><span class="line">	System.out.println(<span class="string">&quot;============================================================&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读取其中的某几个sheet</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//构建ExcelReader对象</span></span><br><span class="line">	<span class="type">ExcelReader</span> <span class="variable">excelReader</span> <span class="operator">=</span> EasyExcel.read(fileName).build();</span><br><span class="line">	<span class="comment">//创建想要获取的sheet对象</span></span><br><span class="line">	<span class="type">ReadSheet</span> <span class="variable">sheet1</span> <span class="operator">=</span> EasyExcel.readSheet(<span class="number">0</span>).head(DemoData.class).registerReadListener(<span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;DemoData&gt;() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 每解析一条数据被调用一次</span></span><br><span class="line">			System.out.println(<span class="string">&quot;解析的数据为: &quot;</span>+data);				</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 数据解析完成之后被调用</span></span><br><span class="line">			System.out.println(<span class="string">&quot;数据解析完成......&quot;</span>);				</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).build();</span><br><span class="line">	</span><br><span class="line">	<span class="type">ReadSheet</span> <span class="variable">sheet2</span> <span class="operator">=</span> EasyExcel.readSheet(<span class="number">2</span>).head(DemoData.class).registerReadListener(<span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;DemoData&gt;() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 每解析一条数据被调用一次</span></span><br><span class="line">			System.out.println(<span class="string">&quot;解析的数据为: &quot;</span>+data);				</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">			<span class="comment">// 数据解析完成之后被调用</span></span><br><span class="line">			System.out.println(<span class="string">&quot;数据解析完成......&quot;</span>);				</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).build();</span><br><span class="line">	<span class="comment">//读取sheet</span></span><br><span class="line">	excelReader.read(sheet1,sheet2);</span><br><span class="line">	<span class="comment">//关闭</span></span><br><span class="line">	excelReader.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>官方代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读多个或者全部sheet,这里注意一个sheet不能读取多次，多次读取需要重新读取文件</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 1. 创建excel对应的实体对象 参照&#123;<span class="doctag">@link</span> DemoData&#125;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 2. 由于默认一行行的读取excel，所以需要创建excel一行一行的回调监听器，参照&#123;<span class="doctag">@link</span> DemoDataListener&#125;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 3. 直接读即可</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">repeatedRead</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> TestFileUtil.getPath() + <span class="string">&quot;demo&quot;</span> + File.separator + <span class="string">&quot;demo.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 读取全部sheet</span></span><br><span class="line">        <span class="comment">// 这里需要注意 DemoDataListener的doAfterAllAnalysed 会在每个sheet读取完毕后调用一次。然后所有sheet都会往同一个DemoDataListener里面写</span></span><br><span class="line">        EasyExcel.read(fileName, DemoData.class, <span class="keyword">new</span> <span class="title class_">DemoDataListener</span>()).doReadAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取部分sheet</span></span><br><span class="line">        fileName = TestFileUtil.getPath() + <span class="string">&quot;demo&quot;</span> + File.separator + <span class="string">&quot;demo.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写法1</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ExcelReader</span> <span class="variable">excelReader</span> <span class="operator">=</span> EasyExcel.read(fileName).build()) &#123;</span><br><span class="line">            <span class="comment">// 这里为了简单 所以注册了 同样的head 和Listener 自己使用功能必须不同的Listener</span></span><br><span class="line">            <span class="type">ReadSheet</span> <span class="variable">readSheet1</span> <span class="operator">=</span></span><br><span class="line">                EasyExcel.readSheet(<span class="number">0</span>).head(DemoData.class).registerReadListener(<span class="keyword">new</span> <span class="title class_">DemoDataListener</span>()).build();</span><br><span class="line">            <span class="type">ReadSheet</span> <span class="variable">readSheet2</span> <span class="operator">=</span></span><br><span class="line">                EasyExcel.readSheet(<span class="number">1</span>).head(DemoData.class).registerReadListener(<span class="keyword">new</span> <span class="title class_">DemoDataListener</span>()).build();</span><br><span class="line">            <span class="comment">// 这里注意 一定要把sheet1 sheet2 一起传进去，不然有个问题就是03版的excel 会读取多次，浪费性能</span></span><br><span class="line">            excelReader.read(readSheet1, readSheet2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h4 id="3-填充"><a href="#3-填充" class="headerlink" title="3. 填充"></a>3. 填充</h4><h5 id="3-1-简单填充，填充当个对象"><a href="#3-1-简单填充，填充当个对象" class="headerlink" title="3.1 简单填充，填充当个对象"></a>3.1 简单填充，填充当个对象</h5><p>填充单个属性使用{}作为占位符,在大括号里面定义属性名称,如果{}想不作为占位符展示出来,可以使用反斜杠进行转义.</p>
<p>填充模板excel</p>
<img src="/2024/03/16/EasyExcel/image-20240325125507508.png" alt="image-20240325125507508" style="zoom:67%;">

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FullTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">PATH</span> <span class="operator">=</span> <span class="string">&quot;E:\\workspace\\esayexcel\\&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 单个对象填充</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 根据哪个模板填充</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateName</span> <span class="operator">=</span> PATH + <span class="string">&quot;templateName.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 填充完成后的excel</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> PATH + <span class="string">&quot;fullFileName.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 构建数据</span></span><br><span class="line">        <span class="type">FillData</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FillData</span>();</span><br><span class="line">        data.setName(<span class="string">&quot;小白&quot;</span>);</span><br><span class="line">        data.setNumber(<span class="number">1111.22</span>);</span><br><span class="line"></span><br><span class="line">        EasyExcel.write(fullName).withTemplate(templateName).sheet().doFill(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240325125608289.png" alt="image-20240325125608289" style="zoom:67%;">

<br>

<hr>
<h5 id="3-2-填充列表数据"><a href="#3-2-填充列表数据" class="headerlink" title="3.2 填充列表数据"></a>3.2 填充列表数据</h5><p>excel填充模板</p>
<img src="/2024/03/16/EasyExcel/image-20240325130207466.png" alt="image-20240325130207466" style="zoom:67%;">

<br>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 填充列表数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 根据哪个模板填充</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">templateName</span> <span class="operator">=</span> PATH + <span class="string">&quot;templateName2.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 填充完成后的excel</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> PATH + <span class="string">&quot;fullFileName2.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 构建数据</span></span><br><span class="line">    List&lt;FillData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">FillData</span> <span class="variable">data1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FillData</span>();</span><br><span class="line">    data1.setName(<span class="string">&quot;小白&quot;</span>);</span><br><span class="line">    data1.setNumber(<span class="number">1111.22</span>);</span><br><span class="line">    <span class="type">FillData</span> <span class="variable">data2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FillData</span>();</span><br><span class="line">    data2.setName(<span class="string">&quot;小红&quot;</span>);</span><br><span class="line">    data2.setNumber(<span class="number">11312.22</span>);</span><br><span class="line">    <span class="type">FillData</span> <span class="variable">data3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FillData</span>();</span><br><span class="line">    data3.setName(<span class="string">&quot;小王&quot;</span>);</span><br><span class="line">    data3.setNumber(<span class="number">123124.123</span>);</span><br><span class="line">    list.add(data1);</span><br><span class="line">    list.add(data2);</span><br><span class="line">    list.add(data3);</span><br><span class="line"></span><br><span class="line">    EasyExcel.write(fullName).withTemplate(templateName).sheet().doFill(list);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2024/03/16/EasyExcel/image-20240325130308037.png" alt="image-20240325130308037" style="zoom:67%;">

<br>



<hr>
<h4 id="4-Web操作"><a href="#4-Web操作" class="headerlink" title="4.Web操作"></a>4.Web操作</h4><h5 id="4-1-文件下载"><a href="#4-1-文件下载" class="headerlink" title="4.1 文件下载"></a>4.1 文件下载</h5><p>这里是我在完善个人学习项目功能时写的，这里只截取了一部分前端代码，通过前端处理来导出excel</p>
<br>





<p><strong>导入xlsx插件</strong></p>
<p>在package.json中导入依赖</p>
<p>拉取依赖，npm insatll 或者 npm install xlsx –save</p>
<p><img src="/2024/03/16/EasyExcel/image-20240326145431238.png" alt="image-20240326145431238"></p>
<br>





<p><strong>写导出按钮</strong></p>
<img src="/2024/03/16/EasyExcel/image-20240326145649180.png" alt="image-20240326145649180" style="zoom:67%;">

<br>





<p><strong>写函数</strong></p>
<p>先在script中引入xlsx</p>
<img src="/2024/03/16/EasyExcel/image-20240326145747938.png" alt="image-20240326145747938" style="zoom:67%;">

<br>





<p>submit函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">submit() &#123;</span><br><span class="line">  if (this.tableData.length &lt;= 0) &#123;</span><br><span class="line">    this.$message(&#123;</span><br><span class="line">      message: &quot;没有成绩，无法导出&quot;,</span><br><span class="line">      type: &quot;warning&quot;,</span><br><span class="line">      showClose: true</span><br><span class="line">    &#125;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  let arr = this.tableData.map(item =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      课程名: item.courseName,</span><br><span class="line">      教师: item.teacherName,</span><br><span class="line">      学分: item.credit,</span><br><span class="line">      日常成绩: item.dailyScore,</span><br><span class="line">      考试成绩: item.examScore,</span><br><span class="line">      总成绩: item.score</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  let sheet = xlsx.utils.json_to_sheet(arr),</span><br><span class="line">    book = xlsx.utils.book_new();</span><br><span class="line">  xlsx.utils.book_append_sheet(book, sheet, &quot;成绩表&quot;);</span><br><span class="line">  xlsx.writeFile(book, `成绩表$&#123;new Date().getTime()&#125;.xls`);</span><br><span class="line">  this.disabled = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<p>数据</p>
<p>我这里只有成绩数据，并且不需要经过筛选，所以直接全部导出查询到的成绩数据，也就是tableData</p>
<p><img src="/2024/03/16/EasyExcel/image-20240326150520360.png" alt="image-20240326150520360"></p>
<br>





<p><strong>测试</strong></p>
<p>前端效果</p>
<img src="/2024/03/16/EasyExcel/image-20240326150719647.png" alt="image-20240326150719647" style="zoom:67%;">

<br>





<p>导出成绩</p>
<img src="/2024/03/16/EasyExcel/image-20240326150817272.png" alt="image-20240326150817272" style="zoom:50%;">

<img src="/2024/03/16/EasyExcel/image-20240326150854696.png" alt="image-20240326150854696" style="zoom:67%;">

<br>



<p>如果不存在成绩</p>
<img src="/2024/03/16/EasyExcel/image-20240326150953313.png" alt="image-20240326150953313" style="zoom:50%;">

<br>




      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/03/16/EasyExcel/" data-id="clywa1f48000qecveg9er7e8r" data-title="Apache poi 和 EasyExcel" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/excel/" rel="tag">excel</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java新特性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2024-03-10T07:18:49.000Z" itemprop="datePublished">2024-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/">Java新特性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>该笔记根据学习<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16v4y1y7xa/?share_source=copy_web&vd_source=db8e7458ec195ac74979ce5478cbc624">b站视频</a>制作</p>
<hr>
<h4 id="Java-9"><a href="#Java-9" class="headerlink" title="Java 9"></a>Java 9</h4><p><strong>语法变化</strong></p>
<p>在接口中可以写入私有方法，但是只能在接口内部被default调</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240314152911495.png" alt="image-20240314152911495" style="zoom:67%;">

<br>



<p>从Java 9开始，变量不允许使用<code>_</code>来命名</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240314153316044.png" alt="image-20240314153316044" style="zoom:80%;">

<br>



<p><strong>注解变化</strong></p>
<p><code>@Deprecated</code>注解的变化</p>
<p>该注解用于标识废弃的内容，在jdk9中新增了两个内容</p>
<ul>
<li>String since() default “” : 标识是从哪个版本开始废弃的</li>
<li>boolean forRemoval() default false : 标识该废弃的内容将来是否会移除，true表示会移除</li>
</ul>
<br>



<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240316134132449.png" alt="image-20240316134132449" style="zoom:80%;">

<br>





<p><strong>字符串底层变化</strong></p>
<p>在jdk9之前，String底层是用char数组存储的，而在jdk9，改为了用byte数组存储</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240316134530731.png" alt="image-20240316134530731" style="zoom: 50%;">

<br>



<p>String中增加了两个成员变量</p>
<ul>
<li>COMPACT_STRINGS： 判断是否压缩，默认是true，如果为false不压缩，就使用UTF-16编码</li>
<li>coder： 用来区分使用的字符编码，分别为LATIN1（0）和UTF16（1）</li>
</ul>
<br>



<p>当Spring字符串存储英文时，一个英文字符会占用一个字节</p>
<p>当Spring字符串存储中文时，一个中文汉字或占用两个字节，一个字节存储低八位（unicode二进制）,一个字节存储高八位</p>
<p>当Spring字符串存储中英文混合时，一个英文字符会占用两个字节</p>
<br>





<p><strong>模块化</strong></p>
<p>模块是Java9中新增的一个组件，可以简单理解为是package的上级容器，是多个package的集合，一个jar可以有多个module，一个module可以有多个package。从代码结构上看，jar &gt; <strong>module</strong> &gt; package &gt; class, interface</p>
<br>



<p>Java9的模块通过requires和exports关键字，对自身所依赖（requires）的模块和自身暴露（exports）出去的内容（package）进行了声明。本模块只能使用其他模块暴露（exports）出来的内容（package），其他模块也只能使用本模块暴露（exports）出去的内容（package）</p>
<br>



<p>模块化的优点</p>
<ul>
<li>精简jvm加载的class类，提升加载速度</li>
<li>对包更精细的控制，提高安全</li>
</ul>
<br>



<p>使用案例</p>
<p>创建两个模块，并创建相关的测试类</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317113620063.png" alt="image-20240317113620063" style="zoom:67%;">

<br>



<p>Cat类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;猫喜欢吃鱼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>Dog类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;狗喜欢吃骨头&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>这时我们尝试在测试类中创建Cat类对象和Dog类对象，会发现找不着对象</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317113825805.png" alt="image-20240317113825805" style="zoom:67%;">

<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317113846566.png" alt="image-20240317113846566" style="zoom:67%;">

<br>



<p>因为每个模块对外都是封闭的，我们需要把Cat类和Dog类所在的包对外暴露，在Test模块导入develop模块，才能使用Cat类和Dog类</p>
<p>在devlop模块中创建module-info.java文件</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317114120958.png" alt="image-20240317114120958" style="zoom:67%;">

<br>



<p>在module-info.java文件暴露Cat类和Dog类所在的包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> develop &#123;</span><br><span class="line">    <span class="keyword">exports</span> zheng.dev1; <span class="comment">// 导出包</span></span><br><span class="line">    opens zheng.dev2; <span class="comment">// 导出包，只能通过反射的方式访问</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>在test模块也创建module-info.java文件，然后导入develop模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> test &#123;</span><br><span class="line">    <span class="keyword">requires</span> develop; <span class="comment">// 导入模块</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>再次进行测试</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317115134033.png" alt="image-20240317115134033" style="zoom:67%;">

<br>



<p>通过反射创建Dog类对象,再测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">        cat.eat();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;zheng.dev2.Dog&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取dog对象并打印</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">dog</span> <span class="operator">=</span> aClass.getDeclaredConstructor().newInstance();</span><br><span class="line">        System.out.println(dog);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取dot对象的eat方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">eat</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>);</span><br><span class="line">        System.out.println(eat);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印dog的eat方法</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) eat.invoke(dog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317120323688.png" alt="image-20240317120323688" style="zoom:67%;">

<br>





<hr>
<h4 id="Java-10"><a href="#Java-10" class="headerlink" title="Java 10"></a>Java 10</h4><p><strong>局部类型变量推断</strong></p>
<p>定义变量时可以使用var来定义，再通过<code>=</code>右边的数据来推断数据类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">Name</span> <span class="operator">=</span> <span class="string">&quot;zheng&quot;</span>;</span><br><span class="line">		<span class="type">var</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">18</span>;</span><br><span class="line">		<span class="type">var</span> <span class="variable">Id</span> <span class="operator">=</span> <span class="number">11111111L</span>;</span><br><span class="line">		<span class="keyword">var</span> <span class="keyword">new</span> <span class="title class_">Obje</span> = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>var的使用是有限制的，仅适用于局部变量，增强for循环的索引，以及普通for循环的本地变量，他不能用于方法的形参，构造方法形参，方法返回类型等</p>
<br>



<hr>
<h4 id="Java-11"><a href="#Java-11" class="headerlink" title="Java 11"></a>Java 11</h4><p>新增：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 以前去除字符串前后的空格使用trim方法，现在可以使用strip方法</span></span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&#x27;\u2000&#x27;</span>; <span class="comment">// Unicode空白字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> c + <span class="string">&quot;abc&quot;</span> + c;</span><br><span class="line">        System.out.println(str.trim()); <span class="comment">// 无法去除</span></span><br><span class="line">        System.out.println(str.strip()); <span class="comment">// 成功去除空格</span></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// isBlank()方法，是否为空</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot; &quot;</span>;</span><br><span class="line">        System.out.println(name.isBlank());</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// repeat()方法，重复输出</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">abc</span> <span class="operator">=</span> <span class="string">&quot;zheng&quot;</span>;</span><br><span class="line">        System.out.println(abc.repeat(<span class="number">5</span>)); <span class="comment">// 参数5表示重复输出5次</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317134830389.png" alt="image-20240317134830389" style="zoom:67%;">

<br>



<hr>
<h4 id="Java-12"><a href="#Java-12" class="headerlink" title="Java 12"></a>Java 12</h4><p><strong>升级了Swatch语法</strong></p>
<p>当多个case条件所生产的结果相同时，可以缩写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前月份所属季节</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">month</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">switch</span>(month) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> -&gt; System.out.println(<span class="string">&quot;spring&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span> -&gt; System.out.println(<span class="string">&quot;summer&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span> -&gt; System.out.println(<span class="string">&quot;autumn&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>,<span class="number">1</span>,<span class="number">2</span> -&gt; System.out.println(<span class="string">&quot;winter&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span> -&gt; System.out.println(<span class="string">&quot;请输入正确的月份&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>注意： 这个功能在Java 12中是预览功能，在Java 14才正式上线，如果要在Java 12和Java 13中使用要执行下面命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编译： javac --enable-preview -source 12 Test.Java</span><br><span class="line">运行： java --enable-preview Test</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h4 id="Java-13"><a href="#Java-13" class="headerlink" title="Java 13"></a>Java 13</h4><p><strong>升级了Swatch语法，Swatch语句可以有返回值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前月份所属季节</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">month</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">switch</span>(month) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> -&gt; <span class="string">&quot;spring&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span> -&gt; <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span> -&gt; <span class="string">&quot;autumn&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>,<span class="number">1</span>,<span class="number">2</span> -&gt; <span class="string">&quot;winter&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span> -&gt; <span class="string">&quot;请输入正确的月份&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>文本块变化</strong></p>
<p>以前输出多行内容时要换行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;床前明月光\n疑是地上霜\n举头望明月\n低头思故乡&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>现在可以输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        床前明月光</span></span><br><span class="line"><span class="string">        疑是地上霜</span></span><br><span class="line"><span class="string">        举头望明月</span></span><br><span class="line"><span class="string">        低头思故乡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h4 id="Java-14"><a href="#Java-14" class="headerlink" title="Java 14"></a>Java 14</h4><p><strong>instanceof模式匹配</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 多态，Integer类型赋值给Object类型</span></span><br><span class="line">        <span class="comment">// 强转之前的判断</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> (Integer) obj;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新写法，如果 obj instanceof Integer 为 true， 则注解赋值给 i(变量名)</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Integer i) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>友好的空指针提示</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNull</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">A</span>().b.test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> B b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BBBBBBBB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317142941449.png" alt="image-20240317142941449" style="zoom: 50%;">

<br>



<p><strong>record</strong></p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317143340694.png" alt="image-20240317143340694" style="zoom:50%;">

<p>在创建类时可以创建record类型的，这个类型的类可以省略get方法，构造方法，toString方法，hashcode方法，equals方法等方法，在jdk 14中预览增加了record类型，16正式上线</p>
<p>record类型的特点</p>
<ul>
<li>它是一个final类</li>
<li>成员变量均为public属性</li>
<li>自动实现equals、hashCode、toString函数</li>
</ul>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">study</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我爱学Java...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在都是用<code>lombok</code>插件来实现这个效果</p>
<br>



<hr>
<h4 id="Java-15"><a href="#Java-15" class="headerlink" title="Java 15"></a>Java 15</h4><p><strong>Sealed Classes</strong></p>
<p>密封类和接口，作用是限制一个类可以由哪些之类继承或者实现</p>
<ul>
<li>如果指定模块的话，sealed class和其之类必须在同一个模块下，如果没用指定模块，则需要在同一个包下</li>
<li>sealed class指定的子类必须直接继承sealed class</li>
<li>sealed class的子类要用final修饰</li>
<li>如果子类也要被继承，则之类也要用sealed修饰</li>
</ul>
<br>



<hr>
<h4 id="Java-16"><a href="#Java-16" class="headerlink" title="Java 16"></a>Java 16</h4><p><strong>包装类构造方法的警告</strong></p>
<p>使用包装类的构造方法在编译时会出现警告，不在建议使用包装类的构造方法，下面代码在javac编译之后会出现警告</p>
<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317145253424.png" alt="image-20240317145253424" style="zoom: 67%;">

<br>



<p><strong>锁对象不要使用包装类</strong></p>
<p>会有警告，包装类底层会有缓冲池，如果锁对象使用包装类，可以会造成不同的锁代码块争抢同一个锁对象的情况</p>
<br>



<p><strong>新增日期字段</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(DateTimeFormatter.ofPattern(<span class="string">&quot;B&quot;</span>).format(LocalDateTime.now()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/image-20240317150208741.png" alt="image-20240317150208741" style="zoom: 50%;">

<br>



<p>传入不同的字符会打印出不同的效果</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Symbol</td>
<td>Meaning</td>
<td>Presentation</td>
<td>Examples</td>
</tr>
<tr>
<td>G</td>
<td>era</td>
<td>text</td>
<td>AD; Anno Domini; A</td>
</tr>
<tr>
<td>u</td>
<td>year</td>
<td>year</td>
<td>2004; 04</td>
</tr>
<tr>
<td>y</td>
<td>year-of-era</td>
<td>year</td>
<td>2004; 04</td>
</tr>
<tr>
<td>D</td>
<td>day-of-year</td>
<td>number</td>
<td>189</td>
</tr>
<tr>
<td>M&#x2F;L</td>
<td>month-of-year</td>
<td>number&#x2F;text</td>
<td>7; 07; Jul; July; J</td>
</tr>
<tr>
<td>d</td>
<td>day-of-month</td>
<td>number</td>
<td>10</td>
</tr>
<tr>
<td>g</td>
<td>modified-julian-day</td>
<td>number</td>
<td>2451334</td>
</tr>
<tr>
<td>Q&#x2F;q</td>
<td>quarter-of-year</td>
<td>number&#x2F;text</td>
<td>3; 03; Q3; 3rd quarter</td>
</tr>
<tr>
<td>Y</td>
<td>week-based-year</td>
<td>year</td>
<td>1996; 96</td>
</tr>
<tr>
<td>w</td>
<td>week-of-week-based-year</td>
<td>number</td>
<td>27</td>
</tr>
<tr>
<td>W</td>
<td>week-of-month</td>
<td>number</td>
<td>4</td>
</tr>
<tr>
<td>E</td>
<td>day-of-week</td>
<td>text</td>
<td>Tue; Tuesday; T</td>
</tr>
<tr>
<td>e&#x2F;c</td>
<td>localized day-of-week</td>
<td>number&#x2F;text</td>
<td>2; 02; Tue; Tuesday; T</td>
</tr>
<tr>
<td>F</td>
<td>day-of-week-in-month</td>
<td>number</td>
<td>3</td>
</tr>
<tr>
<td>a</td>
<td>am-pm-of-day</td>
<td>text</td>
<td>PM</td>
</tr>
<tr>
<td>B</td>
<td>period-of-day</td>
<td>text</td>
<td>in the morning</td>
</tr>
<tr>
<td>h</td>
<td>clock-hour-of-am-pm (1-12)</td>
<td>number</td>
<td>12</td>
</tr>
<tr>
<td>K</td>
<td>hour-of-am-pm (0-11)</td>
<td>number</td>
<td>0</td>
</tr>
<tr>
<td>k</td>
<td>clock-hour-of-day (1-24)</td>
<td>number</td>
<td>24</td>
</tr>
<tr>
<td>H</td>
<td>hour-of-day (0-23)</td>
<td>number</td>
<td>0</td>
</tr>
<tr>
<td>m</td>
<td>minute-of-hour</td>
<td>number</td>
<td>30</td>
</tr>
<tr>
<td>s</td>
<td>second-of-minute</td>
<td>number</td>
<td>55</td>
</tr>
<tr>
<td>S</td>
<td>fraction-of-second</td>
<td>fraction</td>
<td>978</td>
</tr>
<tr>
<td>A</td>
<td>milli-of-day</td>
<td>number</td>
<td>1234</td>
</tr>
<tr>
<td>n</td>
<td>nano-of-second</td>
<td>number</td>
<td>987654321</td>
</tr>
<tr>
<td>N</td>
<td>nano-of-day</td>
<td>number</td>
<td>1234000000</td>
</tr>
<tr>
<td>V</td>
<td>time-zone ID</td>
<td>zone-id</td>
<td>America&#x2F;Los_Angeles; Z; -08:30</td>
</tr>
<tr>
<td>v</td>
<td>generic time-zone name</td>
<td>zone-name</td>
<td>Pacific Time; PT</td>
</tr>
<tr>
<td>z</td>
<td>time-zone name</td>
<td>zone-name</td>
<td>Pacific Standard Time; PST</td>
</tr>
<tr>
<td>O</td>
<td>localized zone-offset</td>
<td>offset-O</td>
<td>GMT+8; GMT+08:00; UTC-08:00</td>
</tr>
<tr>
<td>X</td>
<td>zone-offset ‘Z’ for zero</td>
<td>offset-X</td>
<td>Z; -08; -0830; -08:30; -083015; -08:30:15</td>
</tr>
<tr>
<td>x</td>
<td>zone-offset</td>
<td>offset-x</td>
<td>+0000; -08; -0830; -08:30; -083015; -08:30:15</td>
</tr>
<tr>
<td>Z</td>
<td>zone-offset</td>
<td>offset-Z</td>
<td>+0000; -0800; -08:00</td>
</tr>
<tr>
<td>p</td>
<td>pad next</td>
<td>pad modifier</td>
<td>1</td>
</tr>
<tr>
<td>‘</td>
<td>escape for text</td>
<td>delimiter</td>
<td></td>
</tr>
<tr>
<td>‘’</td>
<td>single quote</td>
<td>literal</td>
<td>‘</td>
</tr>
<tr>
<td>[</td>
<td>optional section start</td>
<td></td>
<td></td>
</tr>
<tr>
<td>]</td>
<td>optional section end</td>
<td></td>
<td></td>
</tr>
<tr>
<td>#</td>
<td>reserved for future use</td>
<td></td>
<td></td>
</tr>
<tr>
<td>{</td>
<td>reserved for future use</td>
<td></td>
<td></td>
</tr>
<tr>
<td>}</td>
<td>reserved for future use</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<br>





<hr>
<h4 id="Java-17"><a href="#Java-17" class="headerlink" title="Java 17"></a>Java 17</h4><p><a target="_blank" rel="noopener" href="http://t.csdnimg.cn/JSS8H">参考文章</a></p>
<p><strong>Sealed  Classes成为正式版</strong></p>
<br>

<p><strong>伪随机数发生变化</strong></p>
<p>增加了伪随机数相关的类和接口来让开发者使用stream流进行操作</p>
<ul>
<li>新接口<code>RandomGenerator</code>：它为所有现有的和新的 PRNG 提供了一个统一的 API。 RandomGenerators 提供名为 ints、longs、doubles、nextBoolean、nextInt、nextLong、nextDouble 和 nextFloat 的方法，以及它们当前的所有参数的变化。从而更容易在应用程序中互换使用各种 PRNG 算法</li>
<li>新类<code>RandomGeneratorFactory</code></li>
</ul>
<br>



<p><strong>switch语法变化</strong>：可以在swatch中减少强转的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Old code</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">formatter</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">formatted</span> <span class="operator">=</span> <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Integer i) &#123;</span><br><span class="line">        formatted = String.format(<span class="string">&quot;int %d&quot;</span>, i);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Long l) &#123;</span><br><span class="line">        formatted = String.format(<span class="string">&quot;long %d&quot;</span>, l);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Double d) &#123;</span><br><span class="line">        formatted = String.format(<span class="string">&quot;double %f&quot;</span>, d);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (o <span class="keyword">instanceof</span> String s) &#123;</span><br><span class="line">        formatted = String.format(<span class="string">&quot;String %s&quot;</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> formatted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New code</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">formatterPatternSwitch</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">switch</span> (o) &#123;</span><br><span class="line">        <span class="keyword">case</span> Integer i -&gt; String.format(<span class="string">&quot;int %d&quot;</span>, i);</span><br><span class="line">        <span class="keyword">case</span> Long l    -&gt; String.format(<span class="string">&quot;long %d&quot;</span>, l);</span><br><span class="line">        <span class="keyword">case</span> Double d  -&gt; String.format(<span class="string">&quot;double %f&quot;</span>, d);</span><br><span class="line">        <span class="keyword">case</span> String s  -&gt; String.format(<span class="string">&quot;String %s&quot;</span>, s);</span><br><span class="line">        <span class="keyword">default</span>        -&gt; o.toString();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>去除了AOT和JIT</strong></p>
<br>



<hr>
<h4 id="Java-18"><a href="#Java-18" class="headerlink" title="Java 18"></a>Java 18</h4><p><strong>默认使用<code>UTF-8</code>字符编码</strong></p>
<p>从jdk 18开始，默认使用UTF-8字符编码，可以通过下面的参数修改为其它字符编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dfile.encoding-UTF-8</span><br></pre></td></tr></table></figure>

<br>



<p><strong>被移除的方法</strong></p>
<p>在jdk 18中，标记了Object中的finalize方法，Thread中的stop方法将在未来被移除</p>
<br>



<p><strong>@snippet注解</strong></p>
<p>以前在文档注释中写代码需要添加code标签，现在通过@snippet注解可以更方便的将文档注解中的代码展示在api文档中</p>
<br>



<hr>
<h4 id="Java-19"><a href="#Java-19" class="headerlink" title="Java 19"></a>Java 19</h4><p><a target="_blank" rel="noopener" href="https://javaguide.cn/java/new-features/java19.html">参考文章</a></p>
<p><strong>虚拟线程</strong>(预览)</p>
<p>它是轻量级线程，可显著减少编写、维护和观察高吞吐量并发应用程序的工作量。 其目标包括以简单的请求线程样式编写的服务器应用程序，使得能够接近最佳的硬件利用率，现有代码能够以最小的更改采用虚拟线程，并启用故障排除、调试和使用现有 JDK 工具分析虚拟线程</p>
<br>



<p><strong>外部函数和API</strong></p>
<p>Java 程序可以通过该 API 与 Java 运行时之外的代码和数据进行互操作。通过高效地调用外部函数（即 JVM 之外的代码）和安全地访问外部内存（即不受 JVM 管理的内存），该 API 使 Java 程序能够调用本机库并处理本机数据，而不会像 JNI 那样危险和脆弱</p>
<br>



<hr>
<h4 id="Java-20"><a href="#Java-20" class="headerlink" title="Java 20"></a>Java 20</h4><p><a target="_blank" rel="noopener" href="https://javaguide.cn/java/new-features/java20.html">参考文章</a></p>
<p><strong>作用域值</strong></p>
<p>作用域值（Scoped Values）它可以在线程内和线程间共享不可变的数据，优于线程局部变量，尤其是在使用大量虚拟线程时。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> ScopedValue&lt;...&gt; V = <span class="keyword">new</span> <span class="title class_">ScopedValue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// In some method</span></span><br><span class="line">ScopedValue.where(V, &lt;value&gt;)</span><br><span class="line">           .run(() -&gt; &#123; ... V.get() ... call methods ... &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// In a method called directly or indirectly from the lambda expression</span></span><br><span class="line">... V.get() ...</span><br></pre></td></tr></table></figure>

<p>作用域值允许在大型程序中的组件之间安全有效地共享数据，而无需求助于方法参数。</p>
<br>



<hr>
<h4 id="Java-21"><a href="#Java-21" class="headerlink" title="Java 21"></a>Java 21</h4><p><strong>字符串模板</strong></p>
<p>String Templates(字符串模板) 目前仍然是 JDK 21 中的一个预览功能。</p>
<p>String Templates 提供了一种更简洁、更直观的方式来动态构建字符串。通过使用占位符<code>$&#123;&#125;</code>，我们可以将变量的值直接嵌入到字符串中，而不需要手动处理。在运行时，Java 编译器会将这些占位符替换为实际的变量值。并且，表达式支持局部变量、静态&#x2F;非静态字段甚至方法、计算结果等特性。</p>
<br>



<p><strong>虚拟线程正式版</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/03/10/Java%E6%96%B0%E7%89%B9%E6%80%A7/" data-id="clywa1f4d001eecve3yuvaawa" data-title="Java新特性" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OAuth2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/15/OAuth2/" class="article-date">
  <time class="dt-published" datetime="2024-02-15T06:22:48.000Z" itemprop="datePublished">2024-02-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/15/OAuth2/">OAuth2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>该笔记学习b站视频制作而成:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14b4y1A7Wz/?share_source=copy_web&vd_source=db8e7458ec195ac74979ce5478cbc624">OAuth2</a></p>
<h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h4><p> OAuth2是一种开放授权协议。，使应用程序能够访问其它公司提供的资源，允许用户在第三方应用访问存储在其他服务器上的私密资源，而在整个过程不需要提供用户名和密码给到第三方应用，可以通过提供一个令牌(token)实现该功能</p>
<br>



<p><strong>OAuth2协议包含以下角色</strong>：</p>
<ul>
<li>资源所有者（Resource Owner）：即用户，资源的拥有人，想要通过客户应用访问资源服务器上的资源。</li>
<li>客户应用（Client）：通常是一个Web或者无线应用，它需要访问用户的受保护资源。</li>
<li>资源服务器（Resource Server）：存储受保护资源的服务器或定义了可以访问到资源的API，接收并验证客户端的访问令牌，以决定是否授权访问资源。</li>
<li>授权服务器（Authorization Server）：负责验证资源所有者的身份并向客户端颁发访问令牌。</li>
</ul>
<br>



<p><img src="/2024/02/15/OAuth2/image-20240311143544782.png"></p>
<br>





<p><strong>OAuth2的使用场景</strong></p>
<p><strong>开放系统间授权</strong></p>
<p>社交登录</p>
<p>在传统的身份验证中，用户需要提供用户名和密码，还有很多网站登录时，允许使用第三方网站的身份，这称为”第三方登录”。所谓第三方登录，实质就是 OAuth 授权。用户想要登录 A 网站，A 网站让用户提供第三方网站的数据，证明自己的身份。获取第三方网站的身份数据，就需要 OAuth 授权。</p>
<p><img src="/2024/02/15/OAuth2/image-20240312113012599.png"></p>
<br>



<p>开放API</p>
<p>例如云冲印服务的实现</p>
<p><img src="/2024/02/15/OAuth2/image-20240312113053760.png"></p>
<br>



<p><strong>现代微服务安全</strong></p>
<p>单块应用安全</p>
<p><img src="/2024/02/15/OAuth2/image-20240312113139214.png"></p>
<p>微服务安全</p>
<p><img src="/2024/02/15/OAuth2/image-20240312113159332.png"></p>
<br>



<p><strong>企业内部应用认证授权</strong></p>
<ul>
<li><p>SSO：Single Sign On 单点登录</p>
</li>
<li><p>IAM：Identity and Access Management 身份识别与访问管理</p>
</li>
</ul>
<br>



<hr>
<h4 id="2-四种授权模式"><a href="#2-四种授权模式" class="headerlink" title="2. 四种授权模式"></a>2. 四种授权模式</h4><ul>
<li>授权码（authorization-code）</li>
<li>隐藏式（implicit）</li>
<li>密码式（password）</li>
<li>客户端凭证（client credentials）</li>
</ul>
<br>





<p><strong>授权码</strong></p>
<p>授权码（authorization code），指的是第三方应用先申请一个授权码，然后再用该码获取令牌。</p>
<p>这种方式是最常用，最复杂，也是最安全的，它适用于那些有后端的 Web 应用。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。</p>
<p><img src="/2024/02/15/OAuth2/image-20240312114148859.png"></p>
<br>





<p><strong>隐藏式</strong></p>
<p>隐藏式（implicit），也叫简化模式，有些 Web 应用是纯前端应用，没有后端。这时就不能用上面的方式了，必须将令牌储存在前端</p>
<p>RFC 6749 规定了这种方式，允许直接向前端颁发令牌。这种方式没有授权码这个中间步骤，所以称为隐藏式。这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间（session）有效，浏览器关掉，令牌就失效了</p>
<p><img src="/2024/02/15/OAuth2/image-20240312114245519.png"></p>
<br>





<p><strong>密码式</strong></p>
<p>密码式（Resource Owner Password Credentials）：如果你高度信任某个应用，RFC 6749 也允许用户把用户名和密码，直接告诉该应用。该应用就使用你的密码，申请令牌</p>
<p>这种方式需要用户给出自己的用户名&#x2F;密码，显然风险很大，因此只适用于其他授权方式都无法采用的情况，而且必须是用户高度信任的应用</p>
<p><img src="/2024/02/15/OAuth2/image-20240312114321770.png"></p>
<br>





<p><strong>凭证式</strong></p>
<p>凭证式（client credentials）：也叫客户端模式，适用于没有前端的命令行应用，即在命令行下请求令牌。</p>
<p>这种方式给出的令牌，是针对第三方应用的，而不是针对用户的，即有可能多个用户共享同一个令牌</p>
<p><img src="/2024/02/15/OAuth2/image-20240312114350948.png"></p>
<br>



<hr>
<h4 id="3-授权模式的选择"><a href="#3-授权模式的选择" class="headerlink" title="3. 授权模式的选择"></a>3. 授权模式的选择</h4><img src="/2024/02/15/OAuth2/image-20240312115537013.png" alt="image-20240312115537013" style="zoom:67%;">

<br>



<hr>
<h4 id="4-Spring中OAuth2的实现"><a href="#4-Spring中OAuth2的实现" class="headerlink" title="4. Spring中OAuth2的实现"></a>4. Spring中OAuth2的实现</h4><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html">OAuth2 :: Spring Security</a></p>
<br>



<p><strong>Spring Security</strong></p>
<ul>
<li>客户应用（OAuth2 Client）：OAuth2客户端功能中包含OAuth2 Login</li>
<li>资源服务器（OAuth2 Resource Server）</li>
</ul>
<p><strong>Spring</strong></p>
<ul>
<li>授权服务器（Spring Authorization Server）：它是在Spring Security之上的一个单独的项目。</li>
</ul>
<br>



<p><strong>相关依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 资源服务器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-oauth2-resource-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 客户应用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-oauth2-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 授权服务器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-oauth2-authorization-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<br>



<hr>
<h4 id="5-Github授权登录案例"><a href="#5-Github授权登录案例" class="headerlink" title="5. Github授权登录案例"></a>5. Github授权登录案例</h4><p>登录GitHub，在开发者设置(点击用户头像，选择settings)中找到OAuth Apps，创建一个application，为客户应用创建访问GitHub的凭据：</p>
<p><img src="/2024/02/15/OAuth2/image-20240312122845556.png"></p>
<br>



<p>填写应用信息：<code>默认的重定向URI模板为&#123;baseUrl&#125;/login/oauth2/code/&#123;registrationId&#125;</code>。registrationId是ClientRegistration的唯一标识符</p>
<p><img src="/2024/02/15/OAuth2/image-20240312122917326.png"></p>
<br>

<p>获取应用程序id，生成应用程序密钥：</p>
<p>生成后记得保存程序密钥，不然保存配置后密钥就会隐藏前面的数字</p>
<p><img src="/2024/02/15/OAuth2/image-20240312123004642.png" alt="image-20240312123004642"></p>
<br>



<p><strong>创建测试项目</strong></p>
<p>引入相关的依赖</p>
<img src="/2024/02/15/OAuth2/image-20240312123051807.png" alt="image-20240312123051807" style="zoom:67%;">

<br>



<p>官方代码参考案例：示例代码参考：<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-security-samples/tree/6.2.x/servlet/spring-boot/java/oauth2/login">spring-security-samples&#x2F;servlet&#x2F;spring-boot&#x2F;java&#x2F;oauth2&#x2F;login at 6.2.x · spring-projects&#x2F;spring-security-samples (github.com)</a></p>
<br>



<p><strong>在application.yml中写入相关配置</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">oauth2:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">registration:</span></span><br><span class="line">          <span class="attr">github:</span></span><br><span class="line">            <span class="attr">client-id:</span> <span class="string">a9f7db7266f11042e686</span></span><br><span class="line">            <span class="attr">client-secret:</span> <span class="string">a9ef5aef572ac17ec6d45a5bbad909ca00950118</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.security.core.annotation.AuthenticationPrincipal;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.oauth2.client.OAuth2AuthorizedClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.oauth2.core.user.OAuth2User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(</span></span><br><span class="line"><span class="params">            Model model,</span></span><br><span class="line"><span class="params">            <span class="meta">@RegisteredOAuth2AuthorizedClient</span> OAuth2AuthorizedClient authorizedClient,</span></span><br><span class="line"><span class="params">            <span class="meta">@AuthenticationPrincipal</span> OAuth2User oauth2User)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;userName&quot;</span>, oauth2User.getName());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;clientName&quot;</span>, authorizedClient.getClientRegistration().getClientName());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;userAttributes&quot;</span>, oauth2User.getAttributes());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建index页面</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;https://www.thymeleaf.org&quot;</span> <span class="attr">xmlns:sec</span>=<span class="string">&quot;https://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spring Security - OAuth 2.0 Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float: right&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;logout&quot;</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float:left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:bold&quot;</span>&gt;</span>User: <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float:none&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float:right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Logout&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>OAuth 2.0 Login with Spring Security<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    You are successfully logged in <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:bold&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    via the OAuth 2.0 Client <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:bold&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;clientName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:bold&quot;</span>&gt;</span>User Attributes:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;userAttribute : $&#123;userAttributes&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:bold&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;userAttribute.key&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;userAttribute.value&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>启动程序</strong></p>
<ul>
<li>启动程序并访问localhost:8080。浏览器将被重定向到默认的自动生成的登录页面，该页面显示了一个用于GitHub登录的链接。</li>
<li>点击GitHub链接，浏览器将被重定向到GitHub进行身份验证。</li>
<li>使用GitHub账户凭据进行身份验证后，用户会看到授权页面，询问用户是否允许或拒绝客户应用访问GitHub上的用户数据。点击允许以授权OAuth客户端访问用户的基本个人资料信息。</li>
<li>此时，OAuth客户端访问GitHub的获取用户信息的接口获取基本个人资料信息，并建立一个已认证的会话。</li>
</ul>
<br>





<p>访问localhost:8080,会直接跳转到github授权登录页面</p>
<img src="/2024/02/15/OAuth2/image-20240312124808269.png" alt="image-20240312124808269" style="zoom: 50%;">

<br>



<p>访问localhost:8080&#x2F;login</p>
<img src="/2024/02/15/OAuth2/image-20240312124923984.png" alt="image-20240312124923984" style="zoom:67%;">

<p>点击GIthub登录</p>
<img src="/2024/02/15/OAuth2/image-20240312125003753.png" alt="image-20240312125003753" style="zoom: 50%;">

<br>



<p>上面这种直接显示账号是因为我已经在Github登录了</p>
<p>退出GIthub后再次测试登录</p>
<img src="/2024/02/15/OAuth2/image-20240312125157054.png" alt="image-20240312125157054" style="zoom:50%;">

<br>

<p>登录成功后会获取相关信息</p>
<img src="/2024/02/15/OAuth2/image-20240312125929641.png" alt="image-20240312125929641" style="zoom: 67%;">

<br>



<p><strong>登录流程</strong></p>
<ol>
<li><strong>A 网站让用户跳转到 GitHub，并携带参数ClientID 以及 Redirection URI。</strong></li>
<li>GitHub 要求用户登录，然后询问用户”A 网站要求获取用户信息的权限，你是否同意？”</li>
<li>用户同意，GitHub 就会重定向回 A 网站，同时发回一个授权码。</li>
<li><strong>A 网站使用授权码，向 GitHub 请求令牌。</strong></li>
<li>GitHub 返回令牌.</li>
<li><strong>A 网站使用令牌，向 GitHub 请求用户数据。</strong></li>
<li>GitHub返回用户数据</li>
<li><strong>A 网站使用 GitHub用户数据登录</strong></li>
</ol>
<img src="/2024/02/15/OAuth2/image-20240312125944791.png" alt="image-20240312125944791" style="zoom: 80%;">

<br>



<p><strong>CommonOAuth2Provider</strong></p>
<p>CommonOAuth2Provider是一个预定义的通用OAuth2Provider，为一些知名资源服务API提供商（如Google、GitHub、Facebook）预定义了一组默认的属性。</p>
<p>例如，<strong>授权URI、令牌URI和用户信息URI</strong>通常不经常变化。因此，提供默认值以减少所需的配置。</p>
<p>因此，当我们配置GitHub客户端时，只需要提供client-id和client-secret属性。</p>
<img src="/2024/02/15/OAuth2/image-20240312130135072.png" alt="image-20240312130135072" style="zoom: 67%;">

<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GITHUB &#123;</span><br><span class="line">    <span class="keyword">public</span> ClientRegistration.Builder <span class="title function_">getBuilder</span><span class="params">(String registrationId)</span> &#123;</span><br><span class="line">        ClientRegistration.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="built_in">this</span>.getBuilder(</span><br><span class="line">        registrationId, </span><br><span class="line">        ClientAuthenticationMethod.CLIENT_SECRET_BASIC, </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//授权回调地址(GitHub向客户应用发送回调请求，并携带授权码)   </span></span><br><span class="line">		<span class="string">&quot;&#123;baseUrl&#125;/&#123;action&#125;/oauth2/code/&#123;registrationId&#125;&quot;</span>);</span><br><span class="line">        builder.scope(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;read:user&quot;</span>&#125;);</span><br><span class="line">        <span class="comment">//授权页面</span></span><br><span class="line">        builder.authorizationUri(<span class="string">&quot;https://github.com/login/oauth/authorize&quot;</span>);</span><br><span class="line">        <span class="comment">//客户应用使用授权码，向 GitHub 请求令牌</span></span><br><span class="line">        builder.tokenUri(<span class="string">&quot;https://github.com/login/oauth/access_token&quot;</span>);</span><br><span class="line">        <span class="comment">//客户应用使用令牌向GitHub请求用户数据</span></span><br><span class="line">        builder.userInfoUri(<span class="string">&quot;https://api.github.com/user&quot;</span>);</span><br><span class="line">        <span class="comment">//username属性显示GitHub中获取的哪个属性的信息</span></span><br><span class="line">        builder.userNameAttributeName(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="comment">//登录页面超链接的文本</span></span><br><span class="line">        builder.clientName(<span class="string">&quot;GitHub&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/02/15/OAuth2/" data-id="clywa1f4b0014ecve7zn4cc91" data-title="OAuth2" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" rel="tag">权限管理</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Spring-Security学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-02-03T11:50:46.000Z" itemprop="datePublished">2024-02-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Spring Security学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>该笔记学习b站视频制作而成:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14b4y1A7Wz/?share_source=copy_web&vd_source=db8e7458ec195ac74979ce5478cbc624">Spring Security6</a></p>
<h3 id="一-Spring-Security-基本功能"><a href="#一-Spring-Security-基本功能" class="headerlink" title="一. Spring Security 基本功能"></a>一. Spring Security 基本功能</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h4><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/reference/index.html">官方文档</a></p>
<p>Spring Security 是 Spring家族中的一个安全管理框架它提供了更丰富的功能如身份验证、授权、防御常见攻击</p>
<ul>
<li>身份验证：验证谁正在访问系统，判断用户使是否为合法用户</li>
<li>授权：用户在进行身份验证后系统会控制谁能访问哪些资源，这个过程叫授权。也就是权限管理，给不同权限的用户提供不同的功能</li>
<li>防御常见的攻击<ul>
<li>CSRF</li>
<li>HTTP Headers</li>
<li>HTTP Requests</li>
</ul>
</li>
</ul>
<br>



<hr>
<h4 id="2-身份验证基础案例"><a href="#2-身份验证基础案例" class="headerlink" title="2. 身份验证基础案例"></a>2. 身份验证基础案例</h4><p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-security-sampies/tree/main">官方代码实例</a></p>
<br>



<p>导入先关依赖，这里用到的依赖有Spring Web、Spring Security和Thymeleaf。Spring Boot版本是3.2.0，JDK的版本是17</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<br>



<p>创建一个controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>创建一个html放在templates下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;https://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Security!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Security<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>Log out<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p>启动项目并访问8080端口</p>
<p>可以看到访问8080端口时会自动跳转到Login页面，这个页面是Spring Security自带的</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226153202913.png" alt="image-20240226153202913"></p>
<br>



<p>这里由于没有使用梯子，有css样式没有加载出来</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226153453346.png" alt="image-20240226153453346"></p>
<br>



<p>默认的用户名是user，用户密码随机生成并打印在控制台上</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226153720217.png" alt="image-20240226153720217"></p>
<br>



<p>登录后就是刚刚添加的index页面</p>
<p>点击Log out可以退出</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226153815915.png" alt="image-20240226153815915"></p>
<br>



<p><strong>Spring Security默认做了许多</strong></p>
<ul>
<li>保护应用程序URL，要求对应用程序的任何交互进行身份验证</li>
<li>程序启动时生成一个默认的用户”user”</li>
<li>生成一个默认的随机密码，并打印在控制台上</li>
<li>生成默认的登录表单和注销页面</li>
<li>提供基于表单的登录和注销流程</li>
<li>对于Web请求，重新定向到登录页面</li>
<li>对于服务请求，返回401未授权</li>
</ul>
<hr>
<h4 id="3-SecurityProperties"><a href="#3-SecurityProperties" class="headerlink" title="3. SecurityProperties"></a>3. SecurityProperties</h4><p>SecurityProperties是Spring Security框架中的一个类，在这个类中定义了一些Security相关的属性，例如登录时的默认用户“user”和随机生成的密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.security&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BASIC_AUTH_ORDER</span> <span class="operator">=</span> <span class="number">2147483642</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IGNORED_ORDER</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_FILTER_ORDER</span> <span class="operator">=</span> -<span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecurityProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Filter <span class="title function_">getFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> -<span class="number">100</span>;</span><br><span class="line">        <span class="keyword">private</span> Set&lt;DispatcherType&gt; dispatcherTypes = EnumSet.allOf(DispatcherType.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Filter</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.order;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrder</span><span class="params">(<span class="type">int</span> order)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.order = order;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Set&lt;DispatcherType&gt; <span class="title function_">getDispatcherTypes</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.dispatcherTypes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDispatcherTypes</span><span class="params">(Set&lt;DispatcherType&gt; dispatcherTypes)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.dispatcherTypes = dispatcherTypes;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">passwordGenerated</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.password;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasLength(password)) &#123;</span><br><span class="line">                <span class="built_in">this</span>.passwordGenerated = <span class="literal">false</span>;</span><br><span class="line">                <span class="built_in">this</span>.password = password;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getRoles</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.roles;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoles</span><span class="params">(List&lt;String&gt; roles)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.roles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(roles);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPasswordGenerated</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.passwordGenerated;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>我们可以通过自定义配置在<code>application.properties</code>中来定义用户名和密码<br>设置好的用户名和登录密码会替换掉<code>SecurityProperties</code>类中的，控制台也不再打印密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.security.user.name=zheng</span><br><span class="line">spring.security.user.password=123456</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h3 id="二-自定义配置"><a href="#二-自定义配置" class="headerlink" title="二. 自定义配置"></a>二. 自定义配置</h3><h4 id="1-基于内存的用户认证"><a href="#1-基于内存的用户认证" class="headerlink" title="1. 基于内存的用户认证"></a>1. 基于内存的用户认证</h4><p>创建一个config类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建基于内存的用户信息管理器</span></span><br><span class="line">        <span class="type">InMemoryUserDetailsManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用manager管理UserDetails对象</span></span><br><span class="line">        manager.createUser(</span><br><span class="line">                <span class="comment">// 创建UserDetails对象，用于管理用户名，用户密码，用户角色，用户权限等内容</span></span><br><span class="line">                User.withDefaultPasswordEncoder().username(<span class="string">&quot;user&quot;</span>).password(<span class="string">&quot;password&quot;</span>).roles(<span class="string">&quot;USER&quot;</span>).build()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>启动应用程序</p>
<p>这时候在<code>application.properties</code>配置的用户名和密码生效，需要使用<code>config</code>类中的用户名和密码</p>
<br>



<hr>
<h4 id="2-基于内存的用户认证流程"><a href="#2-基于内存的用户认证流程" class="headerlink" title="2. 基于内存的用户认证流程"></a>2. 基于内存的用户认证流程</h4><ul>
<li>程序启动时：<ul>
<li>创建<code>InMemoryUserDetailsManger</code>对象</li>
<li>创建<code>User</code>对象，封装用户名和密码</li>
<li>使用<code>InMemoryUserDetailsManager</code>将User存入<code>内存</code>中</li>
</ul>
</li>
<li>校验用户<ul>
<li>Spring Security自动使用<code>InMemoryUserDetailsManager</code>的<code>loadUserByUsername</code>方法从<code>内存</code>中获取User对象</li>
<li>在<code>UsernamePasswordAuthenticationFilter</code>过滤器中的<code>attemptAuthentication</code>方法中将用户输入的用户名、密码和内存中获取到的用户信息进行比对，进行用户认证</li>
<li><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226161031758.png" alt="image-20240226161031758"></li>
</ul>
</li>
</ul>
<br>



<hr>
<h4 id="3-基于数据库的数据流"><a href="#3-基于数据库的数据流" class="headerlink" title="3. 基于数据库的数据流"></a>3. 基于数据库的数据流</h4><p><strong>创建数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `security<span class="operator">-</span>demo`;</span><br><span class="line">USE `security<span class="operator">-</span>demo`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`(</span><br><span class="line">	`id` <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	`username` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">	`password` <span class="type">VARCHAR</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`enabled` <span class="type">BOOLEAN</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 唯一索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX `user_username_uindex` <span class="keyword">ON</span> `<span class="keyword">user</span>`(`username`); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入用户数据(密码是 &quot;password&quot; )</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` (`username`, `password`, `enabled`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;&#123;bcrypt&#125;$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW&#x27;</span>, <span class="literal">TRUE</span>),</span><br><span class="line">(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;&#123;bcrypt&#125;$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW&#x27;</span>, <span class="literal">TRUE</span>),</span><br><span class="line">(<span class="string">&#x27;zhengge&#x27;</span>, <span class="string">&#x27;&#123;bcrypt&#125;$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW&#x27;</span>, <span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226162231954.png" alt="image-20240226162231954"></p>
<br>



<p><strong>引入依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.30&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.4.1&lt;/version&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>配置数据源</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MySQL数据源</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/security-demo</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">020427</span></span><br><span class="line"><span class="comment">#SQL日志</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建实体类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建mapper层</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.securitydemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.entiry.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建对应的xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.zheng.securitydemo.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建service层</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.securitydemo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.entiry.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.securitydemo.service.ServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.entiry.User;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建controller层</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.list();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p><strong>测试</strong></p>
<p>登录后再访问&#x2F;user&#x2F;list，可以查询出刚刚数据库表中的数据</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226170455832.png" alt="image-20240226170455832"></p>
<br>



<hr>
<h4 id="4-基于数据库的用户认证流程分析"><a href="#4-基于数据库的用户认证流程分析" class="headerlink" title="4. 基于数据库的用户认证流程分析"></a>4. 基于数据库的用户认证流程分析</h4><p>可以看见基于内存的用户信息管理器是实现了<code>UserDetailsManager</code>接口和<code>UserDetailsPasswordService</code>接口，同时在<code>UserDetailsManager</code>接口中声明了创建user的相关方法。所以要创建基于数据库的用户认证，需要创建一个类<code>DBUserDetailsManger</code>来实现<code>UserDetailsManager</code>接口和<code>UserDetailsPasswordService</code>接口，充当用户信息管理器的身份</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226170817342.png" alt="image-20240226170817342" style="zoom: 67%;">

<br>



<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226170956445.png" alt="image-20240226170956445" style="zoom:67%;">

<br>



<p><strong>流程</strong></p>
<ul>
<li>程序启动时：<ul>
<li>创建<code>DBUserDetailsManger</code>类的对象，实现<code>UserDetailsManager</code>接口和<code>UserDetailsPasswordService</code>接口</li>
</ul>
</li>
<li>校验用户<ul>
<li>Spring Security自动使用<code>DBUserDetailsManger</code>的<code>loadUserByUsername</code>方法从<code>数据库</code>中获取User对象</li>
<li>在<code>UsernamePasswordAuthenticationFilter</code>过滤器中的<code>attemptAuthentication</code>方法中将用户输入的用户名、密码和内存中获取到的用户信息进行比对，进行用户认证</li>
</ul>
</li>
</ul>
<br>



<h4 id="5-基于数据库的用户认证实现"><a href="#5-基于数据库的用户认证实现" class="headerlink" title="5. 基于数据库的用户认证实现"></a>5. 基于数据库的用户认证实现</h4><p>创建DBUserDetailsManger类并实现<code>UserDetailsManager</code>接口和<code>UserDetailsPasswordService</code>接口<br>用户登录验证的流程在<code>loadUserByUsername</code>方法中实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.securitydemo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.entiry.User;</span><br><span class="line"><span class="keyword">import</span> com.zheng.securitydemo.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsPasswordService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.provisioning.UserDetailsManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayDeque;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBUserDetailsManager</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsManager</span>, UserDetailsPasswordService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">updatePassword</span><span class="params">(UserDetails user, String newPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(UserDetails user)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserDetails user)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(String oldPassword, String newPassword)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userExists</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 从数据库中获取用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 组装查询条件</span></span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;username&quot;</span>, username);<span class="comment">// 通过usernam查询</span></span><br><span class="line">        <span class="comment">// 获取用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123; <span class="comment">// 没有获取到用户信息</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(username);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            Collection&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();<span class="comment">// 权限列表</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">org</span>.springframework.security.core.userdetails.User(</span><br><span class="line">                    user.getUsername(),</span><br><span class="line">                    user.getPassword(),</span><br><span class="line">                    user.getEnabled(),</span><br><span class="line">                    <span class="literal">true</span>, <span class="comment">// user.isAccountNonExpired(), 用户账号是否过期</span></span><br><span class="line">                    <span class="literal">true</span>, <span class="comment">// user.isCredentialsNonExpired(), 用户凭证是否过期</span></span><br><span class="line">                    <span class="literal">true</span>, <span class="comment">//user.isAccountNonLocked(), 用户是否未被锁定</span></span><br><span class="line">                    authorities <span class="comment">//user.getAuthorities()); 权限列表</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>测试，把config中<code>UserDetailsService</code>的代码注释掉，然后启动程序</p>
<p>输入数据库中的账号密码然后登录成功</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226173539970.png" alt="image-20240226173539970"></p>
<br>



<hr>
<h4 id="6-Spring-Security的默认配置"><a href="#6-Spring-Security的默认配置" class="headerlink" title="6. Spring Security的默认配置"></a>6. Spring Security的默认配置</h4><p>在Spring Security中有以下默认配置,默认的登录页面开启也是在这里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开启授权保护</span></span><br><span class="line">    http.authorizeRequests(authorize -&gt; </span><br><span class="line">                           authorize.anyRequest() <span class="comment">// anyRequest()：对所有请求开启授权保护</span></span><br><span class="line">                           .authenticated()) <span class="comment">// authenticated()：已认证请求会自动被授权</span></span><br><span class="line">        .formLogin(withDefaults()) <span class="comment">// 表单授权方式</span></span><br><span class="line">        .httpBasic(withDefaults()); <span class="comment">// 基本授权方式</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> http.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<hr>
<h4 id="7-添加用户功能实现"><a href="#7-添加用户功能实现" class="headerlink" title="7. 添加用户功能实现"></a>7. 添加用户功能实现</h4><p>在UserController中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    userService.saveUserDetails(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>在UserServiceImpl实现中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DBUserDetailsManager dbUserDetailsManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUserDetails</span><span class="params">(User user)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> org.springframework.security.core.userdetails.User</span><br><span class="line">            .withDefaultPasswordEncoder()</span><br><span class="line">            .username(user.getUsername()) <span class="comment">//自定义用户名</span></span><br><span class="line">            .password(user.getPassword()) <span class="comment">//自定义密码</span></span><br><span class="line">            .build();</span><br><span class="line">    dbUserDetailsManager.createUser(userDetails);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>修改<code>DBUserDetailsManager</code>中的<code>createUser</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 向数据库中插入新的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(UserDetails userDetails)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(userDetails.getUsername());</span><br><span class="line">    user.setPassword(userDetails.getPassword());</span><br><span class="line">    user.setEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>测试</strong></p>
<p>引入swagger依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--swagger测试--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p>启动项目并登录，然后进入doc.html页面</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226181234369.png" alt="image-20240226181234369" style="zoom: 50%;">

<br>



<p>由于没有编写前端，无法向后端传递csrf验证，所以先关闭csrf防御</p>
<p>在上面的默认配置<code>filterChain</code>中添加一下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭csrf攻击防御</span></span><br><span class="line">http.csrf(csrf -&gt; csrf.disable());</span><br></pre></td></tr></table></figure>

<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226181948070.png" alt="image-20240226181948070" style="zoom:67%;">

<br>



<p>重新启动项目，进行调试</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226182143008.png" alt="image-20240226182143008" style="zoom: 50%;">

<br>



<p>发送请求后刷新数据库，可以看到zhangsan已经添加到数据库中</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226182241051.png" alt="image-20240226182241051"></p>
<br>



<p>删除，修改用户的过程和添加大致一样</p>
<br>



<hr>
<h4 id="8-密码加密算法"><a href="#8-密码加密算法" class="headerlink" title="8. 密码加密算法"></a>8. 密码加密算法</h4><p><strong>明文密码：</strong></p>
<p>最初，密码以明文形式存储在数据库中。但是恶意用户可能会通过SQL注入等手段获取到明文密码，或者程序员将数据库数据泄露的情况也可能发生。</p>
<br>



<p><strong>Hash算法：</strong></p>
<p>Spring Security的<code>PasswordEncoder</code>接口用于对密码进行<code>单向转换</code>，从而将密码安全地存储。对密码单向转换需要用到<code>哈希算法</code>，例如MD5、SHA-256、SHA-512等，哈希算法是单向的，<code>只能加密，不能解密</code>。</p>
<p>因此，<code>数据库中存储的是单向转换后的密码</code>，Spring Security在进行用户身份验证时需要将用户输入的密码进行单向转换，然后与数据库的密码进行比较。</p>
<p>因此，如果发生数据泄露，只有密码的单向哈希会被暴露。由于哈希是单向的，并且在给定哈希的情况下只能通过<code>暴力破解的方式猜测密码</code>。</p>
<br>



<p><strong>彩虹表：</strong></p>
<p>恶意用户创建称为<code>彩虹表</code>的查找表。</p>
<p>彩虹表就是一个庞大的、针对各种可能的字母组合预先生成的哈希值集合，有了它可以快速破解各类密码。越是复杂的密码，需要的彩虹表就越大，主流的彩虹表都是100G以上，目前主要的算法有LM, NTLM, MD5, SHA1, MYSQLSHA1, HALFLMCHALL, NTLMCHALL, ORACLE-SYSTEM, MD5-HALF。</p>
<br>



<p><strong>加盐密码：</strong></p>
<p>为了减轻彩虹表的效果，开发人员开始使用加盐密码。不再只使用密码作为哈希函数的输入，而是为每个用户的密码生成随机字节（称为盐）。盐和用户的密码将一起经过哈希函数运算，生成一个唯一的哈希。盐将以明文形式与用户的密码一起存储。然后，当用户尝试进行身份验证时，盐和用户输入的密码一起经过哈希函数运算，再与存储的密码进行比较。唯一的盐意味着彩虹表不再有效，因为对于每个盐和密码的组合，哈希都是不同的。</p>
<br>



<p><strong>自适应单向函数：</strong></p>
<p>随着硬件的不断发展，加盐哈希也不再安全。原因是，计算机可以每秒执行数十亿次哈希计算。这意味着我们可以轻松地破解每个密码。</p>
<p>现在，开发人员开始使用自适应单向函数来存储密码。使用自适应单向函数验证密码时，<code>故意占用资源（故意使用大量的CPU、内存或其他资源）</code>。自适应单向函数允许配置一个<code>“工作因子”</code>，随着硬件的改进而增加。我们建议将“工作因子”调整到系统中验证密码需要约一秒钟的时间。这种权衡是为了<code>让攻击者难以破解密码</code>。</p>
<p>自适应单向函数包括<code>bcrypt、PBKDF2、scrypt和argon2</code>。Spring Security 默认采用的是bcrypt</p>
<br>



<p><strong>BCryptPasswordEncoder(bcryot)</strong></p>
<p>使用广泛支持的bcrypt算法来对密码进行哈希。为了增加对密码破解的抵抗力，bcrypt故意设计得较慢。和其他自适应单向函数一样，应该调整其参数，使其在您的系统上验证一个密码大约需要1秒的时间。BCryptPasswordEncoder的默认实现使用强度10。建议您在自己的系统上调整和测试强度参数，以便验证密码时大约需要1秒的时间。</p>
<br>



<p><strong>Argon2PasswordEncoder(argon2)</strong></p>
<p>使用Argon2算法对密码进行哈希处理。Argon2是密码哈希比赛的获胜者。为了防止在自定义硬件上进行密码破解，Argon2是一种故意缓慢的算法，需要大量内存。与其他自适应单向函数一样，它应该在您的系统上调整为大约1秒来验证一个密码。当前的Argon2PasswordEncoder实现需要使用BouncyCastle库。</p>
<br>



<p><strong>Pbkdf2PasswordEncoder(PBKDF2)</strong></p>
<p>使用PBKDF2算法对密码进行哈希处理。为了防止密码破解，PBKDF2是一种故意缓慢的算法。与其他自适应单向函数一样，它应该在您的系统上调整为大约1秒来验证一个密码。当需要FIPS认证时，这种算法是一个很好的选择。</p>
<br>



<p><strong>SCryptPasswordEncoder(scrypt)</strong> </p>
<p>使用scrypt算法对密码进行哈希处理。为了防止在自定义硬件上进行密码破解，scrypt是一种故意缓慢的算法，需要大量内存。与其他自适应单向函数一样，它应该在您的系统上调整为大约1秒来验证一个密码。</p>
<br>



<p><strong>在测试类进行测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPassword</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工作因子，默认值是10，最小值是4，最大值是31，值越大运算速度越慢</span></span><br><span class="line">    <span class="type">PasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">//明文：&quot;password&quot;</span></span><br><span class="line">    <span class="comment">//密文：result，即使明文密码相同，每次生成的密文也不一致</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> encoder.encode(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//密码校验</span></span><br><span class="line">    Assert.isTrue(encoder.matches(<span class="string">&quot;password&quot;</span>, result), <span class="string">&quot;密码不一致&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226185017817.png" alt="image-20240226185017817" style="zoom:67%;">

<br>



<hr>
<h4 id="9-自定义登录页"><a href="#9-自定义登录页" class="headerlink" title="9. 自定义登录页"></a>9. 自定义登录页</h4><p>创建LoginController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>在templates目录下创建login.html登录页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;https://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;param.error&#125;&quot;</span>&gt;</span></span><br><span class="line">    错误的用户名和密码.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--method必须为&quot;post&quot;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--th:action=&quot;@&#123;/login&#125;&quot; ，</span></span><br><span class="line"><span class="comment">使用动态参数，表单中会自动生成_csrf隐藏字段，用于防止csrf攻击</span></span><br><span class="line"><span class="comment">login: 和登录页面保持一致即可，SpringSecurity自动进行登录认证--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--name必须为&quot;username&quot;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--name必须为&quot;password&quot;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>



<p>修改filterChain中的配置,修改formLogin中的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 开启授权保护</span></span><br><span class="line">        http.authorizeRequests(authorize -&gt;</span><br><span class="line">                        authorize.anyRequest() <span class="comment">// anyRequest()：对所有请求开启授权保护</span></span><br><span class="line">                                .authenticated()) <span class="comment">// authenticated()：已认证请求会自动被授权</span></span><br><span class="line">                .formLogin(form -&gt; &#123;</span><br><span class="line">                    form.loginPage(<span class="string">&quot;/login&quot;</span>).permitAll();</span><br><span class="line">                &#125;); <span class="comment">// 使用表单授权登录方式</span></span><br><span class="line"><span class="comment">//                .httpBasic(withDefaults()); // 基本授权方式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭csrf攻击防御</span></span><br><span class="line">        http.csrf(csrf -&gt; csrf.disable());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226192523742.png" alt="image-20240226192523742" style="zoom:67%;">

<br>



<p>运行项目，这是项目的登录页面已经改为自定义的登录页面</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240226192702309.png" alt="image-20240226192702309"></p>
<br>





<hr>
<h3 id="三-前后端分离"><a href="#三-前后端分离" class="headerlink" title="三. 前后端分离"></a>三. 前后端分离</h3><h4 id="1-用户认证成功代码实现"><a href="#1-用户认证成功代码实现" class="headerlink" title="1. 用户认证成功代码实现"></a>1. 用户认证成功代码实现</h4><p><strong>用户认证流程</strong></p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240304121307712.png" alt="image-20240304121307712"></p>
<br>



<p><strong>引入<code>fastjson</code>依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.37&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>用户认证成功代码实现</strong></p>
<p>创建一个自定义类MyAuthenticationSuccessHandler实现接口<code>AuthenticationSuccessHandler</code>，并实现接口中的方法<code>onAuthenticationSuccess</code>，然后在方法中编写用户认证成功后的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 用户登录成功时返回的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal(); <span class="comment">// 获取用户身份信息</span></span><br><span class="line"><span class="comment">//        Object credentials = authentication.getCredentials(); // 获取用户凭证信息</span></span><br><span class="line"><span class="comment">//        Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities(); // 获取用户权限信息</span></span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, <span class="number">0</span>); <span class="comment">// 成功</span></span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;data&quot;</span>, principal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果对象转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回json数据到前端</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240304124017181.png" alt="image-20240304124017181" style="zoom:67%;">

<br>



<p><strong>测试</strong></p>
<p>登录成功后返回相关信息</p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240304124120562.png" alt="image-20240304124120562"></p>
<br>



<hr>
<h4 id="2-用户认证失败代码实现"><a href="#2-用户认证失败代码实现" class="headerlink" title="2. 用户认证失败代码实现"></a>2. 用户认证失败代码实现</h4><p>创建一个自定义类MyAuthenticationFailureHandler实现接口<code>AuthenticationFailureHandler</code>，并实现接口中的方法<code>onAuthenticationFailure</code>，然后在方法中编写用户认证失败后的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationFailureHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">localizedMessage</span> <span class="operator">=</span> exception.getLocalizedMessage();</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, -<span class="number">1</span>); <span class="comment">// 失败</span></span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, localizedMessage);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果对象转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回json数据到前端</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240304124915432.png" alt="image-20240304124915432" style="zoom: 67%;">

<br>



<p><strong>测试</strong></p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240304125601732.png"></p>
<br>



<hr>
<h4 id="3-注销用户处理"><a href="#3-注销用户处理" class="headerlink" title="3. 注销用户处理"></a>3. 注销用户处理</h4><p>创建一个自定义类MyLogoutSuccessHandler实现接口<code>LogoutSuccessHandler</code>，并实现接口中的方法<code>onLogoutSuccess</code>，然后在方法中编写用户注销后的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, <span class="number">0</span>); <span class="comment">// 成功</span></span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果对象转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回json数据到前端</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309143734049.png" alt="image-20240309143734049" style="zoom:67%;">

<br>



<p><strong>测试</strong></p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309143755391.png" alt="image-20240309143755391"></p>
<br>



<hr>
<h4 id="4-请求未认证处理"><a href="#4-请求未认证处理" class="headerlink" title="4. 请求未认证处理"></a>4. 请求未认证处理</h4><p>创建一个自定义类MyAuthenticationEntryPoint实现接口<code>AuthenticationEntryPoint</code>，并实现接口中的方法<code>commence</code>，然后在方法中编写用户请求未认证处理的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationEntryPoint</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">localizedMessage</span> <span class="operator">=</span> <span class="string">&quot;需要登录&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, -<span class="number">1</span>); <span class="comment">// 失败</span></span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, localizedMessage);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果对象转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回json数据到前端</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309144613206.png" alt="image-20240309144613206" style="zoom:67%;">

<br>



<p><strong>测试</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309144642539.png" alt="image-20240309144642539" style="zoom:80%;">

<br>



<hr>
<h4 id="5-跨域处理"><a href="#5-跨域处理" class="headerlink" title="5. 跨域处理"></a>5. 跨域处理</h4><p>跨域全称是跨域资源共享(Cross-Origin Resources Sharing,CORS)，它是浏览器的保护机制，只允许网页请求统一域名下的服务，同一域名指&#x3D;&gt;协议、域名、端口号都要保持一致，如果有一项不同，那么就是跨域请求。在前后端分离的项目中，需要解决跨域的问题。</p>
<br>




<p>在SpringSecurity中解决跨域很简单，在配置文件中添加如下配置即可,在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跨域</span></span><br><span class="line">http.cors(withDefaults());</span><br></pre></td></tr></table></figure>

<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309144920726.png" alt="image-20240309144920726" style="zoom:67%;">

<br>



<hr>
<h4 id="6-用户认证信息"><a href="#6-用户认证信息" class="headerlink" title="6. 用户认证信息"></a>6. 用户认证信息</h4><p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309150919383.png" alt="image-20240309150919383"></p>
<p>在Spring Security框架中，SecurityContextHolder、SecurityContext、Authentication、Principal和Credential是一些与身份验证和授权相关的重要概念。它们之间的关系如下：</p>
<ol>
<li>SecurityContextHolder：SecurityContextHolder 是 Spring Security 存储已认证用户详细信息的地方。</li>
<li>SecurityContext：SecurityContext 是从 SecurityContextHolder 获取的内容，包含当前已认证用户的 Authentication 信息。</li>
<li>Authentication：Authentication 表示用户的身份认证信息。它包含了用户的Principal、Credential和Authority信息。</li>
<li>Principal：表示用户的身份标识。它通常是一个表示用户的实体对象，例如用户名。Principal可以通过Authentication对象的getPrincipal()方法获取。</li>
<li>Credentials：表示用户的凭证信息，例如密码、证书或其他认证凭据。Credential可以通过Authentication对象的getCredentials()方法获取。</li>
<li>GrantedAuthority：表示用户被授予的权限</li>
</ol>
<p>总结起来，SecurityContextHolder用于管理当前线程的安全上下文，存储已认证用户的详细信息，其中包含了SecurityContext对象，该对象包含了Authentication对象，后者表示用户的身份验证信息，包括Principal（用户的身份标识）和Credential（用户的凭证信息）。</p>
<br>



<p><strong>在controller中获取用户信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext(); <span class="comment">// 存储认证对象的上下文</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> context.getAuthentication(); <span class="comment">// 认证对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal(); <span class="comment">// 用户名</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">credentials</span> <span class="operator">=</span> authentication.getCredentials(); <span class="comment">// 身份</span></span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities(); <span class="comment">// 凭证(脱敏)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> authentication.getName(); <span class="comment">// 权限</span></span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;username&quot;</span>, name);</span><br><span class="line">        result.put(<span class="string">&quot;authorities&quot;</span>, authorities);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>测试</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309152816434.png" alt="image-20240309152816434" style="zoom:67%;">

<br>



<hr>
<h4 id="7-会话并发处理"><a href="#7-会话并发处理" class="headerlink" title="7. 会话并发处理"></a>7. 会话并发处理</h4><p>创建一个自定义类MySessionInformationExpiredStrategy实现接口<code>SessionInformationExpiredStrategy</code>，并实现接口中的方法<code>onExpiredSessionDetected</code>，然后在方法中编写会话并发处理的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySessionInformationExpiredStrategy</span> <span class="keyword">implements</span> <span class="title class_">SessionInformationExpiredStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onExpiredSessionDetected</span><span class="params">(SessionInformationExpiredEvent event)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建结果对象</span></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;该账号已从其他设备登录&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> event.getResponse();</span><br><span class="line">        <span class="comment">//返回响应</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240309153516589.png" alt="image-20240309153516589" style="zoom:67%;">

<br>



<p><strong>测试</strong></p>
<p>先在一个浏览器登录，然后再在另一个浏览器登录同一个用户，然后访问第一个浏览器登录后的主页会提升该账号已从其他设备登录，由于电脑只有一个浏览器，没有做测试了</p>
<br>





<hr>
<h3 id="四-授权"><a href="#四-授权" class="headerlink" title="四. 授权"></a>四. 授权</h3><p>授权管理的实现在SpringSecurity中非常灵活，可以帮助应用程序实现以下两种常见的授权需求：</p>
<ul>
<li><p>用户-权限-资源：例如张三的权限是添加用户、查看用户列表，李四的权限是查看用户列表</p>
</li>
<li><p>用户-角色-权限-资源：例如 张三是角色是管理员、李四的角色是普通用户，管理员能做所有操作，普通用户只能查看信息</p>
</li>
</ul>
<br>



<h4 id="1-基于request的授权"><a href="#1-基于request的授权" class="headerlink" title="1. 基于request的授权"></a>1. 基于request的授权</h4><p><strong>需求</strong></p>
<ul>
<li>具有USER_LIST权限的用户可以访问&#x2F;user&#x2F;list接口</li>
<li>具有USER_ADD权限的用户可以访问&#x2F;user&#x2F;add接口</li>
</ul>
<br>



<p><strong>在WebSecurityConfig的<code>filterChain</code>方法中添加相关配置</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310131859424.png" alt="image-20240310131859424" style="zoom:67%;">

<ul>
<li>requestMatchers(“&#x2F;user&#x2F;list”).hasAuthority(“USER_LIST”)<ul>
<li>用户要有<code>USER_LIST</code>权限，才能访问<code>/user/list</code>,其它同理</li>
</ul>
</li>
</ul>
<br>



<p><strong>实际开发中一般都会用一个数据库表来记录用户权限或者给用户表添加一个权限字段，这里为了方便测试，直接在用户登录时就给他赋予权限</strong></p>
<p><strong>在DBUserDetailsManager类中的<code>loadUserByUsername</code>方法中给用户赋予相关权限（方便测试）</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310132422436.png" alt="image-20240310132422436" style="zoom:67%;">



<br>



<p><strong>测试</strong></p>
<p>登录后再访问&#x2F;user&#x2F;list</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310132450603.png" alt="image-20240310132450603" style="zoom:50%;">

<br>



<p>去掉list权限后重新启动再次访问</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310132652899.png" alt="image-20240310132652899" style="zoom:80%;">

<br>





<hr>
<h4 id="2-请求未授权处理"><a href="#2-请求未授权处理" class="headerlink" title="2. 请求未授权处理"></a>2. 请求未授权处理</h4><p>创建一个自定义类MyAccessDeniedHandler实现接口<code>AccessDeniedHandler</code>，并实现接口中的方法<code>handle</code>，然后在方法中编写用户请求未授权处理的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, -<span class="number">1</span>); <span class="comment">// 失败</span></span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;没有访问权限&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果对象转换成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回json数据到前端</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>在WebSecurityConfig类的<code>filterChain</code>方法中添加相关代码</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310134315047.png" alt="image-20240310134315047" style="zoom: 67%;">

<br>



<p><strong>测试</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310134343272.png" alt="image-20240310134343272" style="zoom:67%;">

<br>



<hr>
<h4 id="3-角色分配"><a href="#3-角色分配" class="headerlink" title="3. 角色分配"></a>3. 角色分配</h4><p><strong>需求：</strong>角色为ADMIN的用户才可以访问&#x2F;user&#x2F;**路径下的资源</p>
<br>



<p><strong>在WebSecurityConfig的<code>filterChain</code>方法中添加相关配置</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310140642332.png" alt="image-20240310140642332" style="zoom:67%;">

<br>



<p><strong>实际开发中一般都会用一个数据库表来记录用户权限或者给用户表添加一个权限字段，这里为了方便测试，直接在用户登录时就给他赋予权限</strong></p>
<p><strong>在DBUserDetailsManager类中的<code>loadUserByUsername</code>方法中给用户赋予相关权限（方便测试）</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310140908349.png" alt="image-20240310140908349" style="zoom:67%;">

<br>



<p><strong>测试</strong></p>
<p>登录成功后可以看见用户的权限</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310140951186.png" alt="image-20240310140951186" style="zoom:67%;">

<br>



<p>访问<code>/user/list</code></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310141023954.png" alt="image-20240310141023954" style="zoom:67%;">

<br>



<p>修改用户登录时赋予的权限，再次访问</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310141130289.png" alt="image-20240310141130289" style="zoom:67%;">

<br>



<p>重新启动并登录</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310141224679.png" alt="image-20240310141224679" style="zoom:67%;">

<br>



<p>再次访问<code>user/list</code></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310141259589.png" alt="image-20240310141259589" style="zoom:67%;">

<br>



<hr>
<h4 id="4-RBAC"><a href="#4-RBAC" class="headerlink" title="4. RBAC"></a>4. RBAC</h4><p>RBAC（Role-Based Access Control，基于角色的访问控制）是一种常用的数据库设计方案，它将用户的权限分配和管理与角色相关联。以下是一个基本的RBAC数据库设计方案的示例：</p>
<ol>
<li>用户表（User table）：包含用户的基本信息，例如用户名、密码和其他身份验证信息。</li>
</ol>
<table>
<thead>
<tr>
<th>列名</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>user_id</td>
<td>int</td>
<td>用户ID</td>
</tr>
<tr>
<td>username</td>
<td>varchar</td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>varchar</td>
<td>密码</td>
</tr>
<tr>
<td>email</td>
<td>varchar</td>
<td>电子邮件地址</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<ol start="2">
<li>角色表（Role table）：存储所有可能的角色及其描述。</li>
</ol>
<table>
<thead>
<tr>
<th>列名</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>role_id</td>
<td>int</td>
<td>角色ID</td>
</tr>
<tr>
<td>role_name</td>
<td>varchar</td>
<td>角色名称</td>
</tr>
<tr>
<td>description</td>
<td>varchar</td>
<td>角色描述</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<ol start="3">
<li>权限表（Permission table）：定义系统中所有可能的权限。</li>
</ol>
<table>
<thead>
<tr>
<th>列名</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>permission_id</td>
<td>int</td>
<td>权限ID</td>
</tr>
<tr>
<td>permission_name</td>
<td>varchar</td>
<td>权限名称</td>
</tr>
<tr>
<td>description</td>
<td>varchar</td>
<td>权限描述</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<ol start="4">
<li>用户角色关联表（User-Role table）：将用户与角色关联起来。</li>
</ol>
<table>
<thead>
<tr>
<th>列名</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>user_role_id</td>
<td>int</td>
<td>用户角色关联ID</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
<td>用户ID</td>
</tr>
<tr>
<td>role_id</td>
<td>int</td>
<td>角色ID</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<ol start="5">
<li>角色权限关联表（Role-Permission table）：将角色与权限关联起来。</li>
</ol>
<table>
<thead>
<tr>
<th>列名</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>role_permission_id</td>
<td>int</td>
<td>角色权限关联ID</td>
</tr>
<tr>
<td>role_id</td>
<td>int</td>
<td>角色ID</td>
</tr>
<tr>
<td>permission_id</td>
<td>int</td>
<td>权限ID</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>在这个设计方案中，用户可以被分配一个或多个角色，而每个角色又可以具有一个或多个权限。通过对用户角色关联和角色权限关联表进行操作，可以实现灵活的权限管理和访问控制。</p>
<p>当用户尝试访问系统资源时，系统可以根据用户的角色和权限决定是否允许访问。这样的设计方案使得权限管理更加简单和可维护，因为只需调整角色和权限的分配即可，而不需要针对每个用户进行单独的设置。</p>
<p>RABC的详细介绍可以参考这篇文章<a target="_blank" rel="noopener" href="http://t.csdnimg.cn/Tl60Y">http://t.csdnimg.cn/Tl60Y</a></p>
<br>



<hr>
<h4 id="5-基于方法的授权"><a href="#5-基于方法的授权" class="headerlink" title="5. 基于方法的授权"></a>5. 基于方法的授权</h4><p>开启方法授权注解，在<code>WebSecurityConfig</code>配置类中开启</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144001999.png" alt="image-20240310144001999" style="zoom:67%;">

<br>



<p>把之前的权限给注释掉</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144059051.png" alt="image-20240310144059051" style="zoom:67%;">

<br>



<p>在方法上添加注解</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144230391.png" alt="image-20240310144230391" style="zoom:67%;">

<Br>

<p><strong>测试</strong></p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144326806.png" alt="image-20240310144326806" style="zoom:67%;">

<p>访问&#x2F;user&#x2F;list</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144531297.png" alt="image-20240310144531297" style="zoom: 50%;">

<br>



<p>可以在方法注解中添加authentication属性</p>
<ul>
<li>@PreAuthorize(“hasRole(‘ADMIN’) and authentication.name &#x3D; ‘admin’”)<ul>
<li>用户要用于AMDIN权限，并且用户名为admin，才能访问次方法</li>
</ul>
</li>
</ul>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310144650970.png" alt="image-20240310144650970" style="zoom:67%;">

<br>



<p><strong>还可以使用另一种注解方式</strong></p>
<p>@PreAuthorize(“hasAuthority(‘USER_ADD’)”)，权限认证，上面的是角色认证</p>
<p>这时候需要给User(Security框架中的User)分配相关的权限</p>
<img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310145624304.png" alt="image-20240310145624304" style="zoom:67%;">

<br>



<p><strong>重启登录后发现，角色权限ADMIN没了，因为authorities配置覆盖了roles配置（谁在后面谁生效），这两个不能同时使用</strong></p>
<p><img src="/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240310145712509.png" alt="image-20240310145712509"></p>
</Br>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/02/03/Spring-Security%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="clywa1f4k001tecvedrad2m97" data-title="Spring Security学习笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MyBatis-Plus" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/02/MyBatis-Plus/" class="article-date">
  <time class="dt-published" datetime="2024-01-02T06:54:34.000Z" itemprop="datePublished">2024-01-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/02/MyBatis-Plus/">MyBatis-Plus</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>MyBatis-Plus （简称 MP）是一个 MyBatis的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/">官方文档</a></p>
<hr>
<h3 id="1-常见注解"><a href="#1-常见注解" class="headerlink" title="1. 常见注解"></a>1. 常见注解</h3><p>MyBatis-Plus通过扫描实体类，并基于反射来获取实体类信息作为数据库表信息(基础BaseMapper时添加泛型)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>映射规则：</p>
<ul>
<li>类名驼峰下划线作为表明</li>
<li>名为id的字段作为表的主键</li>
<li>变量名驼峰下换线作为表的字段名</li>
</ul>
<p>mp通过反射获取到数据库表信息后就可以帮我们生成SQL语句</p>
<br>



<p>MyBatis-Plus中比较常用的几个注解：</p>
<ul>
<li>@TableName：指定数据库表名称</li>
<li>@TableId：指定数据库表中的主键<ul>
<li>可以设置主键生成类型，通过在注解中添加type属性实现，type属性的值封装在IdType中<ul>
<li>AUTO：自增</li>
<li>INPUT ：通过set方法自行输入</li>
<li>ASSIGN_ID：分配ID，通过接口IdentifierGenerator的方法nextId来生成ID，采用雪花算法</li>
</ul>
</li>
</ul>
</li>
<li>@TableFiled：指定数据库表中的普通字段信息<ul>
<li>使用场景：<ul>
<li>成员变量名与数据库字段名不一致</li>
<li>成员变量名以is开头并且是布尔值</li>
<li>成员变量名与数据库攻击值冲突</li>
<li>成员变量不是数据库字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;tb_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">	<span class="meta">@TableId(Value=&quot;u_id&quot;, type=&quot;IdType.AUTO&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableFileId(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String Name;</span><br><span class="line">    <span class="meta">@TableFileId(&quot;is_married&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isMarried;</span><br><span class="line">    <span class="meta">@TableFiledId(&quot;`order`&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer order;</span><br><span class="line">    <span class="meta">@TableFIledId(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>





<hr>
<h3 id="2-常见配置"><a href="#2-常见配置" class="headerlink" title="2. 常见配置"></a>2. 常见配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapping/*.xml</span> <span class="comment"># Mapper.xml文件地址（这里是默认值）</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.rainng.coursesystem.model</span> <span class="comment"># 别名扫描包</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># 是否开启下划线和驼峰的映射</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">false</span> <span class="comment"># 是否开启二级缓存</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">assign_id</span> <span class="comment"># id为雪花算法自动生成</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">not_null</span> <span class="comment"># 更新策略：只更新非空的字段</span></span><br></pre></td></tr></table></figure>

<p>这里除了type-aliases-package，其它的都不需要配置，默认值即可（上面的值就是默认值），除非有需要</p>
<br>





<hr>
<h3 id="3-CRUD接口"><a href="#3-CRUD接口" class="headerlink" title="3. CRUD接口"></a>3. CRUD接口</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/49cc81/#service-crud-%E6%8E%A5%E5%8F%A3">CRUD 接口 | MyBatis-Plus (baomidou.com)</a></p>
<p><strong>Service层</strong></p>
<p>Save</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录（选择字段，策略插入）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">save</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 插入（批量）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 插入（批量,设置插入批次）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Collection<T></T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">插入批次数量</td>
</tr>
</tbody></table>
<br>



<p>SaveOrUpdate</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableId 注解存在更新记录，否插入一条记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 根据updateWrapper尝试更新，否继续执行saveOrUpdate(T)方法</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Wrapper<T></T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类 UpdateWrapper</td>
</tr>
<tr>
<td align="center">Collection<T></T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">插入批次数量</td>
</tr>
</tbody></table>
<br>



<p>Remove</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 queryWrapper 设置的条件，删除记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体包装类 QueryWrapper</td>
</tr>
<tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键 ID</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键 ID 列表</td>
</tr>
</tbody></table>
<br>



<p>Update</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 UpdateWrapper 条件，更新记录 需要设置sqlset</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 whereWrapper 条件，更新记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(T updateEntity, Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 选择修改</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类 UpdateWrapper</td>
</tr>
<tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Collection<T></T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">更新批次数量</td>
</tr>
</tbody></table>
<br>



<p>Get</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line">T <span class="title function_">getById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录。结果集，如果是多个会抛出异常，随机取一条加上限制条件 wrapper.last(&quot;LIMIT 1&quot;)</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">&lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键 ID</td>
</tr>
<tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
<tr>
<td align="center">boolean</td>
<td align="center">throwEx</td>
<td align="center">有多个 result 是否抛出异常</td>
</tr>
<tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Function&lt;? super Object, V&gt;</td>
<td align="center">mapper</td>
<td align="center">转换函数</td>
</tr>
</tbody></table>
<br>



<p>List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 查询所有列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键 ID 列表</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
<tr>
<td align="center">Function&lt;? super Object, V&gt;</td>
<td align="center">mapper</td>
<td align="center">转换函数</td>
</tr>
</tbody></table>
<br>



<p>Page</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page)</span>;</span><br><span class="line"><span class="comment">// 条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 无条件分页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page)</span>;</span><br><span class="line"><span class="comment">// 条件分页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IPage<T></T></td>
<td align="center">page</td>
<td align="center">翻页对象</td>
</tr>
<tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
</tbody></table>
<br>



<p>Count</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询总记录数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
</tbody></table>
<br>



<p>query</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链式查询 普通</span></span><br><span class="line">QueryChainWrapper&lt;T&gt; <span class="title function_">query</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 链式查询 lambda 式。注意：不支持 Kotlin</span></span><br><span class="line">LambdaQueryChainWrapper&lt;T&gt; <span class="title function_">lambdaQuery</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：</span></span><br><span class="line">query().eq(<span class="string">&quot;column&quot;</span>, value).one();</span><br><span class="line">lambdaQuery().eq(Entity::getId, value).list();</span><br></pre></td></tr></table></figure>

<br>



<p>update</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链式更改 普通</span></span><br><span class="line">UpdateChainWrapper&lt;T&gt; <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 链式更改 lambda 式。注意：不支持 Kotlin</span></span><br><span class="line">LambdaUpdateChainWrapper&lt;T&gt; <span class="title function_">lambdaUpdate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：</span></span><br><span class="line">update().eq(<span class="string">&quot;column&quot;</span>, value).remove();</span><br><span class="line">lambdaUpdate().eq(Entity::getId, value).update(entity);</span><br></pre></td></tr></table></figure>

<br>





<p><strong>Mapper层</strong></p>
<p>Insert</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
</tbody></table>
<br>



<p>Delete</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; wrapper)</span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></T></td>
<td align="center">wrapper</td>
<td align="center">实体对象封装操作类（可以为 null）</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键 ID 列表(不能为 null 以及 empty)</td>
</tr>
<tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键 ID</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
</tbody></table>
<br>



<p>Update</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 whereWrapper 条件，更新记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T updateEntity, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 修改</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity)</span>;</span><br></pre></td></tr></table></figure>



<p>使用提示:</p>
<p>在调用<code>updateById</code>方法前，需要在<code>T entity</code>（对应的实体类）中的主键属性上加上<code>@TableId</code>注解。</p>
<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象 (set 条件值,可为 null)</td>
</tr>
<tr>
<td align="center">Wrapper<T></T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）</td>
</tr>
</tbody></table>
<br>



<p>Select</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line">T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询一条记录</span></span><br><span class="line">T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录。注意： 只返回第一个字段的值</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录（并翻页）</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMapsPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line">Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键 ID</td>
</tr>
<tr>
<td align="center">Wrapper<T></T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类（可以为 null）</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键 ID 列表(不能为 null 以及 empty)</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
<tr>
<td align="center">IPage<T></T></td>
<td align="center">page</td>
<td align="center">分页查询条件（可以为 RowBounds.DEFAULT）</td>
</tr>
</tbody></table>
<br>





<hr>
<h3 id="4-条件构造器"><a href="#4-条件构造器" class="headerlink" title="4. 条件构造器"></a>4. 条件构造器</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/10c804/">条件构造器 | MyBatis-Plus (baomidou.com)</a></p>
<p><strong>allEq</strong></p>
<p>全部eq（或个别isNull）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allEq(Map&lt;R, V&gt; params)</span><br><span class="line">allEq(Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br><span class="line">allEq(<span class="type">boolean</span> condition, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br></pre></td></tr></table></figure>

<p>参数null2IsNull： 为<code>true</code>则在<code>map</code>的<code>value</code>为<code>null</code>时调用<code>isNull方法</code>,为<code>false</code>时则忽略<code>value</code>为<code>null</code>的</p>
<p>例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allEq(&#123;id:<span class="number">1</span>,name:<span class="string">&quot;老王&quot;</span>,age:<span class="literal">null</span>&#125;)  ---&gt;  id = <span class="number">1</span> <span class="type">and</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&#x27;老王&#x27;</span> and age is <span class="literal">null</span></span><br><span class="line"><span class="title function_">allEq</span><span class="params">(&#123;id:<span class="number">1</span>,name:<span class="string">&quot;老王&quot;</span>,age:<span class="literal">null</span>&#125;, <span class="literal">false</span>)</span>  ---&gt;  id = <span class="number">1</span> <span class="type">and</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&#x27;老王&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>eq</strong></p>
<p>等于<code>=</code></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;老王&quot;</span>)---&gt;name = <span class="string">&#x27;老王&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>ne</strong></p>
<p>不等于<code>&lt;&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ne(R column, Object val)</span><br><span class="line">ne(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ne(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;老王&quot;</span>)---&gt;name &lt;&gt; <span class="string">&#x27;老王&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>gt</strong></p>
<p>大于</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gt(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)---&gt;age &gt; <span class="number">18</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>ge</strong></p>
<p>大于等于&gt;&#x3D;</p>
<p>例如：&#96;&#96;&#96; java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ge(&quot;age&quot;, 18)`---&gt;`age &gt;= 18</span><br></pre></td></tr></table></figure>

<br>



<p><strong>lt</strong></p>
<p>小于&lt;</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lt(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)---&gt;age &lt; <span class="number">18</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>le</strong></p>
<p>小于等于&lt;&#x3D;</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">le(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)---&gt;age &lt;= <span class="number">18</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>between</strong></p>
<p>在什么之间</p>
<p>例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">between(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>, <span class="number">30</span>)---&gt;age between <span class="number">18</span> and <span class="number">30</span></span><br></pre></td></tr></table></figure>

<br>



<p>notBetween</p>
<p>不在什么之间</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notBetween(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>, <span class="number">30</span>)---&gt;age not between <span class="number">18</span> and <span class="number">30</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>like</strong></p>
<p>模糊查询</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)---&gt;name like <span class="string">&#x27;%王%&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>notLike</strong></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notLike(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)---&gt;name not like <span class="string">&#x27;%王%&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>likeLeft</strong></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">likeLeft(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)---&gt;name like <span class="string">&#x27;%王&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>likeRight</strong></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)---&gt;name like <span class="string">&#x27;王%&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<p><strong>notLikeLeft</strong></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notLikeLeft(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)---&gt;name not like <span class="string">&#x27;%王&#x27;</span></span><br></pre></td></tr></table></figure>

<br>



<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2024/01/02/MyBatis-Plus/" data-id="clywa1f49000uecvecu68c0hj" data-title="MyBatis-Plus" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MybatisPlus/" rel="tag">MybatisPlus</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MyBatis分页插件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/28/MyBatis%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2023-12-28T05:48:44.000Z" itemprop="datePublished">2023-12-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/28/MyBatis%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/">MyBatis分页插件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>PageHelper是MyBatis中非常方便的第三方<strong>分页插件</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/README_zh.md">官网文档</a></p>
<br>



<p><strong>添加依赖</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;  </span><br><span class="line">	&lt;artifactId&gt;pagehelper&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">5.0</span><span class="number">.0</span>&lt;/version&gt; <span class="comment">//版本号</span></span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>配置分页插件</strong></p>
<p>在MyBatis的核心配置文件mybati-config-xml中添加配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">	&lt;!--分页插件--&gt;</span><br><span class="line">	&lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;&lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>

<br>



<p><strong>分页常用标签</strong></p>
<ul>
<li>pageSize：每页显示的条数</li>
<li>size：当前页显示的真实条数</li>
<li>total：总记录数</li>
<li>pages：总页数</li>
<li>prePage：上一页的页码</li>
<li>nextPage：下一页的页码</li>
<li>isFirstPage&#x2F;isLastPage：是否为第一页&#x2F;最后一页</li>
<li>hasPreviousPage&#x2F;hasNextPage：是否存在上一页&#x2F;下一页</li>
<li>navigatepageNums：导航分页的页码</li>
</ul>
<p><strong>使用方法</strong></p>
<p>在查询方法前调用<code>PageHelper.startPage()</code>即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectPageTest</span><span class="params">()</span> &#123;</span><br><span class="line">     ...</span><br><span class="line">     ...</span><br><span class="line">     ...</span><br><span class="line">     Page&lt;Object&gt; objects = PageHelper.startPage(<span class="number">0</span>, <span class="number">5</span>);       <span class="comment">//创建分页插件对象</span></span><br><span class="line">     List&lt;Stu&gt; list = mapper.selectStudent(<span class="literal">null</span>);           <span class="comment">//查询对象</span></span><br><span class="line">     list.forEach(System.out::println);</span><br><span class="line">     System.out.println(objects);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2023/12/28/MyBatis%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/" data-id="clywa1f4f001iecve9z5q38q7" data-title="MyBatis分页插件" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java反射" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/23/Java%E5%8F%8D%E5%B0%84/" class="article-date">
  <time class="dt-published" datetime="2023-12-23T13:17:07.000Z" itemprop="datePublished">2023-12-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/23/Java%E5%8F%8D%E5%B0%84/">Java反射</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>该笔记基于<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ke4y1w7yn?vd_source=db8e7458ec195ac74979ce5478cbc624">B站视频</a>编写</p>
<br>



<h3 id="1-动态代理的思想分析"><a href="#1-动态代理的思想分析" class="headerlink" title="1. 动态代理的思想分析"></a>1. 动态代理的思想分析</h3><p><strong>程序为什么需要代理？</strong></p>
<p>代理在程序设计中有很重要的作用，它可以帮助我们更好地管理和扩展代码，同时也能提高代码的安全性和隐私性</p>
<p>使用代理的好处：</p>
<ul>
<li>降低程序复杂度</li>
<li>易于业务扩展</li>
<li>代码高内聚低耦合</li>
<li>增强功能</li>
<li>增强安全性和隐私性</li>
</ul>
<br>



<p>代理就像中介公司一样，它通过接口来自动要代理那些方法<br>代理和被代理的类要实现同一个接口</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231224135938732.png" alt="image-20231224135938732" style="zoom: 67%;">

<br>



<p><strong>代码实现</strong></p>
<p>定义一个接口（Star），里面放需要被代理的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 把所有需要代理的方法都定义在接口中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Star</span> &#123;</span><br><span class="line">    <span class="comment">// 唱歌</span></span><br><span class="line">    <span class="keyword">abstract</span> String <span class="title function_">sing</span><span class="params">(String name)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 跳舞</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">dance</span><span class="params">(String name)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>创建一个需要被代理的类（BigStar）,实现接口Star</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigStar</span> <span class="keyword">implements</span> <span class="title class_">Star</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BigStar</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 唱歌</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sing</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;正在唱&quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;谢谢&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳舞</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dance</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;正在跳舞&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BigStar</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p><strong>创建代理对象</strong></p>
<p>java.lang.reflect.Proxy类：提供了为对象产生代理对象的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>参数一：用于指定用哪个类加载器，去加载生成的代理类</li>
<li>参数二：指定接口，这些接口用于指定生成的代理会有哪些方法，以集合的形式添加</li>
<li>参数三：用来指定生成的代理对象要干什么事情</li>
</ul>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 这个类用于创建代理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 给一个明星对象创建一个代理</span></span><br><span class="line"><span class="comment">     *          形参：被代理的明星对象</span></span><br><span class="line"><span class="comment">     *          返回值：给明星创建代理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *          需求：</span></span><br><span class="line"><span class="comment">     *          有人想请大明星唱歌</span></span><br><span class="line"><span class="comment">     *          1. 获取代理对象</span></span><br><span class="line"><span class="comment">     *              代理对象 = ProxyUtil.createProxy(大明星对象);</span></span><br><span class="line"><span class="comment">     *          2. 调用代理的唱歌方法</span></span><br><span class="line"><span class="comment">     *              代理对象。唱歌的方法();</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Star <span class="title function_">crateProxy</span><span class="params">(BigStar bigStar)</span> &#123;</span><br><span class="line">        <span class="type">Star</span> <span class="variable">star</span> <span class="operator">=</span> (Star) Proxy.newProxyInstance(</span><br><span class="line">                ProxyUtil.class.getClassLoader(),<span class="comment">// 用于指定用哪个类加载器，去加载生成的代理类</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Star.class&#125;,<span class="comment">// 指定接口，这些接口用于指定生成的代理会有哪些方法，以集合的形式添加</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;<span class="comment">// 用来指定生成的代理对象要干什么事情</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="comment">/** </span></span><br><span class="line"><span class="comment">                         * 参数一：代理的对象</span></span><br><span class="line"><span class="comment">                         * 参数二：要运行的方法</span></span><br><span class="line"><span class="comment">                         * 参数三：调用要运行的方法时，传入的参数</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;sing&quot;</span>.equals(method)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;准备话筒&quot;</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;dance&quot;</span>.equals(method)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;准备场地&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 去找大明星开始唱歌或者跳舞</span></span><br><span class="line">                        <span class="comment">// 调用大明星里面的唱歌或者跳舞</span></span><br><span class="line">                        <span class="keyword">return</span> method.invoke(bigStar,args);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> star;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p><strong>编写测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 测试类</span></span><br><span class="line"><span class="comment"> *             需求：</span></span><br><span class="line"><span class="comment"> *              有人想请大明星唱歌</span></span><br><span class="line"><span class="comment"> *               1. 获取代理对象</span></span><br><span class="line"><span class="comment"> *                   代理对象 = ProxyUtil.createProxy(大明星对象);</span></span><br><span class="line"><span class="comment"> *               2. 调用代理的唱歌方法</span></span><br><span class="line"><span class="comment"> *                  代理对象。唱歌的方法();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取代理对象</span></span><br><span class="line">        <span class="type">BigStar</span> <span class="variable">bigStar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigStar</span>(<span class="string">&quot;鸡哥&quot;</span>);</span><br><span class="line">        <span class="type">Star</span> <span class="variable">proxy</span> <span class="operator">=</span> ProxyUtil.crateProxy(bigStar);</span><br><span class="line">        <span class="comment">// 2. 调用唱歌的方法</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> proxy.sing(<span class="string">&quot;只因你太美&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>



<p>运行结果</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231224145810847.png" alt="image-20231224145810847" style="zoom:67%;">

<br>



<hr>
<h3 id="2-反射的概述"><a href="#2-反射的概述" class="headerlink" title="2. 反射的概述"></a>2. 反射的概述</h3><p>反射允许对封装类的字段，方法和构造函数的信息进行编程访问</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225115959606.png" alt="image-20231225115959606" style="zoom: 50%;">

<p>Java 反射，就是在运行状态中</p>
<ul>
<li>获取任意类的名称、package信息、所有属性、方法、注解、类型、类加载器等</li>
<li>获取任意对象的属性，并且能改变对象的属性</li>
<li>调用任意对象的方法</li>
<li>判断任意一个对象所属的类</li>
<li>实例化任意一个类的对象</li>
</ul>
<br>



<hr>
<h3 id="3-获取class对象"><a href="#3-获取class对象" class="headerlink" title="3. 获取class对象"></a>3. 获取class对象</h3><ul>
<li>Class.forName(“全类名”)</li>
<li>类名.class</li>
<li>对象.getClass()</li>
</ul>
<br>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.myreflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获取class对象的三种方式</span></span><br><span class="line"><span class="comment">         * 1. Class.forName(&quot;全类名&quot;)</span></span><br><span class="line"><span class="comment">         * 2. 类名.class</span></span><br><span class="line"><span class="comment">         * 3. 对象.getClass()</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一种方式</span></span><br><span class="line">        <span class="comment">// 最常见的</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zheng.myreflect.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二种方式</span></span><br><span class="line">        <span class="comment">// 一般在作为参数的时候使用</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz2</span> <span class="operator">=</span> Student.class;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三种方式</span></span><br><span class="line">        <span class="comment">// 要有这个类的对象时才能使用</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz3</span> <span class="operator">=</span> stu.getClass();</span><br><span class="line"></span><br><span class="line">        System.out.println(clazz1);</span><br><span class="line">        System.out.println(clazz1==clazz2);</span><br><span class="line">        System.out.println(clazz2==clazz3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225135632247.png" alt="image-20231225135632247"></p>
<br>





<hr>
<h3 id="4-反射获取构造方式"><a href="#4-反射获取构造方式" class="headerlink" title="4. 反射获取构造方式"></a>4. 反射获取构造方式</h3><p>Class类中用于获取构造方法的方法</p>
<ul>
<li>Constructor&lt;?&gt;[]getConstructors()：返回所有公共构造方法对象的数组</li>
<li>Constructor&lt;?&gt;[]getDeclaredConstructors()：返回所有构造方法对象的数组</li>
<li>Constructor<T>getConstructor(Class&lt;?&gt;…parameterTypes)：返回单个公共构造方法对象</T></li>
<li>Constructor<T>getDeclaredConstructor(Class&lt;?&gt;…parameterTypes)：返回单个构造方法对象</T></li>
</ul>
<br>



<p>Constructor类中用于创建对象的方法</p>
<ul>
<li>T newInstance(Object… initargs)：根据指定的构造方法创建对象</li>
<li>setAccessible（boolean flag）：设置为true，表示取消访问检查</li>
</ul>
<br>



<p>JAVA反射机制中，getModifiers()方法返回int类型值表示该字段的修饰符</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>对应的int类型</th>
</tr>
</thead>
<tbody><tr>
<td>public</td>
<td>1</td>
</tr>
<tr>
<td>private</td>
<td>2</td>
</tr>
<tr>
<td>protected</td>
<td>4</td>
</tr>
<tr>
<td>static</td>
<td>8</td>
</tr>
<tr>
<td>final</td>
<td>16</td>
</tr>
<tr>
<td>synchronized</td>
<td>32</td>
</tr>
<tr>
<td>volatile</td>
<td>64</td>
</tr>
<tr>
<td>transient</td>
<td>128</td>
</tr>
<tr>
<td>native</td>
<td>256</td>
</tr>
<tr>
<td>interface</td>
<td>512</td>
</tr>
<tr>
<td>abstract</td>
<td>1024</td>
</tr>
<tr>
<td>strict</td>
<td>2048</td>
</tr>
</tbody></table>
<br>



<p>定义一个学生类，定义4个构造方法，其中两个公共的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>定义测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReflectDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 获取字节码文件对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zheng.myrelfect2.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取构造方法</span></span><br><span class="line">        <span class="comment">// 返回所有公共构造方法对象的数组</span></span><br><span class="line">        Constructor[] cons1 = clazz.getConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor con : cons1) &#123;</span><br><span class="line">            System.out.println(con);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回所有构造方法对象的数组</span></span><br><span class="line">        Constructor[] cons2 = clazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor con : cons2) &#123;</span><br><span class="line">            System.out.println(con);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回单个公共构造方法对象</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con1</span> <span class="operator">=</span> clazz.getConstructor();<span class="comment">// 无参</span></span><br><span class="line">        System.out.println(con1);</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con2</span> <span class="operator">=</span> clazz.getConstructor(String.class);<span class="comment">// 有参</span></span><br><span class="line">        System.out.println(con2);</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回单个构造方法对象</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con3</span> <span class="operator">=</span> clazz.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        System.out.println(con3);</span><br><span class="line">        System.out.println(<span class="string">&quot;分割线******************************************************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取构造方法对象的权限修饰等级</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> con3.getModifiers();</span><br><span class="line">        System.out.println(modifiers);</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取构造方法对象的参数</span></span><br><span class="line">        Parameter[] parameters = con3.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (Parameter parameter : parameters) &#123;</span><br><span class="line">            System.out.println(parameter);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用构造方法对象创建类</span></span><br><span class="line">        con3.setAccessible(<span class="literal">true</span>);<span class="comment">// 临时取消权限验证（private），暴力反射</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> (Student) con3.newInstance(<span class="string">&quot;正哥&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>运行结果</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225144534739.png" alt="image-20231225144534739" style="zoom:67%;">

<br>



<hr>
<h3 id="5-反射获取成员变量"><a href="#5-反射获取成员变量" class="headerlink" title="5. 反射获取成员变量"></a>5. 反射获取成员变量</h3><p>Class类中用于获取成员变量的方式</p>
<ul>
<li>Field[] getFields()：返回所有公共成员变量对象的数组</li>
<li>Field[] getDeclaredFields()：返回所有成员变量对象的数组</li>
<li>Field[] getField(String name)：返回单个公共成员变量对象</li>
<li>Field getDeclaredField(String name)：返回单个成员变量对象</li>
</ul>
<br>



<p>Field类中用于创建对象的方法</p>
<ul>
<li>void set(Object obj, Object value)：赋值</li>
<li>Object get(Object obj)：获取值</li>
</ul>
<br>



<p>创建一个学生类，定义三个成员变量，一个公共的，两个私有的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age, String gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(String gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>定义测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取class字节码文件的对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zheng.myrelflect3.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有成员变量</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            System.out.println(field);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取单个的成员变量</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取权限修饰符</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> name.getModifiers();</span><br><span class="line">        System.out.println(modifiers);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取成员变量名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">n</span> <span class="operator">=</span> name.getName();</span><br><span class="line">        System.out.println(n);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取成员变量类型</span></span><br><span class="line">        Class&lt;?&gt; type = name.getType();</span><br><span class="line">        System.out.println(type);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取成员变量的值，先有对象才有值</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;正哥&quot;</span>, <span class="number">18</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);<span class="comment">// 临时取消访问权限</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nameValue</span> <span class="operator">=</span> (String) name.get(stu);</span><br><span class="line">        System.out.println(nameValue);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改对象里面记录的值</span></span><br><span class="line">        name.set(stu, <span class="string">&quot;正哥学Java&quot;</span>);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>测试结果</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225152725571.png" alt="image-20231225152725571" style="zoom:67%;">

<br>





<hr>
<h3 id="6-反射获取成员方法"><a href="#6-反射获取成员方法" class="headerlink" title="6. 反射获取成员方法"></a>6. 反射获取成员方法</h3><p>Class类中用于获取成员方法的方法</p>
<ul>
<li>Method[] getMethods()：返回所有公共成员方法对象的数组，包括继承的（包含父类的）</li>
<li>Method[] getDeclaredMethods()：返回所有成员方法对象的数组，不包括继承的</li>
<li>Method[] getMethod(String name, Class&lt;?&gt;…parameterTypes)：返回单个公共成员方法对象</li>
<li>Method[] getDeclaredMethod(String name, Class&lt;?&gt;…paramenterTypes)：返回单个成员方法对象</li>
</ul>
<br>



<p>Method类中用于创建对象的方法</p>
<p>Object invoke(Object obj, Object…args)：运行方法</p>
<ul>
<li>参数一：用obj对象调用该方法</li>
<li>参数二：调用方法的传递的参数（没有就不用写）</li>
<li>返回值：方法的返回值（没有就不用写）</li>
</ul>
<br>



<p>定义一个student类，有两个成员方法，一个是公共方法sleep()，一个是私有方法eat()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.myrelflect4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">eat</span><span class="params">(String something)</span> <span class="keyword">throws</span> NullPointerException&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;再吃&quot;</span> + something);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;太好吃了&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>



<p>定义一个测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zheng.myrelflect4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReflectDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 获取class字节码文件对象</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.zheng.myrelflect4.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有的公共方法对象（包括父类的）</span></span><br><span class="line">        Method[] methods = clazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;分割线********************分割线&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有的方法对象（包括所有的，不包括父类的）</span></span><br><span class="line">        Method[] declaredMethods = clazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">            System.out.println(declaredMethod);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;分割线********************分割线&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取指定的单一方法</span></span><br><span class="line">        <span class="comment">// 第一个参数是方法名，第二个参数是方法的参数类型</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>,String.class);</span><br><span class="line">        System.out.println(method);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取方法的修饰符</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> method.getModifiers();</span><br><span class="line">        System.out.println(modifiers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取方法的名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> method.getName();</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取方法的形参</span></span><br><span class="line">        Parameter[] parameters = method.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (Parameter parameter : parameters) &#123;</span><br><span class="line">            System.out.println(parameter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取方法抛出的异常</span></span><br><span class="line">        Class&lt;?&gt;[] exceptionTypes = method.getExceptionTypes();</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; exceptionType : exceptionTypes) &#123;</span><br><span class="line">            System.out.println(exceptionType);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****************************&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法运行</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 参数一stu：表示方法的调用者</span></span><br><span class="line">        <span class="comment">// 参数二“汉堡包”：表示在调用方法的时候传递的实际参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) method.invoke(stu, <span class="string">&quot;汉堡&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>测试结果</p>
<img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225213808019.png" alt="image-20231225213808019" style="zoom:80%;">

<p><img src="/2023/12/23/Java%E5%8F%8D%E5%B0%84/image-20231225214013575.png" alt="image-20231225214013575"></p>
<br>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzhengjy.github.io/2023/12/23/Java%E5%8F%8D%E5%B0%84/" data-id="clywa1f47000oecve23wo8wvs" data-title="Java反射" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JVM%E7%AF%87/">JVM篇</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%BB%8F%E9%AA%8C/">技术经验</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">框架和中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E7%AF%87/">面试篇</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MybatisPlus/" rel="tag">MybatisPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot3/" rel="tag">SpringBoot3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel/" rel="tag">excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" rel="tag">权限管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Lambda/" style="font-size: 10px;">Lambda</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Mybatis/" style="font-size: 10px;">Mybatis</a> <a href="/tags/MybatisPlus/" style="font-size: 10px;">MybatisPlus</a> <a href="/tags/RabbitMQ/" style="font-size: 13.33px;">RabbitMQ</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/SpringBoot3/" style="font-size: 10px;">SpringBoot3</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/excel/" style="font-size: 10px;">excel</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/redis/" style="font-size: 16.67px;">redis</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13.33px;">前端</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" style="font-size: 10px;">权限管理</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 10px;">集合</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/19/xxl-job/">xxl-job</a>
          </li>
        
          <li>
            <a href="/2024/07/01/ElasticSearch/">ElasticSearch</a>
          </li>
        
          <li>
            <a href="/2024/06/20/%E9%80%9A%E8%BF%87JWT%E5%AE%9E%E7%94%9F%E6%88%90Token/">通过JWT实生成Token</a>
          </li>
        
          <li>
            <a href="/2024/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">分布式事务的解决方案</a>
          </li>
        
          <li>
            <a href="/2024/06/10/%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97/">延时队列</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Zheng<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>